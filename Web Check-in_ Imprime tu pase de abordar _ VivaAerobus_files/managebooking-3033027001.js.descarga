ezy.views.changebooking.availability=function(e){var t={},i=null,n=null,a=!1,r=!1;t.init=function(){t.setEvents(),t.setCommands(),t.setSubscribe()},t.setSubscribe=function(){$.subscribe("changebooking/commitChanges",t.commitChanges)},t.setEvents=function(){$(".availabilityContainer .edit").click(function(){t.ShowFlights($(this))}),$("#AirportFrom").change(function(){$("#ReturnAirportTo").val($(this).val())}),$("#AirportTo").change(function(){$("#ReturnAirportFrom").val($(this).val())})},t.setCommands=function(){commandSender.addHandler("paychanges",function(t,i){$.ajax({type:"POST",url:e.changeUrl,data:JSON.stringify(i),contentType:"application/json; charset=utf-8",dataType:"json",success:function(){location.reload()}})})},t.getTime=function(e,t){var i=new Date,n=new Date;i.setHours(e.split(":")[0]),i.setMinutes(e.split(":")[1]),n.setHours(t.split(":")[0]),n.setMinutes(t.split(":")[1]);var a=n-i,r=a/1e3,o=Math.floor(r/3600),l=Math.floor(r%3600)/60,s=(10>o?"0"+o:o)+":"+(10>l?"0"+l:l);return s},t.createCustomFields=function(e){for(var t=0;t<e.length;t++){var i=e[t].FareData,n=i.SegmentKey.toString().split("/");i.OriginCode=n[4],i.DestinationCode=n[5],i.TravelTimeText=i.JourneyTime,i.RadioGroup="flights"+i.AvailType,e[t].showFlightDetails=ko.observable(!1),e[t].toggleFlightDetails=function(e,t){this.showFlightDetails(!this.showFlightDetails())}}},t.hasSegmentsChanges=function(e){var t=!1;return e.each(function(){var e=$(this),i=e.find(".default-selection");e.find(".departure-city-select").val()!==i.attr("data-from")&&(t=!0),e.find(".arrival-city-select").val()!==i.attr("data-to")&&(t=!0),e.find(".day-select").val()!==i.attr("data-day")&&(t=!0),e.find(".month-select").val()!==i.attr("data-month")&&(t=!0),e.find(".change-date").is(":checked")&&(t=!0)}),t},t.hasOutChanges=function(e){var i=$(e).find("li.segment.out");return t.hasSegmentsChanges(i)},t.hasInChanges=function(e){var i=$(e).find("li.segment.in");return t.hasSegmentsChanges(i)},t.flightsOut=ko.observableArray([]),t.flightsIn=ko.observableArray([]),t.departureCity=ko.observable(""),t.arrivalCity=ko.observable(""),t.boardDate=ko.observable(""),t.returnDate=ko.observable(""),t.flightsInLoading=ko.observable(!1),t.flightsOutLoading=ko.observable(!1),t.operatedFlights=ko.observableArray([]),t.isOperatedFlight=function(e){return t.operatedFlights().indexOf(e)>-1},t.formChanged=function(e){a=t.hasOutChanges(e),r=t.hasInChanges(e),a||r?e.find(".change-controls").show():e.find(".change-controls").hide()},t.HideFlights=function(e){$(e).closest(".flightAvailability").siblings().hide();var t=$(e).closest(".availabilityContainer");t.find(".weekSearch").hide(),t.find(".edit").show()},t.ShowFlights=function(e){var t=$(e).closest(".availabilityContainer");t.find(".flightAvailability").show(),t.find(".weekSearch").show(),t.find(".edit").hide()},t.selectFlight=function(o,l){if("out"==o.AvailType?i=o:n=o,t.HideFlights($(l.srcElement)),a&&null===i||r&&null===n)return!0;0==a&&null!==i&&(i=null),0==r&&null!==n&&(n=null);var s={outFlight:i,inFlight:n,locator:e.locator};return $.publish("payment/hideAndCloseAllPaymentOption"),$.publish("changebooking/hidePerformChangeContainer"),e.SeatingSelectionInChangeBooking||$("#additional-payment-loading").show(),t.doChangeBookingPricing(s),!0},t.doChangeBookingPricing=function(i){$.publish("bookingBasket/showLoading"),$.ajax({type:"POST",url:e.pricingUrl,data:JSON.stringify(i),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){$(".availabilityError.errorContainer").hide(),$("#additional-payment-loading").hide(),t.IsVivaBizAndNoPaymentRequired!==!0||e.SeatingSelectionInChangeBooking?($.publish("bookingBasket/show",t.BookingBasketTemplateData),window.ExtrasViewModel.setAvailableExtras(t.AvailableExtras),e.SeatingSelectionInChangeBooking||$.publish("payment/show")):($.publish("bookingBasket/hideWholeBookingBasket"),$.publish("changebooking/showPerformChangeContainer")),window.RouteInfo.OutboundFlightKeys=t.OutboundFlightKeys,window.RouteInfo.InboundFlightKeys=t.InboundFlightKeys;var n=[];window.RouteInfo.OutboundFlightKeys.forEach(function(e){n.push(e)}),window.RouteInfo.InboundFlightKeys.forEach(function(e){n.push(e)}),window.RouteInfo.LegDictionary={},$(n).each(function(e,t){window.RouteInfo.LegDictionary[t]=e+1});var o=[i.outFlight,i.inFlight],l=[];null!=i.outFlight&&1==a&&l.push("1"),null!=i.inFlight&&1==r&&l.push("2"),e.SeatingSelectionInChangeBooking&&($("#OverrideSegments-ExtrasSeat").val(l.join()),$.publish("changebooking/pricingsuccess",[o,{outChanged:a,inChanged:r},i.selectedPax,t.AmountToPay]))},error:function(e){$("#additional-payment-loading").hide(),$.publish("bookingBasket/hideWholeBookingBasket"),t.AvailabilityError(e)}})},t.commitChanges=function(){$.publish("changebooking/hidePerformChangeContainer"),$("#additional-payment-loading").show(),$.ajax({type:"POST",url:e.changeUrl,contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){1==e.HaveError?(t.handleError(e),$.publish("changebooking/showPerformChangeContainer")):window.location.href=e.Url},error:function(e){$.publish("changebooking/showPerformChangeContainer"),t.handleError({Errors:[{ErrorDetail:e.responseText.substr(0,e.responseText.indexOf(",")).replace("{","").replace(/\"/g,"")}]})}})},t.handleError=function(e){$("#additional-payment-loading").hide(),$("#change-date-error ul").html(""),$.each(e.Errors,function(e,t){$("#change-date-error ul").append("<li>"+t.ErrorDetail+"</li>")}),$("#change-date-error").show(),$("#change-date-error ul").show(),$("#change-date-error")[0].scrollIntoView()},t.AvailabilityError=function(t){var i="";try{i=t.responseText.substr(0,t.responseText.indexOf("</title>")).replace("</title>","").replace("<title>","").replace("<html>","").replace("<head>","")}catch(n){}if(i.indexOf("[SE]")>=0)try{ga("send","event",{eventCategory:"SessionEnd",eventAction:"Change booking pricing"})}catch(a){}else{var r="SearchType - Change Flight, SearchUrl - "+e.pricingUrl+" : "+i;window.dataLayer.push({event:"Error",errtype:"Availability",errdetail:"An error occurred., "+r})}var r="SearchType - Change Flight, SearchUrl - "+e.pricingUrl+" : "+i;window.dataLayer.push({event:"Error",errtype:"Availability",errdetail:"An error occurred., "+r}),$(".change-controls").after("<div class='availabilityError errorContainer'>An error occurred. <br />"+i+"</div>"),$("#additional-payment-loading").hide()},t.Airport=function(e,t){var i={};return i.name=e.Name,i.international=e.InternationalName,i.code=e.Code,i.text=ko.computed(function(){return t.isInternational()&&i.international?i.international:i.name}),i};var o=e.airports,l=e.internationalAirports;return t.selectedFromAirport=ko.observable(),t.selectedToAirport=ko.observable(),t.isInternational=function(){var e=t.selectedFromAirport(),i=t.selectedToAirport();return-1!=l.indexOf(e)||-1!=l.indexOf(i)},t.fromAirports=ko.observableArray(ko.utils.arrayMap(o,function(e){return new t.Airport(e,t)})),t.toAirports=ko.computed(function(){var e=t.selectedFromAirport(),i=ko.utils.arrayFirst(o,function(t){return t.Code===e}),n=ko.utils.arrayMap(i?i.Connections:[],function(e){return new t.Airport(e,t)});return n}),e.preselectedFromAirport&&t.selectedFromAirport(e.preselectedFromAirport.Code),e.preselectedToAirport&&t.selectedToAirport(e.preselectedToAirport.Code),t.getSelectedFromAirportName=ko.computed(function(){if(!t.selectedFromAirport())return"";var e=ko.utils.arrayFirst(o,function(e){return e.Code===t.selectedFromAirport()});return e.Name}),t.getSelectedToAirportName=ko.computed(function(){if(!t.selectedToAirport())return"";var e=ko.utils.arrayFirst(o,function(e){return e.Code===t.selectedToAirport()});return e.Name}),t.selectedFromAirport.subscribe(function(){e.arrivingAirport.selectBox("refresh"),t.selectedToAirport(void 0)}),t.selectedToAirport.subscribe(function(){}),t.showWarningMessage=function(e){var t=$(".change-flight-details-message");if(t.velocity("slideDown"),t.html().length>0){var i=t.html()+"<br/>"+e;t.html(i)}else t.html(e)},t.hideWarningMessage=function(){var e=$(".change-flight-details-message");e.hide(),e.html("")},t.search=function(i){var n={},a=$(i);if(t.hideWarningMessage(),a.find("input:not([type=submit]), select").each(function(){var e=$(this);n[e.attr("name")]=e.val()}),n.flights=e.flights,n.BoardDateMonthYear&&n.BoardDateDay){var r="",o=n.BoardDateDay;0===o.indexOf("-")&&(o=o.substring(1)),1===o.length&&(o="0"+o),r=n.BoardDateMonthYear+"-"+o,n.flights[0].DepartureDate=moment(r).toDate(),n.flights[0].DepartureDateString=r}if(n.ReturnDateMonthYear&&n.ReturnDateDay){var l="",s=n.ReturnDateDay;0===s.indexOf("-")&&(s=s.substring(1)),1===s.length&&(s="0"+s),l=n.ReturnDateMonthYear+"-"+s,n.flights[1].DepartureDate=moment(l).toDate(),n.flights[1].DepartureDateString=l}n.searchType="Normal",t.hasOutChanges(a)?t.flightsOutLoading(!0):t.flightsOutLoading(!1),t.hasInChanges(a)?t.flightsInLoading(!0):t.flightsInLoading(!1);var h=$("#manageBooking").find('input[name="__RequestVerificationToken"]').val();$.ajax({url:a.attr("action"),headers:{__RequestVerificationToken:h},data:JSON.stringify(n),type:a.attr("method"),dataType:"json",contentType:"application/json",success:function(i){if(i.Success===!1)$(".availabilityContainerWrapper").hide(),$("#change-date-error").html(i.Error).show();else{$(".availabilityContainerWrapper").show(),$("#change-date-error").hide();var n=i.availabilityTemplate;t.departureCity(n.DepartureCity),t.arrivalCity(n.ArrivalCity),t.boardDate(n.BoardDate),t.returnDate(n.ReturnDate),t.hasOutChanges(a)?(t.createCustomFields(n.OutAvailability),t.flightsOut(n.OutAvailability),0==n.OutAvailability.length&&t.showWarningMessage(e.translations.noOutgoingFlights)):t.flightsOut([]),t.hasInChanges(a)?(t.createCustomFields(n.InAvailability),t.flightsIn(n.InAvailability),0==n.InAvailability.length&&t.showWarningMessage(e.translations.noIngoingFlights)):t.flightsIn([]);var r=ezy.isScreenSize(["xs","sm"])?-60:-15,o=$(".headWrapper .container").height();r-=o,$(".availabilityContainerWrapper").velocity("scroll",{duration:500,offset:r})}},error:t.AvailabilityError,complete:function(){t.flightsOutLoading(!1),t.flightsInLoading(!1)}})},t};
ezy.views.changebooking.extrasInit=function(e,a){if("Extras"===e||"PayFareLock"===e||"Seat"===e||"MexicoDepartureTaxPage"===e){$("#additional-extras-loading").show();var o={locator:a.locator,isChangeBookingViewSeat:"Seat"===e};ezy.defaultAjax(a.pricingUrl,o).error(function(e){$("#additional-extras-loading").hide(),$.publish("payment/hideLoading"),$.publish("payment/showBookError",{Errors:[{ErrorDetail:e.responseText.substr(0,e.responseText.indexOf(",")).replace("{","").replace(/\"/g,"")}]})}).success(function(e){var o=window.ExtrasViewModel.getExtraByType("ExtrasPetTravel");o&&o.SetNumberOfAvailablePetOptions(e.PetsOnboardAvailability,e.PetsCargoAvailability),$.publish("bookingBasket/show",e.BookingBasketTemplateData),window.ExtrasViewModel.setAvailableExtras(e.AvailableExtras),$.publish("addextras/selectedFlights",[a.flights]),$.publish("payment/hideAndCloseAllPaymentOption"),$.publish("extras/slideDown"),window.ExtrasViewModel.setPreselected(),window.ExtrasViewModel.preselectMexicoDepartureTax()}),$.subscribe("extrasdetailschangebooking/commitChanges",function(){$.publish("extras/hideContinueButton"),$("#additional-payment-loading").show(),$.ajax({type:"POST",url:a.changeUrl,contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){1==e.HaveError?($("#additional-payment-loading").hide(),$.publish("payment/showBookError",e)):window.location.href=e.Url},error:function(e){$("#additional-payment-loading").hide(),$.publish("payment/showBookError",a.translations.errorMessages.bookingCanNotBeChanged),console.log(e)}})})}};
ezy.views.changebooking.additionalpayment=function(){var t={},n={},a={};return n.isAntiFraudScriptInitialized=!1,t.init=function(t){a=t,$.subscribe("change/commitchange",n.commitChange),$.subscribe("change/loadingpayment",n.loadingPayment),$.subscribe("change/hideloadingpayment",n.hideLoadingPayment),$.subscribe("change/showPaymentChangeBookingDate",n.showAdditionalPaymentInChangeBooking),$.subscribe("change/showAdditionalPayment",n.showAdditionalPayment),$("#additional-payment-form, #no-additional-payment-form").submit(function(t){t.preventDefault(),commandSender.send("paychanges",{})}),$("#payButton").click(function(){n.payButtonClick()}),"PayLandingPage"===a.currentView&&n.payButtonClick()},n.payButtonClick=function(){n.loadingPayment(),$.ajax({type:"POST",url:a.payPricingUrl,data:JSON.stringify({}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){null!=t.BookingBasketTemplateData&&$.publish("bookingBasket/show",t.BookingBasketTemplateData),n.showAdditionalPayment(t.TotalAmount)},error:function(t){n.hideLoadingPayment();var a=t.responseText;alert(a)}})},n.showAdditionalPaymentInChangeBooking=function(t,n){return $(".availabilityContainer .edit").on("click",function(){$(".payment-details").velocity("slideUp"),$.publish("payment/hideAndCloseAllPaymentOption")}),$("#change-flight-details .change-controls input[type=submit]").on("click",function(){$(".payment-details").velocity("slideUp"),$.publish("payment/hideAndCloseAllPaymentOption")}),$.publish("payment/show",a.currentView),!0},n.showAdditionalPayment=function(t){var e=function(){var e=parseFloat(t);$.publish("payment/setPaymentGroupVisibility"),$("#additional-payment-loading").hide(),$(".payment-details").show(),$("#payments").velocity("slideDown"),$("#payments .boxInner").hide(),n.sendAntiFraudData();var i=ezy.isScreenSize(["xs","sm"])?-60:-15,o=$(".headWrapper .container").height();i-=o,"PayLandingPage"!==a.currentView&&$("#payments").velocity("scroll",{duration:750,offset:i}),e>0?$("#payButton").hide():"Date"==a.currentView&&($(".payment").hide(),$.publish("payment/noAdditionalPayment"))};$.ajax({type:"POST",url:"/Payment/GetPaymentsActiveStatus",contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){void 0!==t.inactivePayments&&t.inactivePayments.length&&$(t.inactivePayments).each(function(){var t=this;n.hidePaymentByPaymentType(t)}),$(t.activePayments).each(function(){var t=this;n.showPaymentByPaymentType(t)});var a=$("#accertify-installments");if(a.length){var e=a.find(".paymentHead").attr("data-paymenttype");void 0!==t.inactivePayments&&-1!==$.inArray(e,t.inactivePayments)||n.setAccertifyInstallmentOptions()}var i=$("#viva-scotia-card");if(i.length){var o=i.find(".paymentHead").attr("data-paymenttype");void 0!==t.inactivePayments&&-1!==$.inArray(o,t.inactivePayments)||n.setVivaCardInstallmentOptions()}},complete:function(){var t=$("#payments .payment:not(.inactive) .paymentHead").map(function(){return $(this).attr("data-paymenttype")}).get();n.setPaymentHeaderAmounts(e,t)}})},n.sendAntiFraudData=function(){"undefined"!=typeof _cc&&n.isAntiFraudScriptInitialized===!1&&void 0!==initializeAntiFraudScript&&(initializeAntiFraudScript(),n.isAntiFraudScriptInitialized=!0)},n.hidePaymentByPaymentType=function(t){var n=$('.paymentHead[data-paymenttype="'+t+'"]');n.length&&(n.parent().hide(),n.parent().addClass("inactive"))},n.showPaymentByPaymentType=function(t){var n=$('.paymentHead[data-paymenttype="'+t+'"]');n.length&&(n.parent().show(),n.parent().removeClass("inactive"))},n.setAccertifyInstallmentOptions=function(){$.ajax({type:"POST",url:"/Payment/GetActiveAccertifyInstallmentOptions",contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(void 0!==t.activeOptions&&$("#AccertifyInstallmentsPayment_Installments").length){$("#AccertifyInstallmentsPayment_Installments").html("");var n=$("#AccertifyInstallments_MonthsWithoutInterest").val(),a=$("#AccertifyInstallments_MonthsWithoutInterest18").val();$(t.activeOptions).each(function(t,e){18===e?$("#AccertifyInstallmentsPayment_Installments").append('<option value="'+e+'">'+a+"</option>"):$("#AccertifyInstallmentsPayment_Installments").append('<option value="'+e+'">'+e+" "+n+"</option>")})}}})},n.setVivaCardInstallmentOptions=function(){$.ajax({type:"POST",url:"/Payment/GetVivaCardInstallmentOptions",contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){var n=$("#VivaScotiaCardPayment_Installments");if(n.length&&void 0!==t.options){n.html("");var a=$("#VivaScotiaCardPayment_OneMonthWithOutInterestTranslation").val(),e=$("#VivaScotiaCardPayment_MonthsWithOutInterestTranslation").val();n.append('<option value="1">'+a+"</option>"),$(t.options).each(function(t,a){n.append('<option value="'+a+'">'+a+" "+e+"</option>")})}}})},n.setPaymentHeaderAmounts=function(t,n){var a={AccertifyPayNowSelectedCard:$("#AccertifyPayNowPayment_PaymentForm").val(),AccertifyInstallmentsSelectedCard:$("#AccertifyInstallmentsPayment_PaymentForm").val(),AccertifyInstallmentsSelectedInstallment:$("#AccertifyInstallmentsPayment_Installments").val(),BanamexDebitCardSelectedCard:$("#BanamexDebitCardPayment_PaymentForm").val(),PaymentNames:n};$.ajax({type:"POST",url:"/Payment/GetPaymentAmounts",contentType:"application/json; charset=utf-8",data:JSON.stringify(a),dataType:"json",success:function(t){void 0!==t.paymentAmounts&&$.each(t.paymentAmounts,function(t,n){var a=$('#payments .paymentHead[data-paymenttype="'+t+'"] .paymentAmount');a.length&&a.html(n)})},complete:t})},n.commitChange=function(t,n){$.ajax({type:"POST",url:a.commitUrl,data:n,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){1==t.HaveError?($.publish("payment/hideLoading"),$.publish("payment/showBookError",t)):window.location.href=t.Url},error:function(t){$.publish("payment/hideLoading"),$.publish("payment/showBookError",{Errors:[{ErrorDetail:t.responseText.substr(0,t.responseText.indexOf(",")).replace("{","").replace(/\"/g,"")}]})}})},n.loadingPayment=function(){$("#payButton").html(a.translations.pleaseWaitButton+"<i></i>"),$("#payButton").attr("disabled","disabled"),$("#additional-payment-loading").show(),$("#changeBooking").hide()},n.hideLoadingPayment=function(){$("#payButton").html(a.translations.payTextButton+"<i></i>"),$("#payButton").removeAttr("disabled")},t};
ezy.views.changebooking.passengerdetails=function(){var e={},n={},a={};return n.requiresPayment=!0,e.init=function(e){a=e,$("#payButton").hide(),n.setValidation(),n.setEvents();var i=ezy.isScreenSize(["xs","sm"])?-60:-15,t=$(".headWrapper .container").height();i-=t,$(".passenger-details.booking-part").velocity("scroll",{duration:750,offset:i})},n.setValidation=function(){$("#change-passenger-details").validate({submitHandler:function(e){var i=$(e).find("input, select"),t={};i.each(function(){var e=$(this);t[e.attr("name")]=e.val()}),$.publish("change/loadingpayment"),n.disableInputs(),n.requiresPayment=!0,$.ajax({type:"POST",url:$(e).attr("action"),data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.AllowedToChange===!1?(a.errorContainer.append("<ul><li>"+a.translations.YouCantChangeAfterDeparture+"</li></ul>"),a.errorContainer.show(),$("#additional-payment-loading").hide(),$(".passenger-details .headline .edit").click()):(n.requiresPayment=e.RequiresPayment,e.Success===!1?($("#additional-payment-loading").hide(),void 0!==e.Errors?n.handleError(e):(a.errorContainer.append("<ul><li>"+a.translations.ChangePassengerDetailsError+"</li></ul>"),a.errorContainer.show()),$(".passenger-details .headline .edit").click()):e.RequiresPayment===!1?(n.showEditPassengers(),$("#additional-payment-loading").hide(),$.publish("bookingBasket/show",e.BookingBasketTemplateData),$.publish("changebooking/showPerformChangeContainer")):(n.showEditPassengers(),$.publish("bookingBasket/show",e.BookingBasketTemplateData),$.publish("change/showAdditionalPayment",e.AmountToPay)))}})},errorClass:"error",wrapper:"li",errorContainer:"#passanger-details-error",errorLabelContainer:"#passanger-details-error ul"})},n.disableInputs=function(){$(".passenger-information input").attr("disabled","disabled")},n.enableInputs=function(){$(".passenger-information input").removeAttr("disabled")},n.showEditPassengers=function(){$(".passenger-details .headline .edit").show()},n.hideEditPassengers=function(){$(".passenger-details .headline .edit").hide()},n.setEvents=function(){$.subscribe("changebooking/commitChanges",n.commitChanges),$("#changeBooking").click(function(){$("#btnChangeBooking").click()}),commandSender.addHandler("paychanges",function(e){$.ajax({type:"POST",url:"/mybooking/changepassengerdetails?locator="+a.locator+"&digest="+a.digest,data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(){location.reload()}})}),$(".passenger-details .headline .edit").click(function(){$.ajax({type:"POST",url:"/mybooking/ClearBookingBasket",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){$.publish("bookingBasket/show",e.BookingBasketTemplateData)}}),$.publish("payment/hideAndCloseAllPaymentOption"),$.publish("changebooking/hidePerformChangeContainer"),n.hideEditPassengers(),n.enableInputs(),$(".change-controls #changeBooking").show()})},n.commitChanges=function(){$("#additional-payment-loading").show(),$.publish("changebooking/hidePerformChangeContainer"),$.ajax({type:"POST",url:a.commitUrl,contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.Errors.length>0?($("#additional-payment-loading").hide(),n.handleError(e),n.requiresPayment===!1&&$.publish("changebooking/showPerformChangeContainer")):window.location.href=e.Url},error:function(e){$("#additional-payment-loading").hide(),n.handleError({Errors:[{ErrorDetail:e.responseText.substr(0,e.responseText.indexOf(",")).replace("{","").replace(/\"/g,"")}]}),n.requiresPayment===!1&&$.publish("changebooking/showPerformChangeContainer")}})},n.handleError=function(e){$("#passanger-details-error ul").html(""),$.each(e.Errors,function(e,n){$("#passanger-details-error ul").append("<li>"+n.ErrorDetail+"</li>")}),$("#passanger-details-error").show(),$("#passanger-details-error ul").show(),$("#passanger-details-error")[0].scrollIntoView()},e};

ezy.views.flight.passengerPassportdetails={},ezy.views.flight.passengerPassportdetails.index=function(){var e,t={},a={};return a.init=function(a){e=a,t.isAutoCompleteDone=!1,t.setValidation(),t.bindEvents(),$("#btnSavePassengerDetails").click(function(){$("#passengerDetailsInfo").hide(),$("#btnSavePaxDetails").click()})},t.setValidation=function(){var a=!1,r=function(e,t){$(e).rules("add",{notEqual:"0",messages:{notEqual:t}})};e.form.find("input").each(function(){try{$(this)[0].form=e.form[0]}catch(t){}}),e.form.validate({submitHandler:function(a){if($(".duplicate-ktn-number:visible").length>0||$(".duplicate-passport-number:visible").length>0)return $("html, body").animate({scrollTop:$("#passengerDetailsError").offset().top-75},500),!1;if(!$(a).valid()){try{dataLayer.push({event:"Error",errtype:"Passenger",errdetail:"Validation Failed"})}catch(r){}return 0==jQuery.fn.placeholder.input&&($(".passengerDetails [placeholder]").trigger("blur.placeholder"),$("#btnSavePassengerDetails").focus()),!1}if(""===e.stateHidden.val())return e.state.addClass("error"),$("#passengerDetailsError").html("<ul><li>"+e.localization.ChooseStateText+"</li></ul>").show(),!1;var s=e.form.serializeObject();s["Passengers[0].mobile"]=$("#mobile").intlTelInput("getNumber"),s["Passengers[0].phone"]=$("#phone").intlTelInput("getNumber");var n=JSON.stringify(s);return $("#passengerDetailsInfo").hide(),$("#passengerDetailsError").hide(),$("#btnSavePassengerDetails button").prop("disabled",!0),$("#submitLoader").show(),$.ajax({type:"POST",url:"/PassengerPassportDetailsPart/PostAsync",data:n,contentType:"application/json; charset=utf-8",dataType:"json",error:function(a){t.showError(e.localization.AjaxRequestError)},success:function(a){0==a.result?a.duplicatePassport?t.showError(e.localization.PassportNumbersShouldBeUniqueText):a.duplicateKtn?t.showError(e.localization.KTNNumbersShouldBeUniqueText):($("#passengerDetailsInfo").hide(),t.showError(e.localization.AjaxRequestError),location.reload(!0)):($("#passengerDetailsInfo").html("<ul><li>"+e.localization.SuccessfullySavedMessageText+"</li></ul>").show(),$("body,html").animate({scrollTop:$("#passengerDetailsInfo").offset().top-75},800))},complete:function(e){$("#btnSavePassengerDetails button").prop("disabled",!1),$("#submitLoader").hide()}}),!1},debug:!0,rules:{},ignore:":hidden:not(.dob, .passportExpiryDate)",messages:{},errorContainer:"#passengerDetailsError",errorLabelContainer:"#passengerDetailsError ul",wrapper:"li",invalidHandler:function(e,t){t.numberOfInvalids()&&(a=!0)},showErrors:function(e,t){t.length>0&&$("#passengerDetailsInfo").hide(),this.defaultShowErrors(),($(".duplicate-ktn-number:visible").length>0||$(".duplicate-passport-number:visible").length>0)&&($("#passengerDetailsInfo").hide(),$("#passengerDetailsError ul").show(),$("#passengerDetailsError").show()),a&&$("html, body").animate({scrollTop:$("#passengerDetailsError").offset().top-75},500),a=!1}}),e.state.each(function(t,a){r(a,e.localization.StateRequired)}),e.country.each(function(t,a){r(a,e.localization.CountryRequired)}),e.nationalitySelect.each(function(t,a){r(a,e.localization.NationalityRequired)}),e.name.each(function(t,a){$(a).rules("add",{required:!0,minlength:2,noDigits:!0,nameContainsDot:!0,messages:{required:e.localization.FullNameRequired,minlength:e.localization.FullNameRequired,noDigits:e.localization.FullNameRequired,nameContainsDot:e.localization.DotNotAllowedInName}})}),jQuery.validator.addMethod("nameContainsDot",function(e,t){return!e.match(/\./g)},"Your username contains a dot!"),$(".passportExpiryDate").each(function(t,a){$(a).rules("add",{passportExpiryDateValidation:!0,messages:{passportExpiryDateValidation:e.localization.PassportExpiredText}})}),$.validator.addMethod("passportExpiryDateValidation",function(t,a){if($(a).closest(".passportDetails").is(":hidden"))return!0;var r=moment(t,"YYYY-MM-DD");return r>=e.passportExpiryDate},e.localization.PassportExpiredText),$(e.email).each(function(t,a){-1!==$(a).attr("name").indexOf("[0]")&&$(a).rules("add",{required:!0,messages:{required:e.localization.EmailValid}}),$(a).rules("add",{email:!0,messages:{email:e.localization.EmailValid}})}),$(e.repeatEmail).each(function(t,a){-1!=$(a).attr("name").indexOf("[0]")&&$(a).rules("add",{required:!0,messages:{required:e.localization.EmailValid}}),$(a).rules("add",{email:!0,equalTo:$(a).closest(".row").find(".email"),messages:{email:e.localization.EmailValid,equalTo:e.localization.RepeatEmailValid}})}),$(e.mobile).each(function(t,a){-1!==$(a).attr("name").indexOf("[0]")&&$(a).rules("add",{phoneNumber:!0,messages:{phoneNumber:e.localization.MobileValid}})}),$(e.phone).each(function(t,a){-1!==$(a).attr("name").indexOf("[0]")&&$(a).rules("add",{required:!0,phoneNumber:!0,messages:{required:e.localization.PhoneValid,phoneNumber:e.localization.PhoneValid}})}),e.day.each(function(t,a){$(a).rules("add",{notEqual:"0",messages:{notEqual:e.localization.DayRequired}})}),e.year.each(function(t,a){$(a).rules("add",{notEqual:"0",messages:{notEqual:e.localization.YearRequired}})}),e.month.each(function(t,a){$(a).rules("add",{notEqual:"0",messages:{notEqual:e.localization.MonthRequired}})}),$(".dob").each(function(t,a){var r=$(this).attr("type"),s="INF"!==r&&"CHD"!==r,n=e.isInternationalFlight===!0||e.dateOfBirthRequiredForAdults===!0&&window.changePassengerDetailsViewModel.showAdultDateOfBirth()===!0;(s===!1||s&&n)&&($(a).rules("add",{DOBRequired:!0,messages:{DOBRequired:e.localization.DobRequired}}),$(a).rules("add",{DOBAfterDeparture:!0,messages:{DOBAfterDeparture:e.localization.DobIsAfterDeparture}})),"INF"===r&&$(a).rules("add",{CheckInfantDOB:!0,messages:{CheckInfantDOB:e.localization.InfantAgeOutsideRange}})}),$.validator.addMethod("travelWith",function(t){var a=[];e.travelWith.each(function(){var e=parseFloat($(this).val());e>=0&&a.push(e)});var r=!a.CheckForDuplicates(t);return r&&(e.travelWith.removeClass("error"),$("#passengerDetailsError").hide(),$("#passengerDetailsError label[for*='travelWith']").filter(":visible").css("display","none")),r},e.localization.TravelWithDuplicates),$.validator.addMethod("DOBRequired",function(e,t){var a=e.split("-"),r=parseInt(a[2]),s=parseInt(a[1]),n=parseInt(a[0]);return 0!==r&&!isNaN(r)&&0!==s&&!isNaN(s)&&0!==n&&!isNaN(n)},e.localization.DobRequired),$.validator.addMethod("DOBAfterDeparture",function(t,a){var r=moment(e.dateToCompareDOBWith),s=t.split("-"),n=parseInt(s[2]),o=parseInt(s[1])-1,i=parseInt(s[0]),l=moment().set({year:n,month:o,date:i});return r>=l},e.localization.DobIsAfterDeparture),$.validator.addMethod("CheckInfantDOB",function(t,a){var r=moment(e.dateToCompareDOBWith),s=t.split("-"),n=parseInt(s[2])+2,o=parseInt(s[1])-1,i=parseInt(s[0]),l=moment().set({year:n,month:o,date:i});return l.diff(r)>=0},e.localization.InfantAgeOutsideRange),jQuery.validator.classRuleSettings.travelWith={travelWith:!0},e.travelWith.each(function(t,a){$(a).rules("add",{notEqual:"-1",messages:{notEqual:e.localization.TravelWithRequired}})}),$(e.passportNumber).each(function(t,a){$(a).rules("add",{isValidPassportNumber:!0,messages:{isValidPassportNumber:e.localization.InvalidPassportNumber}})}),$(e.ktnNumber).each(function(t,a){$(a).rules("add",{isValidKtnNumber:!0,messages:{isValidKtnNumber:e.localization.InvalidKnownTravelerNumberText}})}),$.validator.addMethod("isValidKtnNumber",function(e,t){if($(this).closest(".passportDetails").is(":hidden"))return!0;var a=new RegExp("^[0-9]{9,10}$");return a.test(e)},e.localization.InvalidKnownTravelerNumberText),$.validator.addMethod("isValidPassportNumber",function(e,t){if($(this).closest(".passportDetails").is(":hidden"))return!0;var a=new RegExp("^[0-9a-zA-Z]{7,10}$");return a.test(e)},e.localization.InvalidPassportNumber)},t.validateDuplicateTravelDocuments=function(){t.validateDocumentByType(".ktn-number","duplicate-ktn-number"),t.validateDocumentByType(".passport-number","duplicate-passport-number"),$("#passengerDetailsError ul .duplicate-ktn-error").remove(),$("#passengerDetailsError ul .duplicate-passport-error").remove(),$(".duplicate-passport-number:visible").length>0&&$("#passengerDetailsError ul").append('<li class="duplicate-passport-error">'+e.localization.PassportNumbersShouldBeUniqueText+"</li>"),$(".duplicate-ktn-number:visible").length>0&&$("#passengerDetailsError ul").append('<li class="duplicate-ktn-error">'+e.localization.KTNNumbersShouldBeUniqueText+"</li>");var a=$("#passengerDetailsError  li").filter(function(){return"none"!==this.style.display}).length;0==a?($("#passengerDetailsError ul").hide(),$("#passengerDetailsError").hide()):($("#passengerDetailsError ul").show(),$("#passengerDetailsError").show())},t.validateDocumentByType=function(e,t){var a=[];$(e+":visible").each(function(){a.push($(this).val().trim().toLowerCase())}),$(e+":visible").each(function(){var e=$(this).val().trim().toLowerCase();if(""===e)return $(this).removeClass(t),!0;var r=a.filter(function(t){return t===e}).length;r>1?$(this).addClass(t):$(this).removeClass(t)})},t.IsNumeric=function(e){return/^\d+$/.test(e)},t.bindEvents=function(){e.addDocumentButton.on("click",function(e){t.UpdateErrorsAfterVisibilityChange()}),$(document).on("click",e.removeDocumentButton,function(){t.UpdateErrorsAfterVisibilityChange()}),e.mobile.on("change",function(){var t=e.mobile.intlTelInput("getSelectedCountryData");""===e.phone.val()&&e.phone.intlTelInput("selectCountry",t.iso2)}),$(document).on("focusout",".passport-number",function(){t.validateDuplicateTravelDocuments()}),$(document).on("focusout",".ktn-number",function(){t.validateDuplicateTravelDocuments()}),e.phone.on("change",function(){var t=e.phone.intlTelInput("getSelectedCountryData");""===e.mobile.val()&&e.mobile.intlTelInput("selectCountry",t.iso2)}),e.email.bind("copy cut",function(e){return!1}),e.repeatEmail.bind("paste",function(e){return!1}),e.email.on("blur",function(){$(this).mailcheck({domains:e.mailcheck.domains,secondLevelDomains:e.mailcheck.secondLevelDomains,topLevelDomains:e.mailcheck.topLevelDomains})}),e.documentType.on("change",function(){t.UpdateErrorsAfterVisibilityChange()}),e.passportIncludeOption.on("change",function(){t.UpdateErrorsAfterVisibilityChange()})},t.UpdateErrorsAfterVisibilityChange=function(){setTimeout(function(){t.validateDuplicateTravelDocuments(),$(".ktn-number:hidden").each(function(){$("#passengerDetailsError label[for*='"+$(this).attr("id")+"']").parent().hide()}),$(".passport-number:hidden").each(function(){$("#passengerDetailsError label[for*='"+$(this).attr("id")+"']").parent().hide()}),$(".ktn-number:visible").each(function(){$(this).hasClass("error")&&$("#passengerDetailsError label[for*='"+$(this).attr("id")+"']").parent().show()}),$(".passport-number:visible").each(function(){$(this).hasClass("error")&&$("#passengerDetailsError label[for*='"+$(this).attr("id")+"']").parent().show()});var e=$("#passengerDetailsError  li").filter(function(){return"none"!==this.style.display}).length;e>0?($("#passengerDetailsError ul").show(),$("#passengerDetailsError").show()):$("#passengerDetailsError").hide()},500)},t.getAdult1FirstName=function(){for(var e="",a=t.passengers.length,r=0;a>r;r++){var s=t.passengers[r].type;if("CHD"!=s&&"INF"!=s){e=t.passengers[r].firstName;break}}return e},t.clearPlaceholder=function(e,t){var a=this,r=$(a);if(a.value==r.attr("placeholder")&&r.hasClass("placeholder"))if(r.data("placeholder-password")){if(r=r.hide().next().show().attr("id",r.removeAttr("id").data("placeholder-id")),e===!0)return r[0].value=t;r.focus()}else a.value="",r.removeClass("placeholder"),a==document.activeElement&&a.select()},t.showError=function(e){$("#passengerDetailsError ul").html(""),$("#passengerDetailsError ul").append("<li>"+e+"</li>"),$("#passengerDetailsError").show(),$("#passengerDetailsError ul").show(),$("#passengerDetailsError")[0].scrollIntoView()},a},Array.prototype.CheckForDuplicates=function(e){for(var t=this,a=[],r=0;r<t.length;r++)e==t[r]&&a.push(r);return a.length>1};var PassengerPassportDetailsModel=function(e,t,a,r,s,n,o,i,l,u){var c={},p={},d=0,m=0,h=0,b=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],y=[1,2,3,4,5,6,7,8,9,10,11,12];return c.translations=t||{},c.familyMembers=ko.observableArray([]),c.countries=ko.observableArray([]),c.availableTravelDocumentCount=u.length,c.availableTravelDocuments=ko.observableArray([]),p.init=function(){var e=c.initViewModel();return e},c.initViewModel=function(){var t={};if(t.passengers=ko.observableArray([]),t.passengerNumbers=ko.computed(function(){var e=[];return $.each(t.passengers(),function(){this.passengerNumber()>=0&&this.type()!==ezy.PaxTypes.Infant&&e.push(this.passengerNumber())}),e}),t.message=ko.observable(""),null!=r&&$.each(r,function(){c.familyMembers.push(c.member(this))}),null!=a){var s=$.grep(a,function(e){return"MX"===e.Code})[0],n=$.grep(a,function(e){return"US"===e.Code})[0];c.countries.push(c.country(s)),c.countries.push(c.country(n)),$.each(a,function(){c.countries.push(c.country(this))})}return null!=u&&$.each(u,function(){c.availableTravelDocuments.push(c.travelDocumentType(this))}),$.each(e,function(){var e=c.passenger(this);t.passengers.push(e)}),t.save=function(){t.message(ko.toJSON(t))},t.selectMexico=function(){var e=$.grep(c.countries(),function(e){return"MX"===e.code});1===e.length&&this.passengers()[0].selectedCountry(e[0])},t.selectMexicoForIssuingCountry=function(){var e=$.grep(c.countries(),function(e){return"MX"===e.code});1===e.length&&ko.utils.arrayForEach(this.passengers(),function(t){t.selectedIssuingCountry(e[0])})},t.noSidePadding=ko.computed(function(){$(window).width();return $(window).width()>767&&$(window).width()<1200?!0:void 0}),t.showAdultDateOfBirth=ko.observable(!!i),t.useSameAddressForAllPassengers=ko.observable(!1),t.useSameAddressForAllPassengers.subscribe(function(e){if(e===!0){var a=t.passengers()[0];$.each(window.changePassengerDetailsViewModel.passengers(),function(e){0!==e&&(this.addedPassportDetails("true"),this.addedDestinationDetails("true"),this.destinationAddress(a.destinationAddress()),this.destinationCity(a.destinationCity()),this.destinationZip(a.destinationZip()),this.selectedDestinationCountry(a.selectedDestinationCountry()),this.selectedDestinationState(a.selectedDestinationState()),this.selectedDestinationStateObject(a.selectedDestinationState()))})}}),t},c.showError=function(e){$("#passengerDetailsError ul").html("");var t=$.unique(e);$.each(t,function(e,t){$("#passengerDetailsError ul").append("<li>"+t+"</li>")}),$("#passengerDetailsError").show(),$("#passengerDetailsError ul").show(),$("#passengerDetailsError")[0].scrollIntoView()},c.country=function(e){var t={};return t.name=e.Name,t.code=e.Code,t},c.travelDocumentType=function(e){var t={};return t.name=e.Name,t.code=e.Code,t},c.member=function(e){var t={};return t.FullName=e.FirstName+" "+e.LastName,t.FirstName=e.FirstName,t.LastName=e.LastName,t.CustomerNumber=e.CustomerNumber,t.PersonId=e.PersonId,t},c.state=function(e,t){var a={};return a.name=t,a.code=e,a},c.removeSpecialChars=function(e){return e=e.replace("é","e"),e=e.replace("É","E"),e=e.replace("è","e"),e=e.replace("È","E"),e=e.replace("ê","e"),e=e.replace("Ê","E"),e=e.replace("ë","e"),e=e.replace("Ë","E"),e=e.replace("í","i"),e=e.replace("Í","I"),e=e.replace("ì","i"),e=e.replace("Ì","I"),e=e.replace("î","i"),e=e.replace("Î","I"),e=e.replace("ï","i"),e=e.replace("Ï","I"),e=e.replace("ö","o"),e=e.replace("Ö","O"),e=e.replace("ó","o"),e=e.replace("Ó","O"),e=e.replace("ò","o"),e=e.replace("Ò","O"),e=e.replace("ô","o"),e=e.replace("Ô","O"),e=e.replace("ø","o"),e=e.replace("Ø","O"),e=e.replace("œ","oe"),e=e.replace("Œ","OE"),e=e.replace("ü","u"),e=e.replace("Ü","U"),e=e.replace("ú","u"),e=e.replace("Ú","U"),e=e.replace("ù","u"),e=e.replace("Ù","U"),e=e.replace("û","u"),e=e.replace("Û","U"),e=e.replace("ñ","n"),e=e.replace("Ñ","N"),e=e.replace("ç","c"),e=e.replace("Ç","C"),e=e.replace("ß","ss"),e=e.replace("ð","d"),e=e.replace("Ð","D"),e=e.replace("ý","y"),e=e.replace("Ý","Y"),e=e.replace("þ","th"),e=e.replace("Þ","TH"),e=e.replace("ÿ","y"),e=e.replace("ª","a"),e=e.replace("æ","ae"),e=e.replace("Æ","AE"),e=e.replace("å","a"),e=e.replace("Å","A"),e=e.replace("ä","a"),e=e.replace("Ä","A"),e=e.replace("á","a"),e=e.replace("Á","A"),e=e.replace("à","a"),e=e.replace("À","A"),e=e.replace("â","a"),e=e.replace("Â","A"),e=e.replace("ã","a"),e=e.replace("Ã","A"),e.replace(/[^a-zA-Z ]/g,"").toUpperCase()},c.travelDocument=function(e){var t={};return null!==e&&void 0!==e?(t.documentType=ko.observable(e.DocumentType),t.passportNumber=ko.observable(e.PassportNumber),t.knownTravelerNumber=ko.observable(e.KnownTravelerNumber),t.redressNumber=ko.observable(e.RedressNumber),t.expiryDay=ko.observable(e.ExpiryDay),t.expiryMonth=ko.observable(e.ExpiryMonth),t.expiryYear=ko.observable(e.ExpiryYear),t.selectedIssuingCountry=ko.observable(e.IssuingCountry),t.selectedBirthCountry=ko.observable(e.CountryOfBirth)):(t.documentType=ko.observable(),t.passportNumber=ko.observable(),t.knownTravelerNumber=ko.observable(),t.redressNumber=ko.observable(),t.expiryDay=ko.observable(),t.expiryMonth=ko.observable(),t.expiryYear=ko.observable(),t.selectedIssuingCountry=ko.observable(),t.selectedBirthCountry=ko.observable()),t},c.passenger=function(e){var a={};a.travelDocuments=ko.observableArray([]),$.each(e.TravelDocuments,function(e){var t=c.travelDocument(this);a.travelDocuments.push(t)}),a.firstName=ko.observable(e.FirstName),a.lastName=ko.observable(e.LastName),a.customerNumber=ko.observable(e.CustomerNumber),a.personId=ko.observable(e.PersonId),a.firstNameDisabled=ko.observable(!1),a.lastNameDisabled=ko.observable(!1),a.hasIncompleteVivaFanProfile=ko.observable(!1),a.fullName=ko.computed(function(){return c.removeSpecialChars(a.firstName()+" "+a.lastName())},this),a.getDocumentOptions=function(e,t){var r=ko.observableArray();ko.utils.arrayForEach(a.travelDocuments(),function(e,a){t!==e.documentType()&&r.push(e.documentType())});var s=ko.observableArray();return ko.utils.arrayForEach(c.availableTravelDocuments(),function(e,t){-1===r.indexOf(e.code)&&s.push(e)}),s},a.initials=function(){try{return c.removeSpecialChars(a.firstName()).substring(0,1).toUpperCase()+c.removeSpecialChars(a.lastName()).substring(0,1).toUpperCase()}catch(e){return""}},a.type=ko.observable(e.Type),a.typeTranslation=ko.computed(function(){return a.type()===ezy.PaxTypes.Adult?c.translations.AdultType:a.type()===ezy.PaxTypes.Child?c.translations.ChildType:a.type()===ezy.PaxTypes.Infant?c.translations.InfantType:a.type()},this),a.typeBase=ko.computed(function(){return a.type()!==ezy.PaxTypes.Child&&a.type()!==ezy.PaxTypes.Infant&&a.type()!==ezy.PaxTypes.Comp?"Adults":a.type()===ezy.PaxTypes.Child?"Children":a.type()===ezy.PaxTypes.Infant?"Infants":void 0},this),a.typeValidation=ko.computed(function(){return a.type()!==ezy.PaxTypes.Child&&a.type()!==ezy.PaxTypes.Infant&&a.type()!==ezy.PaxTypes.Comp?c.translations.CompleteTextAdult:a.type()===ezy.PaxTypes.Child?c.translations.CompleteTextChild:"INF"===a.type()?c.translations.CompleteTextInfant:void 0},this),a.typeNumber=ko.computed(function(){return a.type()!==ezy.PaxTypes.Child&&a.type()!==ezy.PaxTypes.Infant&&a.type()!==ezy.PaxTypes.Comp?(d++,d):a.type()===ezy.PaxTypes.Child?(m++,m):a.type()===ezy.PaxTypes.Infant?(h++,h):1},this),a.email=ko.observable(e.Email),a.repeatemail=ko.observable(e.Email),a.mobile=ko.observable(e.Mobile),a.phone=ko.observable(e.Phone),a.handicap=ko.observable(e.Handicap),a.handicap.subscribe(function(){window.ExtrasViewModel.seating.HandleBlockedSeatsForPassengerAndFlight(a.passengerNumber())}),a.emailOptIn=ko.observable(e.EmailOptIn),a.states=ko.observableArray([]),a.statesDestination=ko.observableArray([]),a.familyMembers=ko.observableArray(c.familyMembers()),a.country=ko.observableArray(c.countries()),a.gender=ko.observable(e.Gender),a.passengerNumber=ko.observable(e.PassengerNumber),a.travelWith=ko.observable(void 0==e.TravelWith&&e.Type==ezy.PaxTypes.Infant?a.typeNumber()-1:e.TravelWith-1),a.wrongDay=ko.observable(!1),a.wrongMonth=ko.observable(!1),a.wrongDate=ko.computed(function(){return a.wrongDay()||a.wrongMonth()},a),a.wrongDateErrors=ko.observableArray(),a.Day=ko.observable(e.Day),a.Month=ko.observable(e.Month),a.Year=ko.observable(e.Year),a.ShowDateOfBirth=ko.observable(!1),a.SetShowDateOfBirth=function(){var e=void 0!==a.Day()&&void 0!==a.Month()&&void 0!==a.Year();e===!0?a.ShowDateOfBirth(!0):a.ShowDateOfBirth(!1)},a.SetShowDateOfBirth(),a.Day.subscribe(function(){a.SetShowDateOfBirth()}),a.Month.subscribe(function(){a.SetShowDateOfBirth()}),a.Year.subscribe(function(){a.SetShowDateOfBirth()}),a.selectedHandicap=ko.observable(e.HandicapSsr),a.selectedHandicap.subscribe(function(e){window.ExtrasViewModel.seating&&window.ExtrasViewModel.seating.HandleBlockedSeatsForPassengerAndFlight(a.passengerNumber())}),a.dateOfBirthDayOptions=ko.computed(function(){a.wrongDay(!1);var e=parseInt(a.Day()),t=parseInt(a.Month())-1,r=parseInt(a.Year()),i=b,l=moment().set({year:r,month:t});if(0>=t||isNaN(t)||0>=r||isNaN(r))return i;i=i.slice(0,l.daysInMonth());var u=!1,p=!1;if(void 0!==o&&void 0!==s&&void 0!==n&&(a.type()===ezy.PaxTypes.Child||a.type()===ezy.PaxTypes.Infant)){var d=a.type()===ezy.PaxTypes.Child?moment(s):moment(o),m=a.type()===ezy.PaxTypes.Child?moment(n):moment(s);r<=m.year()&&t<=m.month()?(i=i.slice(m.date()-1),u=!0):r>=d.year()&&t>=d.month()&&(i=i.slice(0,d.date()-1),p=!0)}if(e>0||!isNaN(e)){var h=ko.utils.arrayFirst(i,function(t){return e===t});h?a.wrongDay(!1):(u?a.Day(i[i.length-1]):u||p||a.Day(1),a.wrongDate()||a.type()!==ezy.PaxTypes.Child&&a.type()!==ezy.PaxTypes.Infant||(u?a.Month(2):a.Month(1),a.wrongDay(!0),a.wrongDateErrors.push(c.translations.AgeOutsideRange+a.typeTranslation()+" "+a.typeNumber()),c.showError(a.wrongDateErrors())))}return i},a),a.dateOfBirthMonthOptions=ko.computed(function(){a.wrongMonth(!1);var e=parseInt(a.Day()),t=parseInt(a.Month()),r=parseInt(a.Year()),i=y;if(0>=r||isNaN(r))return i;var l=!1,u=!1;if(void 0!==o&&void 0!==s&&void 0!==n&&(a.type()===ezy.PaxTypes.Child||a.type()===ezy.PaxTypes.Infant)){var p=a.type()===ezy.PaxTypes.Child?moment(s):moment(o),d=a.type()===ezy.PaxTypes.Child?moment(n):moment(s);r<=d.year()?(i=i.slice(d.month()),u=!0,l=!0):r>=p.year()&&(i=i.slice(0,p.month()+1),l=!0)}if(l&&(t>0||!isNaN(t))&&(e>0||!isNaN(e))){var m=ko.utils.arrayFirst(i,function(e){return t===e});m?a.wrongMonth(!1):a.wrongDate()||(u&&a.Month(2),a.wrongMonth(!0),a.wrongDateErrors.push(c.translations.AgeOutsideRange+a.typeTranslation()+" "+a.typeNumber()),c.showError(a.wrongDateErrors()))}return i},a),a.dateOfBirthYearOptions=ko.computed(function(){var e=[];if(void 0===o||void 0===s||void 0===n||a.type()!==ezy.PaxTypes.Child&&a.type()!==ezy.PaxTypes.Infant)for(var t=moment(o),r=1900;r<=t.year()-12;r++)e.push(r);else for(var t=a.type()===ezy.PaxTypes.Child?moment(s):moment(o),i=a.type()===ezy.PaxTypes.Child?moment(n):moment(s),r=i.year();r<=t.year();r++)e.push(r);return e=e.sort(function(e,t){return t>e?1:-1})},a),a.addedPassportDetails=ko.observable("true"),a.addedDestinationDetails=ko.observable(l===!0?"true":null!==e.DestinationAddress?"true":"false"),a.mexicanResident=ko.observable("MX"===e.CountryOfResidence?"true":"false"),a.getCountryDataRequest=function(t){t&&ezy.defaultAjax("/PassengerPassportDetailsPart/GetCountryData",{country:t},function(t){a.states(t),a.selectedState(e.State)})};var r=a.country()[0];return a.selectedCountry=ko.observable(r),a.getCountryDataRequest(r?r.code:null),a.selectedCountry.subscribe(function(e){a.getCountryDataRequest(e.code),$("#phone").intlTelInput("selectCountry",e.code),$("#mobile").intlTelInput("selectCountry",e.code)}),a.selectedStateCode="",a.selectedState=ko.observable(e.State),a.selectedMember=ko.observable(void 0),a.selectedNationality=ko.observable(e.Nationality),a.destinationAddress=ko.observable(e.DestinationAddress),a.destinationCity=ko.observable(e.DestinationCity),a.destinationZip=ko.observable(e.DestinationZip),a.selectedDestinationState=ko.observable(),a.selectedDestinationStateObject=ko.observable(void 0),a.selectedDestinationCountry=ko.observable(),a.selectedDestinationCountry.subscribe(function(t){var r=$.grep(a.country(),function(e){return e.code===t})[0];void 0!=r&&ezy.defaultAjax("/PassengerPassportDetailsPart/GetCountryData",{country:r.code},function(t){a.statesDestination(t),null!==e.DestinationAddress?a.selectedDestinationState(e.DestinationState):a.selectedDestinationState(a.selectedDestinationStateObject())})}),a.selectedDestinationCountry(e.DestinationCountry),a.selectedMember.subscribe(function(){var e=a.selectedMember();void 0!=e&&(a.firstName(e.FirstName),a.lastName(e.LastName),a.customerNumber(e.CustomerNumber),a.personId(e.PersonId),a.disableSelectedMembers())}),a.disableSelectedMembers=function(){setTimeout(function(){$(".familyMemberSelect option").prop("disabled",!1),$(".familyMemberSelect").each(function(){var e=$(this).val();e&&$('option[value="'+$(this).val()+'"]').each(function(){$(this).prop("disabled",!0)})})},500)},a.addNewTravelDocument=function(){a.travelDocuments.push(new c.travelDocument),$(".ktn-number").each(function(){$(this).rules("add",{isValidKtnNumber:!0,messages:{isValidKtnNumber:t.InvalidKnownTravelerNumberText}})}),$(".passport-number").each(function(){$(this).rules("add",{isValidPassportNumber:!0,messages:{isValidPassportNumber:t.InvalidPassportNumber}})}),$(".passportExpiryDate").each(function(e,a){$(a).rules("add",{passportExpiryDateValidation:!0,messages:{passportExpiryDateValidation:t.PassportExpiredText}})})},a.removeTravelDocument=function(e){a.travelDocuments.splice(e,1),$("#passengerDetailsError li").each(function(){var e=$(this).attr("for");0==$("#"+e).length&&$(this).remove()})},a.addNewTravelDocumentVisible=ko.computed(function(){return a.travelDocuments().length<c.availableTravelDocumentCount}),a},p};
ezy.views.viewbooking={},ezy.views.viewbooking.sendconfirmation=function(n){var t={},i={},s=!1;return t.setEvents=function(){n.controls.submitLink.live("click",function(){s||t.submitForm()})},i.init=function(){t.setEvents()},t.submitForm=function(){s=!0,n.controls.submitLink.find("span").html(n.translations.pleaseWaitText);var t=n.form.serializeArray();$.ajax({type:"POST",url:"/SendConfirmationMail/SendConfirmation",dataType:"json",data:t,error:function(t){n.controls.submitLink.find("span").html(n.translations.submitLinkText),alert(n.translations.errorText),s=!1},success:function(t){n.controls.submitLink.find("span").html(n.translations.submitLinkText),t.success?alert(n.translations.successText):alert(n.translations.errorText),s=!1}})},i};
ezy.views.flight.search=function(){var i={},a={};return a.init=function(a){i=a;var r=criteriaModel.GetCriteria();"Month"===r.SearchType?$.publish("availabilityMonth/search"):"Normal"===r.SearchType&&$.publish("availabilityNormal/search")},a};
function AvailabilityViewModel(e){var i={},a=this;a.vivaFanFilterType=e.vivaFanFilterType,a.hasActiveVivaFanMembership=e.hasActiveVivaFanMembership,a.showVivaFanProducts=function(){return"Skip"!==a.vivaFanFilterType&&!a.hasActiveVivaFanMembership&&!a.showVivaFanPrices()},a.selectFlightWithKeyboard=function(e,i){var a=i.target||i.srcElement;return 13!==i.keyCode&&32!==i.keyCode||$(a).find("input").trigger("click"),!1},a.selectFlightParentClick=function(e,i){var a=i.target||i.srcElement;return $(a).find("input").trigger("click"),!0},a.selectedOutboundFlight=ko.observable(null),a.selectedInboundFlight=ko.observable(null),a.isSelectedFare=function(e){return null!==a.selectedOutboundFlight()&&a.selectedOutboundFlight().SegmentKey===e||null!==a.selectedInboundFlight()&&a.selectedInboundFlight().SegmentKey===e},a.isSelectedFlight=function(e){return null!==a.selectedOutboundFlight()&&a.selectedOutboundFlight().JourneyIdentifier===e||null!==a.selectedInboundFlight()&&a.selectedInboundFlight().JourneyIdentifier===e},a.getSelectedFare=function(e){for(var i=0;e.length!==i;i++)if(a.isSelectedFare(e[i].SegmentKey))return new ezy.ProductClassViewModel(e[i]);return null},a.toggleVivaFanPrices=function(){if(a.hasActiveVivaFanMembership!==!0){var e=a.IsNotLoggedInOrHasNoValidCustomerProgram();a.showVivaFanPrices(!a.showVivaFanPrices());var i=$("label.light input[type=radio], label.basic input[type=radio], label.smart input[type=radio]"),t=i.is(":checked"),r=a.showVivaFanPrices(),n=!r&&e&&t;r&&t&&!n?($.publish("bookingBasket/show",window.EmptyBasketTemplate),$("#basketNoneSelected").show(),$("#basketBody").hide(),a.selectedOutboundFlight(null),a.selectedInboundFlight(null),$("a.show-more-flights").click(),$.each(i,function(e,i){$(i)[0].checked=!1}),window.availabilityNormal.EnableAllFaresForReturnFlights()):n&&(window.VivaFan.Popup.hasContinuedBookingWithoutAccount=!1,window.VivaFan.Popup.hasContinuedBookingWithUpgrade=!1,$.ajax({type:"POST",url:"/Pricing/RemoveMembershipFee",data:{},contentType:"application/json; charset=utf-8",dataType:"json",error:function(){console.log("Error while removing VivaFan membership fee")},success:function(e){e.Success&&$.publish("bookingBasket/show",e.BookingBasketTemplateData),$.each(i,function(e,i){$(i).is(":checked")&&$(i).click()})}}))}},a.continueWithoutVivaFan=function(){a.showVivaFanPrompt(!1),a.showVivaFanPrices(!1),a.vivaFanPromptAnswered=!0,$.publish("bookingBasket/showLoading"),$.ajax({type:"POST",url:"/Pricing/RemoveMembershipFee",data:{},contentType:"application/json; charset=utf-8",dataType:"json",error:function(e){console.log("Error while removing VivaFan membership fee"),$.publish("availability/validateFlightDates")},success:function(e){e.Success&&$.publish("availability/validateFlightDates")}})},a.openVivaFanPopup=function(){$("#VivaFanPopup").show(),$(window).scrollTop(0)},a.selectVivaFanPrice=function(e){a.showVivaFanPrompt(!1),window.VivaFan.Popup.TriggerValidateFlightDates=e,a.openVivaFanPopup(),a.vivaFanPromptAnswered=!0},a.openVivaFanInfoPopup=function(){$("#VivaFanInfoPopup").show(),ezy.scrollToElement("#VivaFanInfoPopup",1e3,55)},a.vivaFanPromptAnswered=!1,a.resetVivaFanPromptParameters=function(){a.vivaFanPromptAnswered=!1,window.VivaFan.Popup.hasContinuedBookingWithoutAccount=!1,window.VivaFan.Popup.hasContinuedBookingWithUpgrade=!1},a.shouldContinueWithMembershipFee=function(){var e=window.VivaFan.Popup;return e?e.hasContinuedBookingWithoutAccount||e.hasContinuedBookingWithUpgrade:!1},a.shouldAddMembershipFee=function(){var e=!0;return a.selectedOutboundFlight()&&(e=a.selectedOutboundFlight().ProductClassName!==ezy.constants.productClassName.vivaZero),a.shouldContinueWithMembershipFee()&&e},a.IsNotLoggedInOrHasNoValidCustomerProgram=function(){var e=window.VivaFan.Popup;return e?e.LoggedIn===!1||e.userInfo.HasValidCustomerProgram===!1:!1},a.showVivaProductNoticeMessageOutbound=function(){return"Experimental3"!==a.templateGroupName()&&0===a.flightsIn().length},a.showVivaProductNoticeMessageInbound=function(){return"Experimental3"!==a.templateGroupName()&&0!==a.flightsIn().length},a.showVivaFanPrices=ko.observable(!1),a.showVivaFanPrompt=ko.observable(!1),a.showVivaFanPriceForFare=function(e){return("Default"===a.templateGroupName()||"Experimental2"===a.templateGroupName()||"Experimental3"===a.templateGroupName()||"Experimental4"===a.templateGroupName())&&a.showVivaFanPrices()&&e!==ezy.constants.vivaProductCode.vivaZero},a.showVivaFanPromptOutbound=ko.computed(function(){return this.showVivaFanPrompt()&&"Experimental3"===this.templateGroupName()&&this.vivaFanPromptAnswered===!1&&0===this.flightsIn().length},a),a.showVivaFanPromptInbound=ko.computed(function(){return this.showVivaFanPrompt()&&"Experimental3"===this.templateGroupName()&&this.vivaFanPromptAnswered===!1&&0!==this.flightsIn().length},a),a.Templates={},a.Templates.Default={FlightTemplate:"availability-flights-template",HeaderOutTemplate:"availability-header-out-template",HeaderInTemplate:"availability-header-in-template",WeekTemplate:"availability-week-template-4"},a.Templates.Experimental1={FlightTemplate:"availability-flights-template-2",HeaderOutTemplate:"availability-header-out-template-2",HeaderInTemplate:"availability-header-in-template-2",WeekTemplate:"availability-week-template-2"},a.Templates.Experimental2={FlightTemplate:"availability-flights-template-3",HeaderOutTemplate:"availability-header-out-template-3",HeaderInTemplate:"availability-header-in-template-3",WeekTemplate:"availability-week-template-2"},a.Templates.Experimental3={FlightTemplate:"availability-flights-template-4",HeaderOutTemplate:"availability-header-out-template-4",HeaderInTemplate:"availability-header-in-template-4",WeekTemplate:"availability-week-template-3"},a.Templates.Experimental4={FlightTemplate:"availability-flights-template-5",HeaderOutTemplate:"availability-header-out-template-5",HeaderInTemplate:"availability-header-in-template-5",WeekTemplate:"availability-week-template-4"},a.templateGroupName=ko.observable(e.templateGroupName),a.flightTemplate=ko.observable(a.Templates.Default.FlightTemplate),a.headerOutTemplate=ko.observable(a.Templates.Default.HeaderOutTemplate),a.headerInTemplate=ko.observable(a.Templates.Default.HeaderInTemplate),a.weekTemplate=ko.observable(a.Templates.Default.WeekTemplate),a.setTemplates=function(e){var i=a.Templates[e];a.flightTemplate(i.FlightTemplate),a.headerOutTemplate(i.HeaderOutTemplate),a.headerInTemplate(i.HeaderInTemplate),a.weekTemplate(i.WeekTemplate)},a.setTemplates(e.templateGroupName),a.templateGroupName.subscribe(a.setTemplates),a.openProductPopup=function(){var e=this;$.fancybox({href:e,hideOnContentClick:!0,helpers:{overlay:{locked:!1}}})},a.flightsOut=ko.observableArray([]),a.flightsIn=ko.observableArray([]),a.flightsOutWeek=ko.observableArray([]),a.flightsInWeek=ko.observableArray([]),a.availabilityDayPickerOut=new AvailabilityDayPicker("out"),a.availabilityDayPickerIn=new AvailabilityDayPicker("in"),a.operatedFlights=ko.observableArray([]),a.isFareLock=ko.observable(!1),a.isVivaZeroReturnFlightSelectionDisabled=function(){var e=a.flightsIn()[0];return a.flightsIn().length>0&&e.ZeroFare?e.ZeroFare.blockedFareSelection():!1},a.isVivaLightReturnFlightSelectionDisabled=function(){var e=a.flightsIn()[0];return a.flightsIn().length>0&&e.LightFare?e.LightFare.blockedFareSelection():!1},a.isVivaBasicReturnFlightSelectionDisabled=function(){var e=a.flightsIn()[0];return a.flightsIn().length>0&&e.BasicFare?e.BasicFare.blockedFareSelection():!1},a.isProductSelectionDisabledForReturnFlights=function(e){return e===ezy.constants.vivaProductCode.vivaZero?a.isVivaZeroReturnFlightSelectionDisabled():e===ezy.constants.vivaProductCode.vivaLight?a.isVivaLightReturnFlightSelectionDisabled():e===ezy.constants.vivaProductCode.vivaBasic?a.isVivaBasicReturnFlightSelectionDisabled():!1},a.setVivaProductNoticeMessage=function(e){var i=e.ProductClassName;i===ezy.constants.productClassName.vivaZero||i===ezy.constants.productClassName.vivaLight?a.noticeMessageContainerClass("notice-message-container warningContainer"):i===ezy.constants.productClassName.vivaBasic?a.noticeMessageContainerClass("notice-message-container infoContainer"):i!==ezy.constants.productClassName.vivaOTA&&i!==ezy.constants.productClassName.vivaSmart||a.noticeMessageContainerClass("notice-message-container successContainer"),a.selectedVivaProductNoticeMessage(e.NoticeMessage)},a.noticeMessageContainerClass=ko.observable("notice-message-container warningContainer"),a.selectedVivaProductNoticeMessage=ko.observable(""),a.hideVivaLightProductHeaderOut=ko.computed(function(){return e.isStaff?!0:!!(this.flightsOut().length>0&&null===this.flightsOut()[0].LightFare||e.hideVivaLight)},this),a.hideVivaLightProductHeaderIn=ko.computed(function(){return e.isStaff?!0:!!(this.flightsIn().length>0&&null===this.flightsIn()[0].LightFare||e.hideVivaLight)},this),a.hideVivaBasicProductHeaderOut=ko.computed(function(){return this.flightsOut().length>0&&null===this.flightsOut()[0].BasicFare},this),a.hideVivaBasicProductHeaderIn=ko.computed(function(){return this.flightsIn().length>0&&null===this.flightsIn()[0].BasicFare},this),a.hideVivaSmartProductHeaderOut=ko.computed(function(){return this.flightsOut().length>0&&null===this.flightsOut()[0].SmartFare},this),a.hideVivaSmartProductHeaderIn=ko.computed(function(){return this.flightsIn().length>0&&null===this.flightsIn()[0].SmartFare},this),a.getNumberOfHiddenVivaProductsOut=ko.computed(function(){var e=0;return a.hideVivaLightProductHeaderOut()&&e++,a.hideVivaBasicProductHeaderOut()&&e++,a.hideVivaSmartProductHeaderOut()&&e++,e},this),a.oneOutProductVisible=ko.computed(function(){return 3===a.getNumberOfHiddenVivaProductsOut()},this),a.twoOutProductsVisible=ko.computed(function(){return 2===a.getNumberOfHiddenVivaProductsOut()},this),a.threeOutProductsVisible=ko.computed(function(){return 1===a.getNumberOfHiddenVivaProductsOut()},this),a.fourOutProductsVisible=ko.computed(function(){return 0===a.getNumberOfHiddenVivaProductsOut()},this),a.getNumberOfHiddenVivaProductsIn=function(){var e=0;return a.hideVivaLightProductHeaderIn()&&e++,a.hideVivaBasicProductHeaderIn()&&e++,a.hideVivaSmartProductHeaderIn()&&e++,e},a.oneInProductVisible=ko.computed(function(){return 3===a.getNumberOfHiddenVivaProductsIn()},this),a.twoInProductsVisible=ko.computed(function(){return 2===a.getNumberOfHiddenVivaProductsIn()},this),a.threeInProductsVisible=ko.computed(function(){return 1===a.getNumberOfHiddenVivaProductsIn()},this),a.fourInProductsVisible=ko.computed(function(){return 0===a.getNumberOfHiddenVivaProductsIn()},this),a.vivaLightOrder=ko.observable(1),a.vivaBasicOrder=ko.observable(2),a.vivaOTAOrder=ko.observable(3),a.vivaSmartOrder=ko.observable(4),a.showVivaLightMostPopularBanner=ko.observable(e.bannerConfiguration.showVivaLightMostPopularBanner),a.showVivaBasicMostPopularBanner=ko.observable(e.bannerConfiguration.showVivaBasicMostPopularBanner),a.showVivaOTAMostPopularBanner=ko.observable(e.bannerConfiguration.showVivaOTAMostPopularBanner),a.showVivaSmartMostPopularBanner=ko.observable(e.bannerConfiguration.showVivaSmartMostPopularBanner),a.showVivaLightNewBanner=ko.observable(e.bannerConfiguration.showVivaLightNewBanner),a.showVivaBasicNewBanner=ko.observable(e.bannerConfiguration.showVivaBasicNewBanner),a.showVivaOTANewBanner=ko.observable(e.bannerConfiguration.showVivaOTANewBanner),a.showVivaSmartNewBanner=ko.observable(e.bannerConfiguration.showVivaSmartNewBanner),a.Departing=new AvailabilityDirectionViewModel,a.Returning=new AvailabilityDirectionViewModel,a.showVivaLightMostPopularBanner.subscribe(function(){a.removeHighLight("light"),a.showVivaLightMostPopularBanner()===!0&&a.addHighLight("light")}),a.showVivaBasicMostPopularBanner.subscribe(function(){a.removeHighLight("basic"),a.showVivaBasicMostPopularBanner()===!0&&a.addHighLight("basic")}),a.showVivaOTAMostPopularBanner.subscribe(function(){a.removeHighLight("plus"),a.showVivaOTAMostPopularBanner()===!0&&a.addHighLight("plus")}),a.showVivaSmartMostPopularBanner.subscribe(function(){a.removeHighLight("smart"),a.showVivaSmartMostPopularBanner()===!0&&a.addHighLight("smart")}),a.removeHighLight=function(e){$(".availVivaProductHead."+e+".viva-highlight").removeClass("viva-highlight"),$(".flightAvailability label.flight-price."+e).removeClass("viva-highlight")},a.addHighLight=function(e){$(".availVivaProductHead."+e).addClass("viva-highlight"),$(".flightAvailability label.flight-price."+e).addClass("viva-highlight")},a.getSegmentKey=function(e,i){return e.substr(0,e.length-1)+i},a.getFareLabel=function(i,a,t){if(!i)return null;var r=null;return $.each(e.FareLabels,function(n,l){if(!e.settings.ShowPromoFareLabelForConnectionFlight&&t)return!1;var o=l.ShowInCalendarOnly===!0,s=0===i.indexOf(l.FareBasisCode)&&""!==l.FareBasisCode,c=-1!==$.inArray(l.PromoDiscountCode,a)&&""!==l.PromoDiscountCode,u=!o&&(s||c);return u&&(l.IsTwoForOne&&e.SeatCount>1||!l.IsTwoForOne)?(r=l,!1):!0}),r},a.isOperatedFlight=function(e){return a.operatedFlights().indexOf(e)>-1},a.ShowSubjectToGovtApprovalMessage=ko.observable(!1),a.selectFlight=function(e,i){try{var t=i.target||i.srcElement;if(a.showVivaFanPriceForFare(e.VivaProduct)&&"Experimental3"!==a.templateGroupName()&&"Default"!==a.templateGroupName()&&a.shouldAddMembershipFee()===!1&&a.IsNotLoggedInOrHasNoValidCustomerProgram())return window.VivaFan.Popup.ElementPreventedClick=t,a.openVivaFanPopup(),!1;$.publish("availabilityNormal/selectFlight",[e,$(t)])}catch(r){console.error("Error during flight selection",r.message)}return a.ShowSubjectToGovtApprovalMessage(e.SubjectToGovtApproval),!0},a.selectVivaFanFlightWithKeyboard=function(e,i){a.selectVivaFanFlight(e,i)},a.selectVivaFanFlight=function(e,i){try{var t=i.target||i.srcElement;$.publish("availabilityNormal/selectVivaFanFlight",[e,$(t)])}catch(r){console.error("Error during VivaFan flight selection",r.message)}return a.ShowSubjectToGovtApprovalMessage(e.SubjectToGovtApproval),!0},a.createFlightsInWeek=function(e){a.flightsInWeek.removeAll(),$.each(e,function(){a.flightsInWeek.push(i.weekday(this))}),a.availabilityDayPickerIn.setAvailabilityData(e)},a.createFlightsOutWeek=function(e){a.flightsOutWeek.removeAll(),$.each(e,function(){a.flightsOutWeek.push(i.weekday(this))}),a.availabilityDayPickerOut.setAvailabilityData(e)},a.setDirectionData=function(e,i){"Departing"===e&&(a.Departing.Date(i.BoardDate),a.flightsOut(i.OutAvailability)),"Returning"===e&&(a.Returning.Date(i.ReturnDate),a.flightsIn(i.InAvailability))},a.dispalyAvail=function(e){var i=e[0].parentElement,a=$(i).attr("id");$.publish("availabilityNormal/displayAvail",a),$(i).find(".flight-flip").flip({axis:"x",speed:300})},a.getLowestFarePrice=function(e){return a.showVivaFanPrices()?Math.min(e.ZeroFare?e.ZeroFare.VivaFanPriceInDecimal:Number.MAX_VALUE,e.LightFare?e.LightFare.VivaFanPriceInDecimal:Number.MAX_VALUE,e.BasicFare?e.BasicFare.VivaFanPriceInDecimal:Number.MAX_VALUE,e.SmartFare?e.SmartFare.VivaFanPriceInDecimal:Number.MAX_VALUE):a.getLowestOriginalFarePrice(e)},a.getLowestOriginalFarePrice=function(e){return Math.min(e.ZeroFare?e.ZeroFare.PriceInDecimal:Number.MAX_VALUE,e.LightFare?e.LightFare.PriceInDecimal:Number.MAX_VALUE,e.BasicFare?e.BasicFare.PriceInDecimal:Number.MAX_VALUE,e.SmartFare?e.SmartFare.PriceInDecimal:Number.MAX_VALUE)},i.weekday=function(e){var i={};return i.Active=ko.observable(e.FareData.Active),i.AvailType=ko.observable(e.FareData.AvailType),i.DepartureDateText=ko.observable(e.FareData.DepartureDateText),i.DateText=ko.observable(e.FareData.DateText),i.Price=ko.observable(e.FareData.Price),i.PriceWithoutPaymentFee=ko.observable(e.FareData.PriceWithoutPaymentFee),i.DayOfWeek=ko.observable(e.FareData.DayOfWeek),i.FareKey=ko.observable(e.FareData.FareKey),i.SellKey=ko.observable(e.FareData.SellKey),i}}ezy=window.ezy||{},ezy.views.flight.availability={},window.EnableAvailabilityConsoleLogging=!1,_currencyHelper=window._currencyHelper||{},moment=window.moment||{},ezy.views.flight.availability.availabilityNormal=function(e){var i={},a={},t={};return t.init=function(e){i=e,a.setEvents(),a.handleVivaFanFilterABTest(),i.availabilityViewModel=new AvailabilityViewModel(i),window.availabilityViewModel=i.availabilityViewModel,ko.applyBindings(i.availabilityViewModel,i.wrapper[0]),$.subscribe("availabilityNormal/search",t.search),$.subscribe("availabilityNormal/selectFlight",t.SelectFlight),$.subscribe("availabilityNormal/selectVivaFanFlight",t.SelectVivaFanFlight),$.subscribe("availabilityNormal/displayAvail",a.displayAvail),$.subscribe("availability/validateFlightDates",a.ValidateFlightDates),$.subscribe("availability/updateFareLockStatus",a.updateFareLockStatus),$.subscribe("availability/disableFlightSelection",a.disableFlightSelection),$.subscribe("availability/enableFlightSelection",a.enableFlightSelection),$.subscribe("availability/processWeekAvailability",a.processWeekAvailability),$.subscribe("availability/processDayAvailability",a.processDayAvailability),$.subscribe("availability/updateFlightPrice",a.updateFlightPrice),i.controls.vaHelp.fancybox({hideOnContentClick:!0,helpers:{overlay:{locked:!1}}}),a.setBoxever(e.getCriteria())},t.log=function(e){window.EnableAvailabilityConsoleLogging&&console.log(e)},a.updateFlightPrice=function(e,i){if(console.log("[availability, updateFlightPrice] entered with data:"),!i.combinedFlightReference||!i.amount)return void console.log("[availability, updateFlightPrice] invalid data => do nothing");try{var t=window.availabilityViewModel.flightsOut(),r=ko.utils.arrayFilter(t,function(e){return e.FareData.CombinedFlightReference===i.combinedFlightReference}),n=null;if(r.length&&(n=r[0]),!n)return void console.log("[availability, updateFlightPrice] didn't find matching flight => do nothing");console.log("[availability, updateFlightPrice] adding "+i.amount+" to each fare family..."),n.LightFare&&a.setFlightProductPrice(n.LightFare,i.amount,".availabilityOut .product-item label.light input[value='"+i.combinedFlightReference+"']"),n.BasicFare&&a.setFlightProductPrice(n.BasicFare,i.amount,".availabilityOut .product-item label.basic input[value='"+i.combinedFlightReference+"']"),n.SmartFare&&a.setFlightProductPrice(n.SmartFare,i.amount,".availabilityOut .product-item label.smart input[value='"+i.combinedFlightReference+"']")}catch(l){console.log("[availability, updateFlightPrice] error trying to update flight price")}},a.setFlightProductPrice=function(e,i,a){e.PriceInDecimal+=i,e.Price=_currencyHelper.format(e.PriceInDecimal,!0),e.PriceWithoutCurrencySymbol=_currencyHelper.formatWithoutCurrency(e.PriceInDecimal,!0);var t=$(a);if(t.length){var r=t.parent(),n=r.find("span.totalPrice span.product-price");n.length&&n.html(e.Price)}},a.handleVivaFanFilterABTest=function(){i.abTestVivaFanFilter===!0&&$.ajax({type:"POST",url:"/Availability/GetVivaFanFilterABExperimentNumber",contentType:"application/json; charset=utf-8",success:function(e){1===e.experimentNumber?i.vivaFanFilterType="Display":i.vivaFanFilterType="Skip";var a={xvb:{EXP004:""+e.experimentNumber}};ezy.Analytics.Send(a)}})},a.setBoxever=function(e){var a="",t="",r="",n="";if(e.Flights.length>0){var l=e.Flights[0];a=l.DepartureAirport,t=l.ArrivalAirport,r=ezy.dateFormat(l.DepartureDate)}if(e.Flights.length>1){var o=e.Flights[1];n=ezy.dateFormat(o.DepartureDate)}window.dataLayer.push({language:"mx"===i.currentLanguageRoot?"es":"en",currency:e.Currency,page:document.title,box:"Search",search:{origin:a,destination:t,start:r,end:n,flightType:e.IsReturnTrip?"RT":"OW",adults:e.Adults,children:e.Children,infants:e.Infants,promocode:e.FareDesignator,fareClass:"Economy"},sca:{channel:"WEB",pos:i.currentLanguageRoot}})},a.sendBoxever=function(e){var i=e.BookingData.ProductClassCode,t=e.BookingData.Segments[0],r=e.BookingData.Segments[1],n={box:"Flight Selection"};n.outbound={priceAdult:a.getPrice(t),priceChild:a.getPrice(t),priceInfant:0,origin:t.DepartureAirport,destination:t.ArrivalAirport,date:t.DepartureDateText,departure:t.DepartureDateAndTimeText,arrival:t.ArrivalDateAndTimeText,category:i,flightNumber:"VIV"+t.FlightNumber},null!=r&&(n.inbound={priceAdult:a.getPrice(r),priceChild:a.getPrice(r),priceInfant:0,origin:r.DepartureAirport,destination:r.ArrivalAirport,date:r.DepartureDateText,departure:r.DepartureDateAndTimeText,arrival:r.ArrivalDateAndTimeText,category:i,flightNumber:"VIV"+r.FlightNumber}),n.booking={total:e.AnalyticsData.TotalPrice};var l={flightType:e.BookingData.Segments.length>1?"RT":"OW",adults:e.BookingBasketTemplateData.NrOfAdults,children:e.BookingBasketTemplateData.NrOfChildren,infants:e.BookingBasketTemplateData.NrOfInfants};l.outbound={price:a.getPrice(t),segment:[{fareClass:t.FareCode,origin:t.DepartureAirport,destination:t.ArrivalAirport,departure:t.DepartureDateAndTimeText,arrival:t.ArrivalDateAndTimeText,flightNumber:"VIV"+t.FlightNumber,carrier:"VB"}]},null!=r&&(l.inbound={price:a.getPrice(r),segment:[{fareClass:r.FareCode,origin:r.DepartureAirport,destination:r.ArrivalAirport,departure:r.DepartureDateAndTimeText,arrival:r.ArrivalDateAndTimeText,flightNumber:"VIV"+r.FlightNumber,carrier:"VB"}]}),n.sca=l,window.dataLayer.push(n),console.log("Boxever.eventCreate(selectionEvent, function (data) {}, 'json');"),console.log(n);for(var o=[],s=0;s<e.BookingData.Segments.length;s++){var c=e.BookingData.Segments[s];o.push({name:c.DepartureAirport+"-"+c.ArrivalAirport+"|"+c.DepartureDateAndTimeText,id:"VIV"+c.FlightNumber,price:a.getPrice(c),category:i,quantity:e.BookingData.NrOfSeats,coupon:e.BookingData.PromoCode})}var u={ecommerce:{currencyCode:e.BookingData.Segments[0].Currency,add:{products:o}},event:"addToCart"};window.dataLayerSelectedProducts=o,window.dataLayer.push(u)},a.getPrice=function(e){return e.PriceInDecimal},a.setEvents=function(){$(document).on("click",".daySearchOut .nextday",function(){a.SetBoardDate(a.GetBoardDate().addDays(1)),a.SwitchDay("out",$(".availabilityOut"))}),$(document).on("click",".daySearchOut .prevday",function(){var e=a.GetBoardDate().addDays(-1);e<new Date||(a.SetBoardDate(e),a.SwitchDay("out",$(".availabilityOut")))}),$(document).on("click",".daySearchIn .nextday",function(){a.SetReturnDate(a.GetReturnDate().addDays(1)),a.SwitchDay("in",$(".availabilityIn"))}),$(document).on("click",".daySearchIn .prevday",function(){var e=a.GetReturnDate().addDays(-1);e<a.GetBoardDate()||(a.SetReturnDate(e),a.SwitchDay("in",$(".availabilityIn")))}),$(document).on("click","#divWeekAvailabilityOut .nextWeek",function(){t.RemoveNoFlightsFoundWarning("out"),$(".divWeekAvailabilityOut .weekDates").html("<div class='loading'><img alt='Loading' src='/Content/Images/loading.gif' /> "+i.translations.LoadingWeek+"</div>");var e=a.GetBoardDate().addDays(7);if(e.getTime()<(new Date).getTime()&&(e=new Date),a.SetBoardDate(e),i.getCriteria().IsReturnTrip){var r=a.GetReturnDate();r.getTime()<e.getTime()?(a.SetReturnDate(e),a.ChangeAvailability("out"),a.ChangeAvailability("in")):a.ChangeAvailability("out")}else a.ChangeAvailability("out")}),$(document).on("click","#divWeekAvailabilityOut .prevWeek",function(){if(t.RemoveNoFlightsFoundWarning("out"),a.GetBoardDate().getTime()>=(new Date).getTime()){$(".divWeekAvailabilityOut .weekDates").html("<div class='loading'><img alt='Loading' src='/Content/Images/loading.gif' /> "+i.translations.LoadingWeek+"</div>");var e=a.GetBoardDate().addDays(-7);e.getTime()<(new Date).getTime()&&(e=new Date),a.SetBoardDate(e),a.ChangeAvailability("out")}}),$(document).on("click","#divWeekAvailabilityIn .nextWeek",function(){t.RemoveNoFlightsFoundWarning("in"),$(".divWeekAvailabilityIn .weekDates").html("<div class='loading'><img alt='Loading' src='/Content/Images/loading.gif' /> "+i.translations.LoadingWeek+"</div>");var e=a.GetReturnDate().addDays(7);e.getTime()<(new Date).getTime()&&(e=new Date),a.SetReturnDate(e),a.ChangeAvailability("in")}),$(document).on("click","#divWeekAvailabilityIn .prevWeek",function(){if(t.RemoveNoFlightsFoundWarning("in"),a.GetBoardDate().getTime()<a.GetReturnDate().getTime()){$(".divWeekAvailabilityIn .weekDates").html("<div class='loading'><img alt='Loading' src='/Content/Images/loading.gif' /> "+i.translations.LoadingWeek+"</div>");var e=a.GetReturnDate().addDays(-7);e.getTime()<(new Date).getTime()&&(e=new Date),a.SetReturnDate(e),a.ChangeAvailability("in")}}),$(document).on("click",".changeSearch",function(){var e=$(this).parents("#divWeekAvailabilityOut").length>0,i=$(this).find(".changeDataOutbound").val(),a=$(this).hasClass("no-flights");t.RemoveNoFlightsFoundWarning(e?"out":"in"),t.ChangeSearch(i,e?"out":"in",a)}),$(document).on("click","#divWeekAvailabilityOut input:radio, #divWeekAvailabilityIn input:radio",function(){var e=!1,t=!1,r=i.getCriteria();if($("#divWeekAvailabilityOut input:radio").each(function(){var i=$(this);if(i.is(":checked")){e=!0;var t=i.val();SetBoardDate(a.ToDate(t))}}),r.IsReturnTrip){var n=!1;$("#divWeekAvailabilityIn input:radio").each(function(){var e=$(this);if(e.is(":checked")){n=!0;var i=e.val();SetReturnDate(a.ToDate(i))}}),n&&e&&(t=!0)}else e&&(t=!0);t&&(r.SearchType="Normal",SetSearchType(r.SearchType),r=i.getCriteria(),DoAvailabilityOrPostback(r,""))}),$("#availabilityNormal .edit").click(function(){a.ShowFlights($(this)),$.publish("payment/setAllPaymentOptionToDefault")}),i.controls.productIcons.mouseover(function(){var e=$(this).attr("data-popup-text");if(e){i.controls.popupForProductIcons.popupText.text(e);var a=$(this).offset().left+$(this).width()/2,t=$(this).offset().top+$(this).height(),r=i.controls.popupForProductIcons.popup.width()/2;i.controls.popupForProductIcons.popupArrow.css({left:r-10.5}),i.controls.popupForProductIcons.popup.css({left:a-r,top:t}),i.controls.popupForProductIcons.popup.fadeIn("fast")}}),i.controls.productIcons.mouseout(function(){i.controls.popupForProductIcons.popup.stop(!0).fadeOut("fast")})},a.SwitchDay=function(e,i){t.RemoveNoFlightsFoundWarning(e),i.velocity("slideUp",function(){i.find(".loading").show(),i.velocity("slideDown",function(){a.ChangeAvailability(e)})})},a.GetBoardDate=function(){return i.getCriteria().Flights[0].DepartureDate},a.GetReturnDate=function(){return i.getCriteria().Flights[1].DepartureDate},a.SetBoardDate=function(i){e.SetDepartureDate(i)},a.SetReturnDate=function(i){e.SetReturnDate(i)},a.SetSearchType=function(e){"Month"===e?$("#divCalendarDates input:radio").prop("checked",!0):"Normal"===e&&$("input[id$=rdExactDates]").prop("checked",!0)},a.ChangeAvailability=function(e){var t=i.getCriteria();a.DoAvailabilityOrPostback(t,e),"out"===e?i.availabilityViewModel.selectedOutboundFlight(null):i.availabilityViewModel.selectedInboundFlight(null),i.availabilityViewModel.resetVivaFanPromptParameters()},a.DoAvailabilityOrPostback=function(e,i){a.DoAvailability(e,i)},a.AvailabilityError=function(e){var a="",t="";try{a=e.responseText.substr(0,e.responseText.indexOf(",")).replace("{","").replace(/\"/g,""),""===a&&(a=e.responseText),t="SearchType - "+e.searchType+", SearchUrl - "+i.searchUrl+" : "+a}catch(r){}window.dataLayer.push({event:"Error",errtype:"Availability",errdetail:t}),$(".availabilityContainerWrapper").html("<div class='errorContainer'>"+i.translations.errorMessage.AnErrorOccurred+"<br />"+a+"</div>")},t.NoFlightsFoundWarning=function(e,i,a){var t="";if($(e).length>0){t=a;var r='<div class="warningContainer noflights '+t+'">'+i+"</div>";$(e).after(r).velocity("slideDown")}},t.RemoveNoFlightsFoundWarning=function(e){var i="";e.length>0&&"all"!==e&&(i="out"===e?".out":".in"),$(".warningContainer.noflights"+i).length>0&&$(".warningContainer.noflights"+i).velocity("slideUp").remove()},a.AvailabilityWeekSuccess=function(e,i,t){var r={};return t.Success?(t.redirectUrl?window.location.href=t.redirectUrl:r=t.availabilityTemplate?t.availabilityTemplate:t,void $.publish("availability/processWeekAvailability",{availabilityTemplate:r,availType:e,criteria:i})):void a.AvailabilityError({responseText:t.Error,searchType:"Week"})},a.processWeekAvailability=function(e,i){var t=i.availabilityTemplate,r=i.availType,n=i.criteria,l=void 0,o=void 0;if(n.Flights.length>0){var s=n.Flights[0];l=s.DepartureDate}if(n.Flights.length>1){var c=n.Flights[1];o=c.DepartureDate}"out"!==r&&""!==r||a.ProcessAvailabilityResultOutWeek(t,l),t.IsRoundTrip&&"out"!==r&&a.ProcessAvailabilityResultInWeek(t,o)},a.sendBoxeverEcommerce=function(e,i,t){for(var r=[],n=0;n<e.length;n++){var l=e[n],o=l.FareData.DepartureAirport+"-"+l.FareData.ArrivalAirport+"|"+l.FareData.DepartureDateAndTimeText;null!==l.LightFare&&void 0!==l.LightFare&&r.push(a.createBoxeverProduct(o,l.FareData.FlightNumber,l.LightFare.PriceInDecimal,"VL",r.length+1)),null!==l.BasicFare&&void 0!==l.BasicFare&&r.push(a.createBoxeverProduct(o,l.FareData.FlightNumber,l.BasicFare.PriceInDecimal,"VB",r.length+1)),null!==l.SmartFare&&void 0!==l.SmartFare&&r.push(a.createBoxeverProduct(o,l.FareData.FlightNumber,l.SmartFare.PriceInDecimal,"VS",r.length+1))}if(null!==i)for(var n=0;n<i.length;n++){var s=i[n],c=s.FareData.DepartureAirport+"-"+s.FareData.ArrivalAirport+"|"+s.FareData.DepartureDateAndTimeText;null!==s.LightFare&&void 0!==s.LightFare&&r.push(a.createBoxeverProduct(c,s.FareData.FlightNumber,s.LightFare.PriceInDecimal,"VL",r.length+1)),null!==s.BasicFare&&void 0!==s.BasicFare&&r.push(a.createBoxeverProduct(c,s.FareData.FlightNumber,s.BasicFare.PriceInDecimal,"VB",r.length+1)),null!==s.SmartFare&&void 0!==s.SmartFare&&r.push(a.createBoxeverProduct(c,s.FareData.FlightNumber,s.SmartFare.PriceInDecimal,"VS",r.length+1))}var u={ecommerce:{detail:{actionField:{list:t},products:r}},event:"eeDetail"};window.dataLayer.push(u)},a.createBoxeverProduct=function(e,i,a,t,r){var n={name:e,id:"VIV"+i,price:a,category:t,position:r};return n},a.stripPrice=function(e){var i=e.replace('<span class="currency">MX$ </span>',"");return i},a.AvailabilitySuccess=function(e,t,r){if(!r.Success)return void a.AvailabilityError({responseText:r.Error,searchType:"Day"});a.sendBoxeverEcommerce(r.availabilityTemplate.OutAvailability,r.availabilityTemplate.InAvailability,"Daily Availability");var n={};r.redirectUrl?window.location.href=r.redirectUrl:n=r.availabilityTemplate?r.availabilityTemplate:r,a.GoogleAnalyticsTrackSearch(n),$(".availabilityOut span.date").text(n.BoardDate),$(".availabilityIn span.date").text(n.ReturnDate),n.IsRoundTrip||a.HideReturnFlightContainer(),i.disableVivaFanForRoute&&a.hideVivaFanOffer(),$.publish("availability/processDayAvailability",{availabilityTemplate:n,availType:e})},a.hideVivaFanOffer=function(){window.availabilityViewModel.showVivaFanPrices(!1)},a.processDayAvailability=function(e,t){var r=t.availabilityTemplate,n=t.availType;"out"!==n&&""!==n||a.ProcessAvailabilityResultOut(r),r.IsRoundTrip&&"out"!==n&&a.ProcessAvailabilityResultIn(r),i.availabilityViewModel.showVivaLightMostPopularBanner.notifySubscribers(),i.availabilityViewModel.showVivaBasicMostPopularBanner.notifySubscribers(),i.availabilityViewModel.showVivaOTAMostPopularBanner.notifySubscribers(),i.availabilityViewModel.showVivaSmartMostPopularBanner.notifySubscribers(),a.handleDomesticPaymentFeeAbExperiment(r.DomesticPaymentFeeExperimentNumber,r.IsDomestic)},a.handleDomesticPaymentFeeAbExperiment=function(e,i){try{if(i===!0){1===e?$("#paymentfee-domestic-one").show():2===e&&$("#paymentfee-domestic-two").show();var a={xvb:{EXP006:""+e},event:"vbPaymentFee"};ezy.Analytics.Send(a)}}catch(t){console.error(t)}},a.DropinFlight=function(e,i,a){if(""!==i)for(var t=0;t<e.length;t++)if(e[t].FareData.FlightNumber==i){var r=!1;""!=a?e[t].FareData.ClassCode==a&&(r=!0):r=!0,r&&$(".normalfare input[type=radio]").each(function(){$(this).attr("id")==e[t].FareData.JourneyIdentifier&&(this.checked=!0,$(this).click())});break}},a.HideReturnFlightContainer=function(){$("#pnlReturn").hide()},a.ProcessAvailabilityResultOutWeek=function(e,t){$("#divWeekAvailabilityOut .loading").hide(),a.NextPrevWeekDisplay("Out",t);var r=a.CreateCustomFieldsWeek(e.OutAvailability,t);i.availabilityViewModel.createFlightsOutWeek(r)},a.ProcessAvailabilityResultInWeek=function(e,t){
$("#divWeekAvailabilityIn .loading").hide(),a.NextPrevWeekDisplay("In",t);var r=a.CreateCustomFieldsWeek(e.InAvailability,t);i.availabilityViewModel.createFlightsInWeek(r)},a.NextPrevWeekDisplay=function(e,i){var a=$("#divWeekAvailability"+e+"  .prevWeek"),t=$("#divWeekAvailability"+e+"  .nextWeek"),r=moment(i),n=moment(),l=moment(window.criteriaViewModel.lastBookingDate),o=r.subtract(3,"days").diff(n,"days"),s=r.add(3,"days").diff(l,"days"),c=o>0,u=0>s;c?a.removeClass("disabled"):a.addClass("disabled"),u?t.removeClass("disabled"):t.addClass("disabled")},a.ProcessAvailabilityResultOut=function(e){i.availabilityViewModel.availabilityDayPickerOut.switchDayLoading(!1);var r=a.ToDate(e.BoardDateMonthYear+"-"+e.BoardDateDay);if("Month"===e.SearchType)return $(".departing_info").html(e.DepartureCity+" "+i.translations.To+" "+e.ArrivalCity+" > 1 Month Low Rates"),void SetCalendar(e.OutAvailability,"Out",r);var n="Week"===e.SearchType?"#divWeekAvailabilityOut":"#divAvailabilityOutVivaProduct";"Week"!==e.SearchType&&$(".departing_info").html("<div class='destination'>"+e.DepartureCity+" "+i.translations.To+" "+e.ArrivalCity+"</div><div class='date'>"+e.BoardDate+"</div>"),a.CreateCustomFields(e.OutAvailability),i.availabilityViewModel.setDirectionData("Departing",e);var l=0;$.each(e.OutAvailability,function(e,a){("DirectPlusConnection"===i.flightFilterType||"DirectOnly"===i.flightFilterType)&&a.FareData.Legs.length>1&&(a.hiddenByFilter(!0),l++)});var o=l>0;o&&"DirectPlusConnection"===i.flightFilterType&&$(".availabilityOut .edit").show(),l>=e.OutAvailability.length&&("DirectOnly"===i.flightFilterType&&t.NoFlightsFoundWarning(n,i.translations.flightSearchNoSchedule,"out"),"DirectPlusConnection"===i.flightFilterType&&($(".availabilityOut .edit").hide(),a.ShowFlights($(".availabilityOut .edit")))),0===parseInt(e.OutAvailability.length,10)?e.NoScheduleOut?t.NoFlightsFoundWarning(n,i.translations.flightSearchNoSchedule,"out"):t.NoFlightsFoundWarning(n,i.translations.flightSearchNoFlights,"out"):$("#noOutFlights").hide(),$(n).velocity("slideDown"),a.showLoadingOut(!1);var s=i.getCriteria();a.DropinFlight(e.OutAvailability,s.OutFlightNumber,s.OutClassCode),a.setCurrency(e),$(".availabilityOut .flight a").first().focus()},a.setCurrency=function(e){var i=e.OutAvailability;if(i.length>0){var a=i[0].FareData.CurrencyCode;"MXN"===a&&(a="MX$"),$(".currencyDescriptionValue").html(a),$(".currencyDescription").show()}},a.ProcessAvailabilityResultIn=function(e){i.availabilityViewModel.availabilityDayPickerIn.switchDayLoading(!1);var r=a.ToDate(e.ReturnDateMonthYear+"-"+e.ReturnDateDay);if("Month"===e.SearchType)return $(".returning_info").html(e.ArrivalCity+" "+i.translations.To+" "+e.DepartureCity+" > 1 Month Low Rates"),void SetCalendar(e.InAvailability,"In",r);var n="Week"===e.SearchType?"#divWeekAvailabilityIn":"#divAvailabilityInVivaProduct";"Week"!==e.SearchType&&$(".returning_info").html("<div class='destination'>"+e.ArrivalCity+" "+i.translations.To+" "+e.DepartureCity+"</div><div class='date'>"+e.ReturnDate+"</div>"),a.CreateCustomFields(e.InAvailability),i.availabilityViewModel.setDirectionData("Returning",e);var l=0;$.each(e.InAvailability,function(e,a){("DirectPlusConnection"===i.flightFilterType||"DirectOnly"===i.flightFilterType)&&a.FareData.Legs.length>1&&(a.hiddenByFilter(!0),l++)});var o=l>0;o&&"DirectPlusConnection"===i.flightFilterType&&$(".availabilityIn .edit").show(),l>=e.InAvailability.length&&("DirectOnly"===i.flightFilterType&&t.NoFlightsFoundWarning(n,i.translations.flightSearchNoSchedule,"in"),"DirectPlusConnection"===i.flightFilterType&&($(".availabilityIn .edit").hide(),a.ShowFlights($(".availabilityIn .edit")))),0===parseInt(e.InAvailability.length,10)?e.NoScheduleIn?t.NoFlightsFoundWarning(n,i.translations.flightSearchNoSchedule,"in"):t.NoFlightsFoundWarning(n,i.translations.flightSearchNoFlights,"in"):$("#noInFligths").hide(),a.showLoadingIn(!1),$(n).velocity("slideDown"),$("#divAvailabilityIn .loading").hide();var s=i.getCriteria();a.DropinFlight(e.InAvailability,s.InFlightNumber,s.InClassCode)},a.CreateCustomFields=function(e){for(var t=0;t<e.length;t++)e[t].FareData.OriginCode=e[t].FareData.DepartureAirport,e[t].FareData.DestinationCode=e[t].FareData.ArrivalAirport,e[t].FareData.TravelTimeText=a.GetTime(e[t].FareData.DepartureTime,e[t].FareData.ArrivalTime),e[t].FormatSeatsLeftText=a.FormatSeatsLeftText,e[t].toggleFlightDetails=function(e,i){var a=i.target||i.srcElement;try{$(a).closest(".availability-fare-box-4__details").find(".flight-flip").flip("toggle")}catch(t){var r=$(a).closest(".availability-fare-box-4__details").find(".flight-flip").find(".front"),n=$(a).closest(".availability-fare-box-4__details").find(".flight-flip").find(".back");"none"===r.css("display")?(n.hide(),r.show(),r.css("display","flex"),r.click(function(){r.hide(),n.show(),n.css("display","flex")})):(r.hide(),n.show(),n.css("display","flex"),r.css("cursor","pointer"))}},e[t].isSelected=function(){return this.FareData&&i.availabilityViewModel.isSelectedFare(this.FareData.SegmentKey)||this.ZeroFare&&i.availabilityViewModel.isSelectedFare(this.ZeroFare.SegmentKey)||this.LightFare&&i.availabilityViewModel.isSelectedFare(this.LightFare.SegmentKey)||this.BasicFare&&i.availabilityViewModel.isSelectedFare(this.BasicFare.SegmentKey)||this.SmartFare&&i.availabilityViewModel.isSelectedFare(this.SmartFare.SegmentKey)},e[t].show=ko.observable(!0),e[t].hiddenByFilter=ko.observable(!1),e[t].showFlight=function(){return this.show()&&this.hiddenByFilter()===!1||this.isSelected()},e[t].FareData.RadioGroup="flights"+e[t].FareData.AvailType,e[t].ZeroFare&&(e[t].ZeroFare.blockedFareSelection=ko.observable(!1)),e[t].LightFare&&(e[t].LightFare.blockedFareSelection=ko.observable(!1)),e[t].BasicFare&&(e[t].BasicFare.blockedFareSelection=ko.observable(!1)),e[t].SmartFare&&(e[t].SmartFare.blockedFareSelection=ko.observable(!1)),e[t].GetLowestFarePrice=function(){return this.LightFare?"$"+this.LightFare.PriceInDecimal.toFixed(0):this.BasicFare?"$"+this.BasicFare.PriceInDecimal.toFixed(0):this.SmartFare?"$"+this.SmartFare.PriceInDecimal.toFixed(0):"$"+this.FareData.PriceInDecimal.toFixed(0)}},a.FormatSeatsLeftText=function(e,i){return e.replace("[SeatCount]",i)},a.CreateCustomFieldsWeek=function(e,i){var t=[],r=moment(i).format("YYYY-MM-DD"),n=a.getWeekDatesFromMiddleOfWeek(i);return $.each(n,function(i,n){var l=n.format("YYYY-MM-DD"),o=$.grep(e,function(e){return e.FareData.DepartureDateText===l})[0];void 0!==o&&null!==o||(o={FareData:{Active:!1,DepartureDateText:l,DateText:"",DayOfWeek:""}}),o.FareData.DepartureDateText===r?o.FareData.Active=!0:o.FareData.Active=!1;var s=o.FareData.DepartureDateText.split("-"),c=parseInt(s[0]),u=parseInt(s[1]),d=parseInt(s[2]);o.FareData.DateText=d+" "+a.GetMonthName(u);var h=new Date(c,u-1,d);o.FareData.DayOfWeek=a.GetDayOfWeek(h.getDay())[1],t.push(o)}),t},a.getWeekDatesFromMiddleOfWeek=function(e){var i=[],a=moment(e).subtract(3,"days");i.push(a);for(var t=1;7!==t;t++){var r=moment(a).add(t,"days");i.push(r)}return i},a.GetTime=function(e,i){var a=new Date,t=new Date;a.setHours(e.split(":")[0]),a.setMinutes(e.split(":")[1]),t.setHours(i.split(":")[0]),t.setMinutes(i.split(":")[1]);var r=t-a,n=r/1e3,l=Math.floor(n/3600),o=Math.floor(n%3600)/60,s=(10>l?"0"+l:l)+":"+(10>o?"0"+o:o);return s},a.GetDayOfWeek=function(e){var a=i.translations.weekdays,t=["",""];return 0===e&&(t=[a.Sunday,a.SundayShort]),1===e&&(t=[a.Monday,a.MondayShort]),2===e&&(t=[a.Tuesday,a.TuesdayShort]),3===e&&(t=[a.Wednesday,a.WednesdayShort]),4===e&&(t=[a.Thursday,a.ThursdayShort]),5===e&&(t=[a.Friday,a.FridayShort]),6===e&&(t=[a.Saturday,a.SaturdayShort]),t},a.GetMonthName=function(e){return i.translations.monthNamesShort[e-1]},a.GetEventsFromAvailability=function(e,i){for(var a=[],t=0;t<e.length;t++){var r=e[t];a[a.length]={EventID:a.length+1,Date:r.DepartureDateText,Title:r.FareValue,DiscountInPercent:r.DiscountInPercent,OriginalPrice:r.OriginalPrice,URL:"",Description:"",CssClass:"normal",AvailType:i,FlightNumbers:r.FlightNumbers,HaveSchedule:r.HaveSchedule}}return a},a.showLoadingOut=function(e){i.availabilityViewModel.Departing.Loading(e),e?($(".availabilityOut").hide(),$(".availability").css("display","block"),$("#availabilityLoadingOut").show(),$("#jMonthCalendarOut").hide(),$("#stopsout").hide()):($("#availabilityLoadingOut").hide(),$(".availability").css("display","inline-block"),$(".availabilityOut").show())},a.showLoadingIn=function(e){i.availabilityViewModel.Returning.Loading(e),e?($(".availabilityIn").hide(),$(".availability").css("display","block"),$("#availabilityLoadingIn").show(),$("#stopsin").hide(),$("#jMonthCalendarIn").hide()):($("#availabilityLoadingIn").hide(),$(".availability").css("display","inline-block"),$(".availabilityIn").show())},a.DoAvailability=function(e,r,n,l){e.IsReturnTrip||$("#pnlReturn").hide(),""!==r&&"out"!==r||(a.showLoadingOut(!0),n||($("#jMonthCalendarOut").hide(),$("#divWeekAvailabilityOut .weekDates").html("<div class='loading'><img alt='Loading' src='/Content/Images/loading.gif' /> "+i.translations.LoadingWeek+"</div>"))),""!==r&&"in"!==r||(a.showLoadingIn(!0),$(".returning_header").parent().not(".seats_content").show(),n||($("#jMonthCalendarIn").hide(),$("#divWeekAvailabilityIn .weekDates").html("<div class='loading'><img alt='Loading' src='/Content/Images/loading.gif' /> "+i.translations.LoadingWeek+"</div>"))),e.ShowOnly&&"out"===e.ShowOnly?($("#divAvailabilityIn").parent().parent().hide(),$("#divAvailabilityOut").parent().parent().show()):e.ShowOnly&&"in"===e.ShowOnly?($("#divAvailabilityOut").parent().parent().hide(),$("#divAvailabilityIn").parent().parent().show()):""===e.ShowOnly&&($("#divAvailabilityIn").parent().parent().show(),$("#divAvailabilityOut").parent().parent().show()),window.dataLayer.push({event:"Availability",infotype:e.SearchType});var o="",s="",c="",u="";if(e.Flights.length>0){var d=e.Flights[0];o=d.DepartureAirport,s=d.ArrivalAirport,c=d.DepartureDate}if(e.Flights.length>1){var h=e.Flights[1];u=h.DepartureDate}var v=("true"===i.weekSearchEnabled&&!n,e.Flights.map(function(e){return e.hasOwnProperty("DepartureDate")&&(e.DepartureDateString=moment(e.DepartureDate).format("YYYY-MM-DD")),e})),g=JSON.stringify({AvailType:r,searchType:"Day",Currency:e.Currency,adults:e.Adults,children:e.Children,infants:e.Infants,fareDesignator:e.FareDesignator,getFromState:e.HaveErrors,isChangeBooking:e.IsChangeBooking,minimumTotalAmountOut:e.MinimumTotalAmountOut?e.MinimumTotalAmountOut:null,minimumTotalAmountIn:e.MinimumTotalAmountIn?e.MinimumTotalAmountIn:null,SelectedPax:e.SelectedPax?e.SelectedPax:null,culture:i.culture,Flights:v}),p=$("#main-content.booking").find('input[name="__RequestVerificationToken"]').val();$.ajax({type:"POST",headers:{__RequestVerificationToken:p},url:i.searchUrl,data:g,contentType:"application/json; charset=utf-8",dataType:"json",error:function(e){a.AvailabilityError({responseText:e.statusText,searchType:"Day"})},success:a.AvailabilitySuccess.bind(this,r,e)}),"true"!==i.weekSearchEnabled||n||t.DoWeekSearch(r,e)},t.DoWeekSearch=function(e,t){var r=JSON.stringify({AvailType:e,searchType:"Week",Currency:t.Currency,adults:t.Adults,children:t.Children,infants:t.Infants,fareDesignator:t.FareDesignator,getFromState:t.HaveErrors,isChangeBooking:t.IsChangeBooking,minimumTotalAmountOut:t.MinimumTotalAmountOut?t.MinimumTotalAmountOut:null,minimumTotalAmountIn:t.MinimumTotalAmountIn?t.MinimumTotalAmountIn:null,SelectedPax:t.SelectedPax?t.SelectedPax:null,culture:i.culture,Flights:t.Flights}),n=$("#main-content.booking").find('input[name="__RequestVerificationToken"]').val();$.ajax({type:"POST",headers:{__RequestVerificationToken:n},url:i.searchUrl,data:r,contentType:"application/json; charset=utf-8",dataType:"json",error:function(e){a.AvailabilityError({responseText:e.statusText,searchType:"Week"})},success:a.AvailabilityWeekSuccess.bind(this,e,t)})},t.search=function(){i.wrapper.show(),$("#DoAvailability").val("");var e=i.getCriteria();a.DoAvailability(e,"")},a.ToDate=function(e){return new Date(e.substr(0,4),e.substr(5,2)-1,e.substr(8,2))},a.GoogleAnalyticsTrackSearch=function(e){try{if(e.OutAvailability.length>0){var i=e.OutAvailability[0].FareData.DepartureAirport+"-"+e.OutAvailability[0].FareData.ArrivalAirport,t=a.ToDate(e.BoardDateMonthYear+"-"+e.BoardDateDay),r=t.toString("yy-MM-dd");window.dataLayer.push({event:"RouteSearchWithFlightDate",infotype:i+"|"+r});var n="";if(e.IsRoundTrip&&e.InAvailability.length>0){var l=a.ToDate(e.ReturnDateMonthYear+"-"+e.ReturnDateDay);n=l.toString("yy-MM-dd");var o=e.OutAvailability[0].FareData.ArrivalAirport+"-"+e.OutAvailability[0].FareData.DepartureAirport;window.dataLayer.push({event:"RouteSearchWithFlightDate",infotype:o+"|"+n})}}}catch(s){console.log("Google Analytics error: "+s.message)}},t.ChangeSearch=function(e,t,r){var n,l=a.ToDate(e);"out"===t?(a.SetBoardDate(l),n=i.availabilityViewModel.flightsOutWeek(),i.availabilityViewModel.selectedOutboundFlight(null)):(a.SetReturnDate(l),n=i.availabilityViewModel.flightsInWeek(),i.availabilityViewModel.selectedInboundFlight(null));for(var o=0;o<n.length;o++)n[o].DepartureDateText()===e?n[o].Active(!0):n[o].Active(!1);var s=i.getCriteria();a.DoAvailability(s,t,!0,r),i.availabilityViewModel.resetVivaFanPromptParameters()},t.SelectFlight=function(e,r,n){if(window.productClassSelector.setSelectedFlight(r),window.productClassSelector.toggleMexicoDepartureTax(),window.productClassSelector.shouldShowPopup(r))return void window.productClassSelector.open();if("in"===r.AvailType&&window.productClassUpgrade.shouldShowPopup(i.availabilityViewModel.selectedOutboundFlight(),r))return void window.productClassUpgrade.open();a.HideFlights(n),t.EnableAllFaresForReturnFlights(),a.BlockLowerFaresForReturnFlights(r);var l=n[0].id;t.log("[Selected segment key: "+l+"]"),a.ChangeVivaProductType(r);var o="Experimental3"===i.availabilityViewModel.templateGroupName();"out"===r.AvailType?(o&&i.availabilityViewModel.selectedOutboundFlight()&&i.availabilityViewModel.resetVivaFanPromptParameters(),i.availabilityViewModel.selectedOutboundFlight(r)):o&&i.availabilityViewModel.selectedInboundFlight()?i.availabilityViewModel.resetVivaFanPromptParameters():i.availabilityViewModel.selectedInboundFlight(r),i.availabilityViewModel.setVivaProductNoticeMessage(r),$.publish("payment/hideAndCloseAllPaymentOption"),$.publish("extras/hide");var s=i.getCriteria(),c="Display"===i.vivaFanFilterType&&i.availabilityViewModel.vivaFanPromptAnswered===!1&&i.availabilityViewModel.IsNotLoggedInOrHasNoValidCustomerProgram()&&r.VivaProduct!==ezy.constants.vivaProductCode.vivaZero,u=!s.IsReturnTrip,d=i.availabilityViewModel.selectedOutboundFlight(),h=i.availabilityViewModel.selectedInboundFlight(),v=s.IsReturnTrip&&null!==d&&null!==h;u||v?v&&d.ProductClass!==h.ProductClass?a.ForceSelectOneVivaProduct(r):o&&c?(i.availabilityViewModel.showVivaFanPrices(!0),i.availabilityViewModel.showVivaFanPrompt(!0),window.ezy.scrollToElement(".viva-fan-prompt-below:visible",1e3,-300)):($.publish("availability/disableFlightSelection"),a.ValidateFlightDates()):window.ezy.scrollToElement(".availabilityContainer label.selected:visible",1e3,-300),$.publish("extras/hideSeating"),n[0].checked=!0},t.SelectVivaFanFlight=function(e,r,n){a.HideFlights(n);var l=$(n[0]).attr("data-flight-segment-key");t.log("[Selected segment key: "+l+"]");var o=r;o.Price=o.VivaFanPrice,o.PriceInDecimal=o.VivaFanPriceInDecimal,o.PriceWithoutCurrencySymbol=o.VivaFanPriceInDecimal.toString(),a.ChangeVivaProductType(o),"out"===o.AvailType?(i.availabilityViewModel.selectedOutboundFlight()&&i.availabilityViewModel.resetVivaFanPromptParameters(),i.availabilityViewModel.selectedOutboundFlight(o)):(i.availabilityViewModel.selectedInboundFlight()&&i.availabilityViewModel.resetVivaFanPromptParameters(),i.availabilityViewModel.selectedInboundFlight(o));var s=$("#"+l);s.attr("checked",!0);var c=i.getCriteria(),u=!c.IsReturnTrip,d=c.IsReturnTrip&&null!=i.availabilityViewModel.selectedOutboundFlight()&&null!=i.availabilityViewModel.selectedInboundFlight(),h=u||d;availabilityViewModel.selectVivaFanPrice(h),a.ForceSelectOneVivaProduct(o)},a.HideFlights=function(e){var t=$(e).closest(".availabilityContainer"),r="pnlReturn"===t.attr("id"),n=r?i.availabilityViewModel.flightsIn():i.availabilityViewModel.flightsOut();a.setFlightsVisibility(n,!1),t.find(".weekSearch").hide(),t.find(".week-search").hide(),t.find(".edit").show(),r?i.availabilityViewModel.Returning.FlightSelected(!0):i.availabilityViewModel.Departing.FlightSelected(!0)},a.BlockLowerFaresForReturnFlights=function(e){var a=ezy.constants.vivaProductCodesPriority.ascendingOrder,t=a.indexOf(e.ProductClass),r=a.filter(function(e,i,a){return t>i}),n=i.availabilityViewModel.flightsIn();$.each(n,function(e,i){$.each(r,function(e,a){i.ZeroFare&&a===ezy.constants.vivaProductCode.vivaZero&&i.ZeroFare.blockedFareSelection(!0),i.LightFare&&a===ezy.constants.vivaProductCode.vivaLight&&i.LightFare.blockedFareSelection(!0),i.BasicFare&&a===ezy.constants.vivaProductCode.vivaBasic&&i.BasicFare.blockedFareSelection(!0)})})},t.EnableAllFaresForReturnFlights=function(){var e=i.availabilityViewModel.flightsIn();$.each(e,function(e,i){i.ZeroFare&&i.ZeroFare.blockedFareSelection(!1),i.LightFare&&i.LightFare.blockedFareSelection(!1),i.BasicFare&&i.BasicFare.blockedFareSelection(!1)})},a.ShowFlights=function(e){var t=$(e).closest(".availabilityContainer"),r="pnlReturn"===t.attr("id"),n=r?i.availabilityViewModel.flightsIn():i.availabilityViewModel.flightsOut();a.setFlightsVisibility(n,!0),t.find(".weekSearch").show(),t.find(".week-search").show(),t.find(".edit").hide(),i.availabilityViewModel.showVivaFanPrompt(!1),r?i.availabilityViewModel.Returning.FlightSelected(!1):i.availabilityViewModel.Departing.FlightSelected(!1),setTimeout(function(){t.find(".flight a").first().focus()},500),window.productClassSelector.reset()},a.setFlightsVisibility=function(e,a){$.each(e,function(e,i){i.show(a===!0)}),a===!0&&"DirectPlusConnection"===i.flightFilterType&&$.each(e,function(e,i){i.hiddenByFilter(!1)})},a.ShowAllFlights=function(){a.setFlightsVisibility(i.availabilityViewModel.flightsOut(),!0),a.setFlightsVisibility(i.availabilityViewModel.flightsIn(),!0),$(".weekSearch, .week-search").show()},a.deleteLegs=function(e){void 0!==e&&null!==e&&e.Fares&&e.Fares.length&&$.each(e.Fares,function(e,i){i.Legs=[]})},a.ValidateFlightDates=function(){var e=i.availabilityViewModel.selectedOutboundFlight().VivaProduct;if(i.availabilityViewModel.showVivaFanPrices()&&"Default"===i.availabilityViewModel.templateGroupName()&&i.availabilityViewModel.shouldAddMembershipFee()===!1&&i.availabilityViewModel.IsNotLoggedInOrHasNoValidCustomerProgram()&&e!==ezy.constants.vivaProductCode.vivaZero)return window.VivaFan.Popup.TriggerValidateFlightDates=!0,i.availabilityViewModel.openVivaFanPopup(),!1;var t={outFlight:i.availabilityViewModel.selectedOutboundFlight(),inFlight:i.availabilityViewModel.selectedInboundFlight(),doUpgrade:!1};a.deleteLegs(t.outFlight),a.deleteLegs(t.inFlight),$.publish("bookingBasket/showLoading"),$.ajax({type:"POST",url:"/availability/ValidateFlightDates",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",error:a.ValidateFlightDatesError,beforeSend:function(){setTimeout(function(){$.publish("availability/disableFlightSelection")},100)},success:function(e){e.Valid!==!0?($.publish("availability/enableFlightSelection"),a.ShowAllFlights(),$("#flightBookingWarning").html(e.Reason),$("#flightBookingWarning")[0].scrollIntoView(),$("#flightBookingWarning").velocity("slideDown"),a.ShowFlights(),$.publish("bookingBasket/hide"),dateValidation=!1,$(".nextday, .prevday, input[id$=btnContinue]").click(function(){$("#flightBookingWarning").velocity("slideUp"),dateValidation=!0})):($("#flightBookingError").velocity("slideUp"),$("#flightBookingWarning").velocity("slideUp"),a.DoPricing(t))}})},a.ValidateFlightDatesError=function(e){var a="";try{a=e.responseText.substr(0,e.responseText.indexOf(",")).replace("{","").replace(/\"/g,"")}catch(t){}if(a.indexOf("[SE]")>=0){try{window.dataLayer.push({event:"Session",infotype:"End",infodetail:"Validate flight dates"})}catch(r){}$("#flightBookingError").append("Your session has ended [SE]")}else window.dataLayer.push({event:"Error",errtype:"Validate flight dates",errdetail:a}),$("#flightBookingError").append(i.translations.errorMessage.FlightValid+"<br /><!-- "+e.status+": "+e.statusText+" --><br />"+a);$("#flightBookingError")[0].scrollIntoView(),$("#flightBookingError").velocity("slideDown"),$.publish("bookingBasket/hide")},a.ForceSelectOneVivaProduct=function(e){a.selectSameVivaProduct(e.ProductClassName,e.AvailType)},a.selectSameVivaProduct=function(e,i){"in"===i?(t.log("[changing outbound to use the same product as inbound flight]"),a.changeProduct(availabilityViewModel.flightsOut(),e)):"out"===i&&(t.log("[changing inbound to use the same product as outbound flight]"),a.changeProduct(availabilityViewModel.flightsIn(),e))},a.changeProduct=function(e,i){var t=$.grep(e,function(e){return e.isSelected()})[0];if(t&&t.ProductClassName!==i){var r=a.getFareDataByProductClass(t,i);r&&$.publish("availabilityNormal/selectFlight",[r,$("#"+r.SegmentKey)])}},a.getFareDataByProductClass=function(e,i){return e.ZeroFare&&e.ZeroFare.ProductClassName===i?e.ZeroFare:e.LightFare&&e.LightFare.ProductClassName===i?e.LightFare:e.BasicFare&&e.BasicFare.ProductClassName===i?e.BasicFare:e.SmartFare&&e.SmartFare.ProductClassName===i?e.SmartFare:e.FareData},a.ChangeVivaProductType=function(e){$.publish("extras/hide"),$.publish("extras/setVivaProductFromAvail",e.ProductClassName);var i=$("#farelock").is(":visible"),a=$("#farelock #farelock-checkbox").is(":checked"),t=$("#payments").is(":visible");i&&a&&t&&$.publish("payment/show")},a.DoPricing=function(e){window.dataLayer.push({event:"Selected Flight"}),i.availabilityViewModel.shouldAddMembershipFee()&&(e.addVivaFanMembershipFee=!0);var t=$("#main-content.booking").find('input[name="__RequestVerificationToken"]').val();return $.ajax({type:"POST",headers:{__RequestVerificationToken:t},url:"/Pricing/DoPricingAsync",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",error:a.PricingError,success:function(i){window.passengerDetailsViewModel.preventAutoAssignedSeatsForVivaLight=i.PreventAutoAssignedSeatsForVivaLight,a.PricingSuccess(i),a.sendBoxever(i),a.setFareLockPrice(i.FarelockPrice),ezy.availabilitySettings&&ezy.availabilitySettings.SeatingSelectionInBooking&&a.DoSeating(e,i.AmountToPay),window.ExtrasViewModel.sections.resetSteps(),window.ExtrasViewModel.getAvailableExtras(),setTimeout(function(){$("#passengerDetailsForm .firstname").first().focus()},500),window.GiftCardViewModel&&window.GiftCardViewModel.Show(!0);var t=$("#payments").is(":visible");if(t){var r=$("#farelock").is(":visible"),n=$("#farelock #farelock-checkbox").is(":checked");r||n||$.publish("extras/editExtras")}window.passengerDetailsViewModel.HideBoardingPassSection(i.HideBoardingPassSection),window.passengerDetailsViewModel&&window.passengerDetailsViewModel.printBoardingPassPrice(i.PrintBoardingPassPrice),window.InboundFareFamilyFees=i.InboundFareFamilyFees,window.OutboundFareFamilyFees=i.OutboundFareFamilyFees}}),!0},a.PricingError=function(e,a){$("#flightBookingError").html("");var t="";try{t=e.responseText.substr(0,e.responseText.indexOf(",")).replace("{","").replace(/\"/g,"")}catch(r){}t.indexOf("[SE]")>=0?window.dataLayer.push({event:"Error",errtype:"Session",errdetail:"Availability pricing error"}):window.dataLayer.push({event:"Error",errtype:"Pricing",errdetail:t}),a===!0?$("#flightBookingError").append(e):"500"==e.status&&t.indexOf("[INFANT]")>=0?$("#flightBookingError").append(i.translations.errorMessage.Infant):$("#flightBookingError").append(i.translations.errorMessage.Pricing+"<br />"+e.status+": "+e.statusText+"<br /><br />"+t),$("#flightBookingError")[0].scrollIntoView(),$("#flightBookingError").velocity("slideDown"),$.publish("bookingBasket/hide")},a.PricingSuccess=function(e){window.RouteInfo.OutboundFlightKeys=e.OutboundFlightKeys,window.RouteInfo.InboundFlightKeys=e.InboundFlightKeys;var i=[];window.RouteInfo.OutboundFlightKeys.forEach(function(e){i.push(e)}),window.RouteInfo.InboundFlightKeys.forEach(function(e){i.push(e)}),window.RouteInfo.LegDictionary={},$(i).each(function(e,i){window.RouteInfo.LegDictionary[i]=e+1});var a=window.ExtrasViewModel.getExtraByType("ExtrasPetTravel");a&&a.SetNumberOfAvailablePetOptions(e.BookingData.PetsOnboardAvailability,e.BookingData.PetsCargoAvailability),e.RenderFarelock&&$.publish("farelock/show"),$.publish("bookingBasket/show",e.BookingBasketTemplateData),$.publish("passengerInformation/show"),$("#flightBookingError").velocity("slideUp"),$("#flightBookingError").html(""),$("#watchBox").hide()},a.DoSeating=function(e,i){var a=[e.outFlight,e.inFlight];a=ko.utils.arrayFilter(a,function(e){return e}),a=ko.utils.arrayMap(a,function(e){return{from:e.DepartureAirport,to:e.ArrivalAirport,date:e.DepartureDateText,flightnumber:e.FlightNumber,classcode:e.ClassCode,segmentKey:e.SegmentKey,type:e.AvailType}}),$.publish("extras/clearSeating"),$.publish("extras/getSeating",[a,i])},a.setFareLockPrice=function(e){$("#FarelockPriceHolder").html(e)},a.displayAvail=function(e,i){},a.updateFareLockStatus=function(e,a){i.availabilityViewModel.isFareLock(a)},a.disableFlightSelection=function(){i.settings.BlockAvailabilityDuringAjaxCalls===!0&&$(".flightAvailability input[type='radio']").attr("disabled","disabled")},a.enableFlightSelection=function(){i.settings.BlockAvailabilityDuringAjaxCalls===!0&&$(".flightAvailability input[type='radio']").removeAttr("disabled")},t},ezy.views.flight.seatextras=function(){var e={};return e.selectedFlights=function(e,i){ezy.availabilitySettings&&!ezy.availabilitySettings.SeatingSelectionInChangeBooking||(i=ko.utils.arrayMap(i,function(e){return{from:e.DepartureAirport,to:e.ArrivalAirport,date:e.DepartureDateText,flightnumber:e.FlightNumber,classcode:e.ClassCode,segmentKey:e.SegmentKey,type:e.AvailType}}),$.publish("extras/getSeating",[i,null]))},$.subscribe("addextras/selectedFlights",e.selectedFlights),{}}(),window.AvailabilityDirectionViewModel=function(){var e=this;return e.Date=ko.observable(""),e.FlightSelected=ko.observable(!1),e.Loading=ko.observable(!0),e},window.AvailabilityDayPicker=function(e){var i=this;return i.Flights=[],i.displayFormat="D MMM",i.parseDateFormat="YYYY-MM-DD",i.getSelectedDayFromCriteria=function(){var i=window.criteriaModel.GetCriteria(),a=i.Flights.length>1&&"in"===e?i.Flights[1]:i.Flights[0];return a.DepartureDateString},i.selectedDay=ko.observable(i.getSelectedDayFromCriteria()),i.currentDayPrice=ko.observable("-"),i.nextDayPrice=ko.observable("-"),i.prevDayPrice=ko.observable("-"),i.switchDayLoading=ko.observable(!1),i.setAvailabilityData=function(e){i.Flights=e,i.updatePrices()},i.currentDay=ko.computed(function(){return moment(i.selectedDay(),i.parseDateFormat).format(i.displayFormat)}),i.prevDay=ko.computed(function(){return moment(i.selectedDay(),i.parseDateFormat).subtract(1,"days").format(i.displayFormat)}),i.nextDay=ko.computed(function(){return moment(i.selectedDay(),i.parseDateFormat).add(1,"days").format(i.displayFormat)}),i.updatePrices=function(){var e=i.selectedDay(),a=i.getPriceForDay(e);i.currentDayPrice(a);var t=i.getPriceForDay(moment(e,i.parseDateFormat).add(1,"days").format(i.parseDateFormat));i.nextDayPrice(t);var r=i.getPriceForDay(moment(e,i.parseDateFormat).subtract(1,"days").format(i.parseDateFormat));i.prevDayPrice(r)},i.selectedDay.subscribe(function(a){i.updatePrices(),window.availabilityNormal.ChangeSearch(a,e,!1),$(".week-search-mobile__current."+e).fadeIn(300).fadeOut(300).fadeIn(300),window.availabilityNormal.DoWeekSearch(e,window.criteriaModel.GetCriteria())}),i.selectNextDay=function(){if(i.switchDayLoading()===!1){i.switchDayLoading(!0);var e=moment(i.selectedDay(),i.parseDateFormat).add(1,"days").format(i.parseDateFormat);i.selectedDay(e)}},i.selectPrevDay=function(){if(i.switchDayLoading()===!1){i.switchDayLoading(!0);var e=moment(i.selectedDay(),i.parseDateFormat).subtract(1,"days").format(i.parseDateFormat);i.selectedDay(e)}},i.getPriceForDay=function(e){var a=$.grep(i.Flights,function(i){return i.FareData.DepartureDateText===e})[0];return a&&a.FareData.Price?a.FareData.Price:"-"},i};
ezy.views.flight.availability.availabilityMonth=function(e){var t={},a={},n={};return a.init=function(e){n=e,$.subscribe("availabilityMonth/search",a.search),$.subscribe("availabilityMonth/processAvailability",t.processAvailabilityResult),t.setEvents()},a.search=function(){var e=n.getCriteria();e.IsReturnTrip?n.returnContainer.show():n.returnContainer.hide(),n.wrapper.show();var a=e.Flights[0].DepartureDate;t.GetMonthChange(void 0!==a?a:new Date,"")},t.setEvents=function(){n.continueButton.click(function(){t.SwitchToNormalSearch()})},t.GetMonthChange=function(e,a){var i=n.getCriteria();if($("#jMonthCalendar"+a).is(":visible")&&$("#jMonthCalendar"+a).velocity("slideUp"),e<new Date&&(e=new Date),""!==a&&("Out"===a?t.SetBoardDate(e):t.SetReturnDate(e)),void 0!==n.EndDate&&e>n.EndDate){var r=i.Flights[0].DepartureDate;if(t.SetCalendar(null,"Out","Out"===a?e:r,"mxn"),i.IsReturnTrip){var l=i.Flights[1].DepartureDate;t.SetCalendar(null,"In","In"===a?e:l,"mxn")}return $(".loading").velocity("slideUp"),!0}$(".loading"+a).is(":hidden")&&$(".loading"+a).velocity("slideDown");var o=$("#main-content.booking").find('input[name="__RequestVerificationToken"]').val();$.ajax({type:"POST",headers:{__RequestVerificationToken:o},url:n.availabilitySearchUrl,data:JSON.stringify({AvailType:a,searchType:i.SearchType,adults:i.Adults,children:i.Children,infants:i.Infants,fareDesignator:i.FareDesignator,Currency:i.Currency,Flights:i.Flights}),contentType:"application/json; charset=utf-8",dataType:"json",error:function(e){t.AvailabilityError({responseText:e.statusText,status:e.status,searchType:"Month"})},success:function(e){return $.publish("availabilityMonth/processAvailability",{availabilityTemplate:e.availabilityTemplate,availType:a}),!0}})},t.AvailabilityError=function(e){var t="";try{t=e.responseText.substr(0,e.responseText.indexOf(",")).replace("{","").replace(/\"/g,"")}catch(a){}if(0!=e.status){"12029"==e.status&&(t=n.translations.errorMessages.network);var i="";try{i="SearchType - "+e.searchType+", SearchUrl - "+n.availabilitySearchUrl+" : "+n.translations.errorMessages.error+t}catch(a){}window.dataLayer.push({event:"Error",errtype:"Availability",errdetail:i}),$(".error-container").html("<div class='divError'>"+n.translations.errorMessages.error+"<br /><br />"+t+"</div>")}$(".loading").velocity("slideUp")},t.processAvailabilityResult=function(e,a){$(".loading").velocity("slideUp");var n=a.availabilityTemplate?a.availabilityTemplate.IsRoundTrip:null,i="Out"==a.availType||""==a.availType&&null!==n;i&&(t.ProccessAvailabilityResultOut(a.availabilityTemplate),t.SetBoardDate(t.ToDate(a.availabilityTemplate.BoardDateMonthYear+"-"+a.availabilityTemplate.BoardDateDay))),n&&(t.ProccessAvailabilityResultIn(a.availabilityTemplate),t.SetReturnDate(t.ToDate(a.availabilityTemplate.ReturnDateMonthYear+"-"+a.availabilityTemplate.ReturnDateDay))),i&&!n||i&&n?setTimeout(function(){$("#jMonthCalendarOut .DateBox:not(.Inactive)").first().focus()},1e3):n&&setTimeout(function(){$("#jMonthCalendarIn .DateBox:not(.Inactive)").first().focus()},1e3)},t.SetBoardDate=function(t){e.SetDepartureDate(t)},t.SetReturnDate=function(t){e.SetReturnDate(t)},t.IsCriteriaReturningFlight=function(){return!0},t.ProccessAvailabilityResultOut=function(e){var a=t.ToDate(e.BoardDateMonthYear+"-"+e.BoardDateDay);$(".departing_info h2").html(e.DepartureCity+" "+n.translations.to+" "+e.ArrivalCity),t.SetCalendar(e.OutAvailability,"Out",a,"mxn")},t.ProccessAvailabilityResultIn=function(e){var a=t.ToDate(e.ReturnDateMonthYear+"-"+e.ReturnDateDay);$(".returning_info h2").html(e.ArrivalCity+" "+n.translations.to+" "+e.DepartureCity),t.SetCalendar(e.InAvailability,"In",a,"mxn")},t.ToDate=function(e){return new Date(e.substr(0,4),e.substr(5,2)-1,e.substr(8,2))},t.CreateCustomFields=function(e){for(var t=0;t<e.length;t++){var a=e[t].SegmentKey.toString().split("/");e[t].OriginCode=a[4],e[t].DestinationCode=a[5]}},t.GetEventsFromAvailability=function(e,t,a){var i=[];if(void 0!=e)for(var r=0;r<e.length;r++){var l=e[r];i[i.length]={EventID:i.length+1,Date:l.DepartureDateText,Title:l.FareValue,DiscountInPercent:l.DiscountInPercent,OriginalPrice:l.OriginalPrice,URL:"",Description:"",CssClass:"normal",AvailType:t,FlightNumbers:l.FlightNumbers,HaveSchedule:l.HaveSchedule,FareBasisCode:l.FareBasisCode,PromoDiscountCodes:l.PromoDiscountCodes,PriceSliceImages:l.PriceSliceImages,LowestFare:l.LowestFare,IsHotDeal:l.IsHotDeal,CurrencyType:a,SeatCount:l.SeatCount,ShowSeatCount:n.ShowSeatCount,MaxSeatsLeftQuantity:n.MaxSeatsLeftQuantity,IsConnectionFlight:l.IsConnectionFlight}}return i},t.SetCalendar=function(e,a,i,r){var l,o=$("#jMonthCalendar"+a),s=t.GetEventsFromAvailability(e,a,r);try{l=o.getCalendar()}catch(u){}if(l)l.ReplaceEventCollection(s),l.DrawCalendar(i,n.EndDate),o.velocity("slideDown");else{var c={ids:{container:"#jMonthCalendar"+a,head:"#CalendarHead",body:"#CalendarBody"},checkboxGroupName:"cbxJMonthCalendar"+a,height:520,width:985,navHeight:25,labelHeight:25,firstDayOfWeek:1,onMonthChanging:function(e){t.GetMonthChange(e,a)},onEventLinkClick:function(e){return!0},onLeaveSelectedEvent:function(e){return!0},onEventBlockClick:function(e){return t.setEvent(e.Date,e.AvailType,e.EventID),!0},onEventBlockOver:function(e){return!0},onEventBlockOut:function(e){return!0},onDayLinkClick:function(e){return!0},onDayCellClick:function(e){return!0},startDate:i,endDate:n.EndDate};o.calendar(c,s,n.translations.jMonthCalender,n.FareLabels,n.SeatCount,n.ShowPromoFareLabelForConnectionFlight)}var v=n.getCriteria(),d="",h="";if(v.Flights.length>0){var y=v.Flights[0];d=y.DepartureDate}if(v.Flights.length>1){var D=v.Flights[1];h=D.DepartureDate}var p="Out"===a?d.toString("yyyy-MM-dd"):h.toString("yyyy-MM-dd"),C=t.getEvent(s,p);C&&(t.setEvent(p,a,C.EventID),t.getCurrency(C));var f=i<new Date;if(void 0!=e)for(var g=0;g<e.length;g++)if(e[g].HaveSchedule===!0){f=!0;break}f||(o.find("#CalendarHead .DateHeader").parent().remove(),o.find("#CalendarBody").html("<div class='warningContainer'>"+n.translations.warningMessages.NoFlightsFound+"</div>"),o.show())},t.getCurrency=function(e){var t=e.CurrencyType;"mxn"==t&&(t="MX$"),$(".currencyDescriptionValue").html(t),$(".currencyDescription").show()},t.getEvent=function(e,t){return ko.utils.arrayFirst(e,function(e){return e.Date===t})},t.setEvent=function(e,a,i){var r=$("#Event_"+a+"_"+i);r.find("input").prop("checked",!0),"Out"==a?t.SetBoardDate(new Date(Date.parse(e))):t.SetReturnDate(new Date(Date.parse(e))),$("#jMonthCalendar"+a).find(".selected").removeClass("selected"),r.parent().addClass("selected");var l=n.getCriteria();if(l.IsReturnTrip){var o;o="Out"==a?t.GetSelectedDayInCalendar("In"):t.GetSelectedDayInCalendar("Out"),o&&n.continueButton.show()}else n.continueButton.show()},t.SwitchToNormalSearch=function(){$("#rbExact").prop("checked",!0),n.wrapper.hide(),$.publish("availabilityNormal/search")},t.GetSelectedDayInCalendar=function(e){return new Date($("#jMonthCalendar"+e+" input:radio:checked").val())},a};
!function($){var getDateFromId=function(t){return new Date(t.substring(6,10),t.substring(2,4)-1,t.substring(4,6))},getDateId=function(t){var e=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getDate()<10?"0"+t.getDate():t.getDate(),a=String.fromCharCode(97+Math.round(25*Math.random()));return a+"_"+e+n+t.getFullYear()},GetJSONDate=function(jsonDateString){var tDt,k;if("string"==typeof jsonDateString){var isoRegPlus=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2}).([0-9]{7})$/,isoReg=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})$/,yyyyMMdd=/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/,newReg=/^new/,stdReg=/^\\\/Date\(([0-9]{13})-([0-9]{4})\)\\\/$/;return(k=jsonDateString.match(isoRegPlus))?new Date(k[1],k[2]-1,k[3]):(k=jsonDateString.match(isoReg))?new Date(k[1],k[2]-1,k[3]):(k=jsonDateString.match(yyyyMMdd))?new Date(k[1],k[2]-1,k[3]):(k=jsonDateString.match(stdReg))?new Date(k[1]):(k=jsonDateString.match(newReg))?eval("("+jsonDateString+")"):tdt}},getDateText=function(t,e){return'<div class="DateLabel d-block d-sm-none">'+t.getDate()+" "+e.locale.monthsShort[t.getMonth()]+" "+t.getFullYear()+'</div><div class="DateLabel d-none d-sm-block">'+t.getDate()+"</div>"};jQuery.jMonthCalendar=jQuery.J=function(t,e,n,a){var r,o,i,s=this,u={container:"#jMonthCalendar",head:"#CalendarHead",body:"#CalendarBody"},c=e,l=n,d=a,h={ids:u,checkboxGroupName:"cbxJMonthCalendar",height:0,width:954,navHeight:25,labelHeight:25,firstDayOfWeek:0,calendarStartDate:new Date,dragableEvents:!1,activeDroppableClass:!1,hoverDroppableClass:!1,navLinks:{enableToday:!0,enableNextYear:!0,enablePrevYear:!0,p:t.Prev,n:t.Next,t:t.Today},onMonthChanging:function(t){return!0},onMonthChanged:function(t){return!0},onEventLinkClick:function(t){return!0},onEventBlockClick:function(t){return!0},onEventBlockOver:function(t){return!0},onEventBlockOut:function(t){return!0},onDayLinkClick:function(t){return!0},onDayCellClick:function(t){return!0},onDayCellDblClick:function(t){return!0},onEventDropped:function(t,e){return!0},onLeaveSelectedEvent:function(t,e){return!0},locale:{days:t.days,daysShort:t.daysShort,daysMin:t.daysMin,months:t.months,monthsShort:t.monthsShort,weekMin:t.wk,seatsLeft:t.seatsLeft,from:t.from,lowestFare:t.lowestFare,soldOut:t.soldOut,NoFlightsLabel:t.NoFlightsLabel}};this.DrawCalendar=function(e,n){var a,u=h.calendarStartDate;void 0==e?a=new Date(u.getFullYear(),u.getMonth(),1):(a=e,a.setDate(1));var c=0==a.getMonth()?new Date(Date.UTC(a.getFullYear()-1,11,1)):new Date(Date.UTC(a.getFullYear(),a.getMonth()-1,1)),l=jQuery('<div class="MonthNavPrev"><a href="" class="link-prev"><i></i>'+h.navLinks.p+"</a></div>").click(function(){return s.ChangeMonth(c),!1}),d=11==a.getMonth()?new Date(Date.UTC(a.getFullYear()+1,0,1)):new Date(Date.UTC(a.getFullYear(),a.getMonth()+1,1)),y=jQuery('<div class="MonthNavNext"><a href="" class="link-next">'+h.navLinks.n+"<i></i></a></div>").click(function(){return s.ChangeMonth(d),!1});void 0!==n&&d>n&&(y="");var p,f=new Date(a.getFullYear()-1,a.getMonth(),a.getDate());h.navLinks.enablePrevYear&&(p=jQuery('<div class="YearNavPrev"><a href="">'+f.getFullYear()+"</a></div>").click(function(){return s.ChangeMonth(f),!1}));var g,m=new Date(a.getFullYear()+1,a.getMonth(),a.getDate());h.navLinks.enableNextYear&&(g=jQuery('<div class="YearNavNext"><a href="">'+m.getFullYear()+"</a></div>").click(function(){return s.ChangeMonth(m),!1}));var D;h.navLinks.enableToday&&(D=jQuery('<div class="TodayLink"><a href="" class="link-today">'+h.navLinks.t+"</a></div>").click(function(){return s.ChangeMonth(new Date),!1}));var v=jQuery('<tr><td colspan="7"><div class="FormHeader MonthNavigation"></div></td></tr>').css({height:h.navHeight}),M=jQuery(".MonthNavigation",v);M.append(l,y),h.navLinks.enableToday&&M.append(D),M.append(jQuery('<div class="MonthName"></div>').append(h.locale.months[a.getMonth()]+" "+a.toString("yyyy"))),h.navLinks.enableNextYear&&M.append(g),h.navLinks.enablePrevYear&&M.append(p);for(var b=jQuery("<caption> "+t.calendarCaption+"</caption>").addClass("screenreader"),k=jQuery("<tr></tr>"),w=h.firstDayOfWeek;w<h.firstDayOfWeek+7;w++){var C=w%7,T=h.locale.daysShort[C];w==h.firstDayOfWeek?k.append('<th scope="col" title="'+T+'" class="DateHeader first"><span>'+T+"</span></th>"):7==w?k.append('<th scope="col" title="'+T+'" class="DateHeader last"><span>'+T+"</span></th>"):k.append('<th scope="col" title="'+T+'" class="DateHeader"><span>'+T+"</span></th>")}k=jQuery('<thead id="CalendarHead"></thead>').append(k),k=k.prepend(v);var S=jQuery('<tbody id="CalendarBody"></tbody>'),x=a.getMonth()==u.getMonth()&&a.getFullYear()==u.getFullYear(),N=Date.getDaysInMonth(a.getFullYear(),a.getMonth()),E=h.firstDayOfWeek-a.getDay();E>0&&(E-=7);var I=N+Math.abs(E);r=new Date(a.getFullYear(),a.getMonth(),E+1),o=new Date(a.getFullYear(),a.getMonth()+1,7-(I%=7)==7?0:7-(I%=7));var j=new Date(r.getFullYear(),r.getMonth(),r.getDate()),F=0;do{var O=jQuery("<tr></tr>");O.addClass("weekrow");for(var w=0;7>w;w++){var z={"class":"DateBox",date:j.toString("M/d/yyyy"),id:getDateId(j)},P=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),Y=new Date(j.getFullYear(),j.getMonth(),j.getDate());0>E||P>Y||a.getMonth()!=Y.getMonth()?z["class"]+=" Inactive":(a.setDate(E+1),z.tabindex="0"),x&&Y.getTime()==P.getTime()&&(z["class"]+=" Today");var H=jQuery(getDateText(j,h)).click(function(t){h.onDayLinkClick(new Date($(this).parent().attr("date"))),t.stopPropagation()}),L=jQuery("<td></td>").attr(z).append(H).dblclick(function(t){h.onDayCellDblClick(new Date($(this).attr("date"))),t.stopPropagation()}).click(function(t){h.onDayCellClick(new Date($(this).attr("date"))),t.stopPropagation()}).keypress(function(t){t.preventDefault(),13!==t.keyCode&&32!==t.keyCode||$(this).find(".Event").first().click()});if(0>E||P>Y||E>=N){var Q=jQuery('<div class="Empty"></div>');L.append(Q)}h.dragableEvents&&L.droppable({hoverClass:h.hoverDroppableClass,activeClass:h.activeDroppableClass,drop:function(t,e){e.draggable.attr("style","position: relative; display: block;"),$(this).append(e.draggable);var n;return $.each(i,function(){this.EventID==e.draggable.attr("id")&&(n=this)}),h.onEventDropped(n,$(this).attr("date")),!1}}),O.append(L),E++,j.addDays(1)}F++,S.append(O)}while(N>E);var _=jQuery(h.ids.container).css({width:h.width+"px"}),A=jQuery('<table class="MonthlyCalendar" cellpadding="0" tablespacing="0" summary="'+t.calendarSummary+'"></table>').append(b).append(k,S);_.html(A),s.DrawEventsOnCalendar()},this.DrawEventsOnCalendar=function(){i&&i.length>0&&(jQuery.each(i,function(){var t,e,n=this;if(n.StartDateTime)"object"==typeof n.StartDateTime&&n.StartDateTime.getDate&&(t=n.StartDateTime),"string"==typeof n.StartDateTime&&n.StartDateTime.split&&(t=GetJSONDate(n.StartDateTime));else{if(!n.Date)return;"object"==typeof n.Date&&n.Date.getDate&&(t=n.Date),"string"==typeof n.Date&&n.Date.split&&(t=GetJSONDate(n.Date))}if(n.EndDateTime&&("object"==typeof n.EndDateTime&&n.EndDateTime.getDate&&(e=n.EndDateTime),"string"==typeof n.EndDateTime&&n.EndDateTime.split&&(e=GetJSONDate(n.EndDateTime))),t&&t>=r){var a=jQuery("td[id$="+getDateId(t).substring(1)+"]",jQuery(h.ids.container));if(n.HaveSchedule===!0){var o=jQuery(".DateLabel",a),i=null;if($.each(c,function(t,e){var r=""!==e.FareBasisCode&&0===n.FareBasisCode.indexOf(e.FareBasisCode),o=-1!==$.inArray(e.PromoDiscountCode,n.PromoDiscountCodes)&&""!==e.PromoDiscountCode;if(!d&&n.IsConnectionFlight&&(r=!1,o=!1),(r||o)&&(e.IsTwoForOne&&l>1||!e.IsTwoForOne)){var s=$("<div></div>");s.addClass("fare-label");var u=$("<span class='text'>"+e.LabelText+"</span>");e.LabelText.length>12&&u.addClass("small"),s.append(u),s.css({"background-color":e.LabelBackgroundColor}),s.append("<div class=shadow ><span class=left></span><span class=right></span></div>");var c=$("<i />");return c.css({"background-position":e.ImageX+"px "+e.ImageY+"px"}),s.prepend(c),a.append(s),i=e,!1}try{if(null!==e.DateAndRoutes){var h=e.DateAndRoutes.split(";"),y="Out"===n.AvailType,p=y?window.RouteInfo.DepartureAirportCode+"-"+window.RouteInfo.DestinationAirportCode:window.RouteInfo.DestinationAirportCode+"-"+window.RouteInfo.DepartureAirportCode;$.each(h,function(t,r){if(r===n.Date+"_"+p){var o=$("<div></div>");if(o.addClass("fare-label"),""!==e.Image){var s=$("<img alt='"+e.LabelText+"' src='"+e.Image+"'/>");s.css({width:"40px",height:"40px","margin-top":"-10px"}),o.css({"text-align":"center"}),o.append(s)}else{var u=$("<span class='text'>"+e.LabelText+"</span>");e.LabelText.length>12&&u.addClass("small"),o.append(u),o.css({"background-color":e.LabelBackgroundColor}),o.append("<div class=shadow ><span class=left></span><span class=right></span></div>");var c=$("<i />");c.css({"background-position":e.ImageX+"px "+e.ImageY+"px"}),o.prepend(c)}a.append(o),i=e}})}}catch(f){console.log(f)}}),n.LowestFare&&o.after().append("<div class='lowestFare'>"+h.locale.lowestFare+"</div>"),n.PriceSliceImages.length>0){var s=$("<div />").addClass("price-slice-images-holder");a.append(s),$.each(n.PriceSliceImages,function(t,e){s.append($("<img />").attr("src",e).attr("alt","Price slice"))})}var u=jQuery('<label class="screenreader" for="cbxDate_'+n.AvailType+"_"+n.Date+'">'+n.Date+" "+n.Title+"</label>"),y=jQuery('<input type="radio" id="cbxDate_'+n.AvailType+"_"+n.Date+'" value="'+n.Date+'" name="'+h.checkboxGroupName+'" />'),p=jQuery('<span class="from-text">'+h.locale.from+"</span>"),f=jQuery('<span class="price">'+n.Title+"</span>");null!=i&&(i.PriceImageX.length>0&&i.PriceImageY.length>0&&(p="",f.css({"background-position":i.PriceImageX+"px "+i.PriceImageY+"px"}),f.addClass("circle")),i.PriceText.length>0&&f.html(i.PriceText));var g="",m="";n.DiscountInPercent>0&&(o.addClass("discount-header"),y.css("margin-bottom","10px"),a.addClass("background-discount_"+n.DiscountInPercent),m='<br style="clear:both" /><div class="discount"><div><span class="discount-percent">'+n.DiscountInPercent+"% </span>OFF</div></div>");var D="";if(1==n.ShowSeatCount&&n.SeatCount<=n.MaxSeatsLeftQuantity){var v="margin:33px -4px -5px -4px;";n.LowestFare&&(v="margin:33px -4px -5px -4px;"),D='<div class="seat-count" title="Seats left at this price"><span class="seats-left">'+n.SeatCount+'</span>&nbsp;<span class="seats-text">'+h.locale.seatsLeft+"</span></div>","1"==n.CurrencyType?a.addClass("seat-count-hight-miles"):a.addClass("seat-count-hight")}else 0==n.ShowSeatCount&&a.addClass("adapt-noseatcount");var M=jQuery('<div class="Event" id="Event_'+n.AvailType+"_"+n.EventID+'" ></div>').append(g).append(u).append(y).append(p).append(f).append(m).append(D);n.CssClass&&M.addClass(n.CssClass),M.click(function(t){var e=$(".Event input:radio:checked").parent();h.onLeaveSelectedEvent(e),h.onEventBlockClick(n),t.stopPropagation()}),M.hover(function(){h.onEventBlockOver(n)},function(){h.onEventBlockOut(n)}),h.dragableEvents&&M.draggable({containment:"#CalendarBody"}),M.hide(),a.append(M);var b=$("<div class='dayBox' />");a.wrapInner(b),M.fadeIn("normal")}else if(0==n.HaveSchedule)a.addClass("Inactive"),0==a.find("div.Empty").length&&a.append("<div class='no-flight-label' >"+h.locale.NoFlightsLabel+"</div>");else if(getDateFromId(a[0].id)>new Date){a.addClass("SoldOut");var k=jQuery('<div class="Event"><span>'+h.locale.soldOut+"</span></div>");a.append(k)}}}),jQuery("#CalendarBody .weekrow:has(.price-slice-images-holder)",jQuery(h.ids.container)).addClass("contains-price-slices"))},this.ClearEventsOnCalendar=function(){jQuery(".Event",jQuery(h.ids.container)).remove()},this.AddEvents=function(t){t&&(t.length>1?jQuery.each(t,function(){i.push(this)}):i.push(t),s.ClearEventsOnCalendar(),s.DrawEventsOnCalendar())},this.ReplaceEventCollection=function(t){t&&(s.ClearEventsOnCalendar(),i=t)},this.ChangeMonth=function(t){h.onMonthChanging(t),h.onMonthChanged(t)},this.Initialize=function(t,e){var n=new Date;t=jQuery.extend(h,t),this.DrawCalendar(t.startDate||n,t.endDate),e&&(i=e,s.DrawEventsOnCalendar())}}}(jQuery),jQuery.fn.getCalendar=function(){var t=$.data(this[0],"calendar");return t},jQuery.fn.calendar=function(t,e,n,a,r,o){var i=$.data(this[0],"calendar");if(i)return i;var i=new jQuery.J(n,a,r,o);$.data(this[0],"calendar",i),i.Initialize(t,e)},Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}},Date.getMonthNumberFromName=function(t){for(var e=Date.CultureInfo.monthNames,n=Date.CultureInfo.abbreviatedMonthNames,a=t.toLowerCase(),r=0;r<e.length;r++)if(e[r].toLowerCase()==a||n[r].toLowerCase()==a)return r;return-1},Date.getDayNumberFromName=function(t){for(var e=Date.CultureInfo.dayNames,n=Date.CultureInfo.abbreviatedDayNames,a=(Date.CultureInfo.shortestDayNames,t.toLowerCase()),r=0;r<e.length;r++)if(e[r].toLowerCase()==a||n[r].toLowerCase()==a)return r;return-1},Date.isLeapYear=function(t){return t%4===0&&t%100!==0||t%400===0},Date.getDaysInMonth=function(t,e){return[31,Date.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},Date.getTimezoneOffset=function(t,e){return e?Date.CultureInfo.abbreviatedTimeZoneDST[t.toUpperCase()]:Date.CultureInfo.abbreviatedTimeZoneStandard[t.toUpperCase()]},Date.getTimezoneAbbreviation=function(t,e){var n,a=e?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard;for(n in a)if(a[n]===t)return n;return null},Date.prototype.clone=function(){return new Date(this.getTime())},Date.prototype.compareTo=function(t){if(isNaN(this))throw new Error(this);if(t instanceof Date&&!isNaN(t))return this>t?1:t>this?-1:0;throw new TypeError(t)},Date.prototype.equals=function(t){return 0===this.compareTo(t)},Date.prototype.between=function(t,e){var n=this.getTime();return n>=t.getTime()&&n<=e.getTime()},Date.prototype.addMilliseconds=function(t){return this.setMilliseconds(this.getMilliseconds()+t),this},Date.prototype.addSeconds=function(t){return this.addMilliseconds(1e3*t)},Date.prototype.addMinutes=function(t){return this.addMilliseconds(6e4*t)},Date.prototype.addHours=function(t){return this.addMilliseconds(36e5*t)},Date.prototype.addDays=function(t){return this.addMilliseconds(864e5*t)},Date.prototype.addWeeks=function(t){return this.addMilliseconds(6048e5*t)},Date.prototype.addMonths=function(t){var e=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+t),this.setDate(Math.min(e,this.getDaysInMonth())),this},Date.prototype.addYears=function(t){return this.addMonths(12*t)},Date.prototype.add=function(t){if("number"==typeof t)return this._orient=t,this;var e=t;return(e.millisecond||e.milliseconds)&&this.addMilliseconds(e.millisecond||e.milliseconds),(e.second||e.seconds)&&this.addSeconds(e.second||e.seconds),(e.minute||e.minutes)&&this.addMinutes(e.minute||e.minutes),(e.hour||e.hours)&&this.addHours(e.hour||e.hours),(e.month||e.months)&&this.addMonths(e.month||e.months),(e.year||e.years)&&this.addYears(e.year||e.years),(e.day||e.days)&&this.addDays(e.day||e.days),this},Date._validate=function(t,e,n,a){if("number"!=typeof t)throw new TypeError(t+" is not a Number.");if(e>t||t>n)throw new RangeError(t+" is not a valid value for "+a+".");return!0},Date.validateMillisecond=function(t){return Date._validate(t,0,999,"milliseconds")},Date.validateSecond=function(t){return Date._validate(t,0,59,"seconds")},Date.validateMinute=function(t){return Date._validate(t,0,59,"minutes")},Date.validateHour=function(t){return Date._validate(t,0,23,"hours")},Date.validateDay=function(t,e,n){return Date._validate(t,1,Date.getDaysInMonth(e,n),"days")},Date.validateMonth=function(t){return Date._validate(t,0,11,"months")},Date.validateYear=function(t){return Date._validate(t,1,9999,"seconds")},Date.prototype.set=function(t){var e=t;return e.millisecond||0===e.millisecond||(e.millisecond=-1),e.second||0===e.second||(e.second=-1),e.minute||0===e.minute||(e.minute=-1),e.hour||0===e.hour||(e.hour=-1),e.day||0===e.day||(e.day=-1),e.month||0===e.month||(e.month=-1),e.year||0===e.year||(e.year=-1),-1!=e.millisecond&&Date.validateMillisecond(e.millisecond)&&this.addMilliseconds(e.millisecond-this.getMilliseconds()),-1!=e.second&&Date.validateSecond(e.second)&&this.addSeconds(e.second-this.getSeconds()),-1!=e.minute&&Date.validateMinute(e.minute)&&this.addMinutes(e.minute-this.getMinutes()),-1!=e.hour&&Date.validateHour(e.hour)&&this.addHours(e.hour-this.getHours()),-1!==e.month&&Date.validateMonth(e.month)&&this.addMonths(e.month-this.getMonth()),-1!=e.year&&Date.validateYear(e.year)&&this.addYears(e.year-this.getFullYear()),-1!=e.day&&Date.validateDay(e.day,this.getFullYear(),this.getMonth())&&this.addDays(e.day-this.getDate()),e.timezone&&this.setTimezone(e.timezone),e.timezoneOffset&&this.setTimezoneOffset(e.timezoneOffset),this},Date.prototype.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},Date.prototype.isLeapYear=function(){var t=this.getFullYear();return t%4===0&&t%100!==0||t%400===0},Date.prototype.isWeekday=function(){return!(this.is().sat()||this.is().sun())},Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())},Date.prototype.moveToFirstDayOfMonth=function(){return this.set({day:1})},Date.prototype.moveToLastDayOfMonth=function(){return this.set({day:this.getDaysInMonth()})},Date.prototype.moveToDayOfWeek=function(t,e){var n=(t-this.getDay()+7*(e||1))%7;return this.addDays(0===n?n+=7*(e||1):n)},Date.prototype.moveToMonth=function(t,e){var n=(t-this.getMonth()+12*(e||1))%12;return this.addMonths(0===n?n+=12*(e||1):n)},Date.prototype.getDayOfYear=function(){return Math.floor((this-new Date(this.getFullYear(),0,1))/864e5)},Date.prototype.getWeekOfYear=function(t){var e=this.getFullYear(),n=this.getMonth(),a=this.getDate(),r=t||Date.CultureInfo.firstDayOfWeek,o=8-new Date(e,0,1).getDay();8==o&&(o=1);var i=(Date.UTC(e,n,a,0,0,0)-Date.UTC(e,0,1,0,0,0))/864e5+1,s=Math.floor((i-o+7)/7);if(s===r){e--;var u=8-new Date(e,0,1).getDay();s=2==u||8==u?53:52}return s},Date.prototype.isDST=function(){return"D"==this.toString().match(/(E|C|M|P)(S|D)T/)[2]},Date.prototype.getTimezone=function(){return Date.getTimezoneAbbreviation(this.getUTCOffset,this.isDST())},Date.prototype.setTimezoneOffset=function(t){var e=this.getTimezoneOffset(),n=-6*Number(t)/10;return this.addMinutes(n-e),this},Date.prototype.setTimezone=function(t){return this.setTimezoneOffset(Date.getTimezoneOffset(t))},Date.prototype.getUTCOffset=function(){var t,e=-10*this.getTimezoneOffset()/6;return 0>e?(t=(e-1e4).toString(),t[0]+t.substr(2)):(t=(e+1e4).toString(),"+"+t.substr(1))},Date.prototype.getDayName=function(t){return t?Date.CultureInfo.abbreviatedDayNames[this.getDay()]:Date.CultureInfo.dayNames[this.getDay()]},Date.prototype.getMonthName=function(t){return t?Date.CultureInfo.abbreviatedMonthNames[this.getMonth()]:Date.CultureInfo.monthNames[this.getMonth()]},Date.prototype._toString=Date.prototype.toString,Date.prototype.toString=function(t){var e=this,n=function(t){return 1==t.toString().length?"0"+t:t};return t?t.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(t){switch(t){case"hh":return n(e.getHours()<13?e.getHours():e.getHours()-12);case"h":return e.getHours()<13?e.getHours():e.getHours()-12;case"HH":return n(e.getHours());case"H":return e.getHours();case"mm":return n(e.getMinutes());case"m":return e.getMinutes();case"ss":return n(e.getSeconds());case"s":return e.getSeconds();case"yyyy":return e.getFullYear();case"yy":return e.getFullYear().toString().substring(2,4);case"dddd":return e.getDayName();case"ddd":return e.getDayName(!0);case"dd":return n(e.getDate());case"d":return e.getDate().toString();case"MMMM":return e.getMonthName();case"MMM":return e.getMonthName(!0);case"MM":return n(e.getMonth()+1);case"M":return e.getMonth()+1;case"t":return e.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return e.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"zzz":case"zz":case"z":return""}}):this._toString()},Date.now=function(){return new Date},Date.today=function(){return Date.now().clearTime()},Date.prototype._orient=1,Date.prototype.next=function(){return this._orient=1,this},Date.prototype.last=Date.prototype.prev=Date.prototype.previous=function(){return this._orient=-1,this},Date.prototype._is=!1,Date.prototype.is=function(){return this._is=!0,this},Number.prototype._dateElement="day",Number.prototype.fromNow=function(){var t={};return t[this._dateElement]=this,Date.now().add(t)},Number.prototype.ago=function(){var t={};return t[this._dateElement]=-1*this,Date.now().add(t)},function(){for(var t,e=Date.prototype,n=Number.prototype,a="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),r="january february march april may june july august september october november december".split(/\s/),o="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),i=function(t){return function(){return this._is?(this._is=!1,this.getDay()==t):this.moveToDayOfWeek(t,this._orient)}},s=0;s<a.length;s++)e[a[s]]=e[a[s].substring(0,3)]=i(s);for(var u=function(t){return function(){return this._is?(this._is=!1,this.getMonth()===t):this.moveToMonth(t,this._orient)}},c=0;c<r.length;c++)e[r[c]]=e[r[c].substring(0,3)]=u(c);for(var l=function(t){return function(){return"s"!=t.substring(t.length-1)&&(t+="s"),this["add"+t](this._orient)}},d=function(t){return function(){return this._dateElement=t,this}},h=0;h<o.length;h++)t=o[h].toLowerCase(),e[t]=e[t+"s"]=l(o[h]),n[t]=n[t+"s"]=d(t)}(),Date.prototype.toJSONString=function(){return this.toString("yyyy-MM-ddThh:mm:ssZ")},Date.prototype.toShortDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortDatePattern)},Date.prototype.toLongDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.longDatePattern)},Date.prototype.toShortTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortTimePattern)},Date.prototype.toLongTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.longTimePattern)},Date.prototype.getOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},function(){Date.Parsing={Exception:function(t){this.message="Parse error at '"+t.substring(0,10)+" ...'"}};for(var t=Date.Parsing,e=t.Operators={rtoken:function(e){return function(n){var a=n.match(e);if(a)return[a[0],n.substring(a[0].length)];throw new t.Exception(n)}},token:function(t){return function(t){return e.rtoken(new RegExp("^s*"+t+"s*"))(t)}},stoken:function(t){return e.rtoken(new RegExp("^"+t))},until:function(t){return function(e){for(var n=[],a=null;e.length;){try{a=t.call(this,e)}catch(r){n.push(a[0]),e=a[1];continue}break}return[n,e]}},many:function(t){return function(e){for(var n=[],a=null;e.length;){try{a=t.call(this,e)}catch(r){return[n,e]}n.push(a[0]),e=a[1]}return[n,e]}},optional:function(t){return function(e){var n=null;try{n=t.call(this,e)}catch(a){return[null,e]}return[n[0],n[1]]}},not:function(e){return function(n){try{e.call(this,n)}catch(a){return[null,n]}throw new t.Exception(n)}},ignore:function(t){return t?function(e){var n=null;return n=t.call(this,e),[null,n[1]]}:null},product:function(){for(var t=arguments[0],n=Array.prototype.slice.call(arguments,1),a=[],r=0;r<t.length;r++)a.push(e.each(t[r],n));return a},cache:function(e){var n={},a=null;return function(r){try{a=n[r]=n[r]||e.call(this,r)}catch(o){a=n[r]=o}if(a instanceof t.Exception)throw a;return a}},any:function(){var e=arguments;return function(n){for(var a=null,r=0;r<e.length;r++)if(null!=e[r]){try{a=e[r].call(this,n)}catch(o){a=null}if(a)return a}throw new t.Exception(n)}},each:function(){var e=arguments;return function(n){for(var a=[],r=null,o=0;o<e.length;o++)if(null!=e[o]){try{r=e[o].call(this,n)}catch(i){throw new t.Exception(n)}a.push(r[0]),n=r[1]}return[a,n]}},all:function(){var t=arguments,e=e;return e.each(e.optional(t))},sequence:function(n,a,r){return a=a||e.rtoken(/^\s*/),r=r||null,1==n.length?n[0]:function(e){for(var o=null,i=null,s=[],u=0;u<n.length;u++){try{o=n[u].call(this,e)}catch(c){break}s.push(o[0]);try{i=a.call(this,o[1])}catch(l){i=null;break}e=i[1]}if(!o)throw new t.Exception(e);if(i)throw new t.Exception(i[1]);if(r)try{o=r.call(this,o[1])}catch(d){throw new t.Exception(o[1])}return[s,o?o[1]:e]}},between:function(t,n,a){a=a||t;var o=e.each(e.ignore(t),n,e.ignore(a));return function(t){var e=o.call(this,t);return[[e[0][0],r[0][2]],e[1]]}},list:function(t,n,a){return n=n||e.rtoken(/^\s*/),a=a||null,t instanceof Array?e.each(e.product(t.slice(0,-1),e.ignore(n)),t.slice(-1),e.ignore(a)):e.each(e.many(e.each(t,e.ignore(n))),px,e.ignore(a))},set:function(n,a,r){return a=a||e.rtoken(/^\s*/),r=r||null,function(o){for(var i=null,s=null,u=null,c=null,l=[[],o],d=!1,h=0;h<n.length;h++){u=null,s=null,i=null,d=1==n.length;try{i=n[h].call(this,o)}catch(y){continue}if(c=[[i[0]],i[1]],i[1].length>0&&!d)try{u=a.call(this,i[1])}catch(p){d=!0}else d=!0;if(d||0!==u[1].length||(d=!0),!d){for(var f=[],g=0;g<n.length;g++)h!=g&&f.push(n[g]);s=e.set(f,a).call(this,u[1]),s[0].length>0&&(c[0]=c[0].concat(s[0]),c[1]=s[1])}if(c[1].length<l[1].length&&(l=c),0===l[1].length)break}if(0===l[0].length)return l;if(r){try{u=r.call(this,l[1])}catch(m){throw new t.Exception(l[1])}l[1]=u[1]}return l}},forward:function(t,e){return function(n){return t[e].call(this,n)}},replace:function(t,e){return function(n){var a=t.call(this,n);return[e,a[1]]}},process:function(t,e){return function(n){var a=t.call(this,n);return[e.call(this,a[0]),a[1]]}},min:function(e,n){return function(a){var r=n.call(this,a);if(r[0].length<e)throw new t.Exception(a);return r}}},n=function(t){return function(){var e=null,n=[];if(arguments.length>1?e=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(e=arguments[0]),!e)return t.apply(null,arguments);for(var a=0,r=e.shift();a<r.length;a++)return e.unshift(r[a]),n.push(t.apply(null,e)),e.shift(),n}},a="optional not ignore cache".split(/\s/),o=0;o<a.length;o++)e[a[o]]=n(e[a[o]]);for(var i=function(t){return function(){return arguments[0]instanceof Array?t.apply(null,arguments[0]):t.apply(null,arguments)}},s="each any all".split(/\s/),u=0;u<s.length;u++)e[s[u]]=i(e[s[u]])}(),function(){var t=function(e){for(var n=[],a=0;a<e.length;a++)e[a]instanceof Array?n=n.concat(t(e[a])):e[a]&&n.push(e[a]);return n};Date.Grammar={},Date.Translator={hour:function(t){return function(){this.hour=Number(t)}},minute:function(t){return function(){this.minute=Number(t)}},second:function(t){return function(){this.second=Number(t)}},meridian:function(t){return function(){this.meridian=t.slice(0,1).toLowerCase()}},timezone:function(t){return function(){var e=t.replace(/[^\d\+\-]/g,"");e.length?this.timezoneOffset=Number(e):this.timezone=t.toLowerCase()}},day:function(t){var e=t[0];return function(){this.day=Number(e.match(/\d+/)[0])}},month:function(t){return function(){this.month=3==t.length?Date.getMonthNumberFromName(t):Number(t)-1}},year:function(t){return function(){var e=Number(t);this.year=t.length>2?e:e+(e+2e3<Date.CultureInfo.twoDigitYearMax?2e3:1900)}},rday:function(t){return function(){switch(t){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(t){t=t instanceof Array?t:[t];var e=new Date;this.year=e.getFullYear(),this.month=e.getMonth(),this.day=1,this.hour=0,this.minute=0,this.second=0;for(var n=0;n<t.length;n++)t[n]&&t[n].call(this);if(this.hour="p"==this.meridian&&this.hour<13?this.hour+12:this.hour,this.day>Date.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var a=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return this.timezone?a.set({timezone:this.timezone}):this.timezoneOffset&&a.set({timezoneOffset:this.timezoneOffset}),a},finish:function(e){if(e=e instanceof Array?t(e):[e],0===e.length)return null;for(var n=0;n<e.length;n++)"function"==typeof e[n]&&e[n].call(this);if(this.now)return new Date;var a=Date.today(),r=!(null==this.days&&!this.orient&&!this.operator);if(r){var o,i,s;return s="past"==this.orient||"subtract"==this.operator?-1:1,this.weekday&&(this.unit="day",o=Date.getDayNumberFromName(this.weekday)-a.getDay(),i=7,this.days=o?(o+s*i)%i:s*i),this.month&&(this.unit="month",o=this.month-a.getMonth(),i=12,this.months=o?(o+s*i)%i:s*i,this.month=null),this.unit||(this.unit="day"),null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),"week"==this.unit&&(this.unit="day",this.value=7*this.value),this[this.unit+"s"]=this.value*s),a.add(this)}return this.meridian&&this.hour&&(this.hour=this.hour<13&&"p"==this.meridian?this.hour+12:this.hour),this.weekday&&!this.day&&(this.day=a.addDays(Date.getDayNumberFromName(this.weekday)-a.getDay()).getDate()),this.month&&!this.day&&(this.day=1),a.set(this)}};var e,n=Date.Parsing.Operators,a=Date.Grammar,r=Date.Translator;a.datePartDelimiter=n.rtoken(/^([\s\-\.\,\/\x27]+)/),a.timePartDelimiter=n.stoken(":"),a.whiteSpace=n.rtoken(/^\s*/),a.generalDelimiter=n.rtoken(/^(([\s\,]|at|on)+)/);var o={};a.ctoken=function(t){var e=o[t];if(!e){for(var a=Date.CultureInfo.regexPatterns,r=t.split(/\s+/),i=[],s=0;s<r.length;s++)i.push(n.replace(n.rtoken(a[r[s]]),r[s]));e=o[t]=n.any.apply(null,i)}return e},a.ctoken2=function(t){return n.rtoken(Date.CultureInfo.regexPatterns[t])},a.h=n.cache(n.process(n.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),r.hour)),a.hh=n.cache(n.process(n.rtoken(/^(0[0-9]|1[0-2])/),r.hour)),a.H=n.cache(n.process(n.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),r.hour)),a.HH=n.cache(n.process(n.rtoken(/^([0-1][0-9]|2[0-3])/),r.hour)),a.m=n.cache(n.process(n.rtoken(/^([0-5][0-9]|[0-9])/),r.minute)),a.mm=n.cache(n.process(n.rtoken(/^[0-5][0-9]/),r.minute)),a.s=n.cache(n.process(n.rtoken(/^([0-5][0-9]|[0-9])/),r.second)),a.ss=n.cache(n.process(n.rtoken(/^[0-5][0-9]/),r.second)),
a.hms=n.cache(n.sequence([a.H,a.mm,a.ss],a.timePartDelimiter)),a.t=n.cache(n.process(a.ctoken2("shortMeridian"),r.meridian)),a.tt=n.cache(n.process(a.ctoken2("longMeridian"),r.meridian)),a.z=n.cache(n.process(n.rtoken(/^(\+|\-)?\s*\d\d\d\d?/),r.timezone)),a.zz=n.cache(n.process(n.rtoken(/^(\+|\-)\s*\d\d\d\d/),r.timezone)),a.zzz=n.cache(n.process(a.ctoken2("timezone"),r.timezone)),a.timeSuffix=n.each(n.ignore(a.whiteSpace),n.set([a.tt,a.zzz])),a.time=n.each(n.optional(n.ignore(n.stoken("T"))),a.hms,a.timeSuffix),a.d=n.cache(n.process(n.each(n.rtoken(/^([0-2]\d|3[0-1]|\d)/),n.optional(a.ctoken2("ordinalSuffix"))),r.day)),a.dd=n.cache(n.process(n.each(n.rtoken(/^([0-2]\d|3[0-1])/),n.optional(a.ctoken2("ordinalSuffix"))),r.day)),a.ddd=a.dddd=n.cache(n.process(a.ctoken("sun mon tue wed thu fri sat"),function(t){return function(){this.weekday=t}})),a.M=n.cache(n.process(n.rtoken(/^(1[0-2]|0\d|\d)/),r.month)),a.MM=n.cache(n.process(n.rtoken(/^(1[0-2]|0\d)/),r.month)),a.MMM=a.MMMM=n.cache(n.process(a.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),r.month)),a.y=n.cache(n.process(n.rtoken(/^(\d\d?)/),r.year)),a.yy=n.cache(n.process(n.rtoken(/^(\d\d)/),r.year)),a.yyy=n.cache(n.process(n.rtoken(/^(\d\d?\d?\d?)/),r.year)),a.yyyy=n.cache(n.process(n.rtoken(/^(\d\d\d\d)/),r.year)),e=function(){return n.each(n.any.apply(null,arguments),n.not(a.ctoken2("timeContext")))},a.day=e(a.d,a.dd),a.month=e(a.M,a.MMM),a.year=e(a.yyyy,a.yy),a.orientation=n.process(a.ctoken("past future"),function(t){return function(){this.orient=t}}),a.operator=n.process(a.ctoken("add subtract"),function(t){return function(){this.operator=t}}),a.rday=n.process(a.ctoken("yesterday tomorrow today now"),r.rday),a.unit=n.process(a.ctoken("minute hour day week month year"),function(t){return function(){this.unit=t}}),a.value=n.process(n.rtoken(/^\d\d?(st|nd|rd|th)?/),function(t){return function(){this.value=t.replace(/\D/g,"")}}),a.expression=n.set([a.rday,a.operator,a.value,a.unit,a.orientation,a.ddd,a.MMM]),e=function(){return n.set(arguments,a.datePartDelimiter)},a.mdy=e(a.ddd,a.month,a.day,a.year),a.ymd=e(a.ddd,a.year,a.month,a.day),a.dmy=e(a.ddd,a.day,a.month,a.year),a.date=function(t){return(a[Date.CultureInfo.dateElementOrder]||a.mdy).call(this,t)},a.format=n.process(n.many(n.any(n.process(n.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(t){if(a[t])return a[t];throw Date.Parsing.Exception(t)}),n.process(n.rtoken(/^[^dMyhHmstz]+/),function(t){return n.ignore(n.stoken(t))}))),function(t){return n.process(n.each.apply(null,t),r.finishExact)});var i={},s=function(t){return i[t]=i[t]||a.format(t)[0]};a.formats=function(t){if(t instanceof Array){for(var e=[],a=0;a<t.length;a++)e.push(s(t[a]));return n.any.apply(null,e)}return s(t)},a._formats=a.formats(["yyyy-MM-ddTHH:mm:ss","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","d"]),a._start=n.process(n.set([a.date,a.time,a.expression],a.generalDelimiter,a.whiteSpace),r.finish),a.start=function(t){try{var e=a._formats.call({},t);if(0===e[1].length)return e}catch(n){}return a._start.call({},t)}}(),Date._parse=Date.parse,Date.parse=function(t){var e=null;if(!t)return null;try{e=Date.Grammar.start.call({},t)}catch(n){return null}return 0===e[1].length?e[0]:null},Date.getParseFunction=function(t){var e=Date.Grammar.formats(t);return function(t){var n=null;try{n=e.call({},t)}catch(a){return null}return 0===n[1].length?n[0]:null}},Date.parseExact=function(t,e){return Date.getParseFunction(e)(t)};
ezy.views.flight.passengerdetails={},ezy.views.flight.passengerdetails.index=function(){var e,a={},t={};return t.init=function(t){try{e=t,a.isAutoCompleteDone=!1,null!=$.cookie(e.passengerDetailsCookie)&&(a.passengers=JSON.parse($.cookie(e.passengerDetailsCookie))),a.setAdultDateOfBirthABTest(function(){a.setValidation()}),a.setSubscriptions(),a.bindEvents(),$("#btnContinuePassengerDetails").click(function(){e.loggingEnabled&&console.log("[PassengerDetails] continue button clicked."),$("#btnPaxContinue").click()}),$("#btnInspectOutboundXml").length&&$("#btnInspectOutboundXml").click(function(){a.onInspectXmlClicked(!0)}),$("#btnInspectInboundXml").length&&$("#btnInspectInboundXml").click(function(){a.onInspectXmlClicked(!1)}),e.loggingEnabled&&console.log("[PassengerDetails] initialization done.")}catch(s){a.showError(e.localization.PostNotPossibleRestartYourSession),console.log("[PassengerDetails] initialization error."),console.log(s)}},a.setAdultDateOfBirthABTest=function(a){if(e.adultDateOfBirthABTestEnabled!==!0)return void a();if(void 0===window.passengerDetailsViewModel||null===window.passengerDetailsViewModel)return void a();try{$.ajax({type:"POST",url:"/PassengerDetailsPart/GetAdultDateOfBirthExperimentNumber",contentType:"application/json; charset=utf-8",success:function(a){1===a.experimentNumber?(window.passengerDetailsViewModel.showAdultDateOfBirth(!0),e.dateOfBirthRequiredForAdults=!0):2===a.experimentNumber?(window.passengerDetailsViewModel.showAdultDateOfBirth(!0),e.dateOfBirthRequiredForAdults=!1):(window.passengerDetailsViewModel.showAdultDateOfBirth(!1),e.dateOfBirthRequiredForAdults=!1);var t={xvb:{EXP003:""+a.experimentNumber}};ezy.Analytics.Send(t)},complete:function(){a()}})}catch(t){a()}},a.updateHandicapSsrsAsync=function(e){if(ezy.defaultAjax("/PassengerDetailsPart/UpdateHandicapSsrsAsync",e),this.passengers)for(var a=0;a<this.passengers.length;a++){var t="Passengers["+a+"]";e.hasOwnProperty(t+".Handicap")&&e[t+".Handicap"]&&window.ExtrasViewModel.seating.HandleBlockedSeatsForPassengerAndFlight(parseInt(e[t+".passengerNumber"]))}else{var s=0,n=[];Object.keys(e).forEach(function(e){var a=e==="Passengers["+s+"].passengerNumber";a&&(n.push(s),s+=1)}),n.forEach(function(a){var t="Passengers["+a+"]";e.hasOwnProperty(t+".Handicap")&&e[t+".Handicap"]&&window.ExtrasViewModel.seating.HandleBlockedSeatsForPassengerAndFlight(parseInt(e[t+".passengerNumber"]))})}},a.showLoginPrompt=function(){var a={modal:!0,buttons:[{clsName:"button accept",title:"<span>"+e.localization.VivaFanLoginPrompt.ConfirmDialogText+"<i></i></span>",value:!0,altTitle:e.localization.VivaFanLoginPrompt.ConfirmDialogText},{clsName:"button cancel",title:"<span>"+e.localization.VivaFanLoginPrompt.CancelDialogText+"<i></i></span>",value:!1,altTitle:e.localization.VivaFanLoginPrompt.CancelDialogText}],maxWidth:500};ezy.fancyConfirm(e.localization.VivaFanLoginPrompt.DialogContent,e.localization.VivaFanLoginPrompt.DialogQuestion,a,function(e){if(e){var a=window.passengerDetailsViewModel.passengers()[0];window.VivaFan.SidePanel.username(a.email()),window.VivaFan.SidePanel.RemoveFeesIfUserHasValidCustomerProgram=!0,window.VivaFan.TopLogin.showSidePanel()}$.fancybox.close()})},a.setValidation=function(){var t=!1,s=function(e,a){$(e).rules("add",{notEqual:"0",messages:{notEqual:a}})};e.form.find("input").each(function(){try{$(this)[0].form=e.form[0]}catch(a){}}),e.form.validate({submitHandler:function(t){if($(".duplicate-ktn-number:visible").length>0||$(".duplicate-passport-number:visible").length>0)return $("html, body").animate({scrollTop:$("#passengerDetailsError").offset().top-75},500),!1;if(e.loggingEnabled&&console.log("[PassengerDetails] duplicate-ktn-number passed."),!$(t).valid()){e.loggingEnabled&&console.log("[PassengerDetails] form is not valid.");try{dataLayer.push({event:"Error",errtype:"Passenger",errdetail:"Validation Failed"})}catch(s){console.log(s)}return 0==jQuery.fn.placeholder.input&&($(".passengerDetails [placeholder]").trigger("blur.placeholder"),$("#btnContinuePassengerDetails").focus()),!1}e.loggingEnabled&&console.log("[PassengerDetails] $(form).valid() passed."),window.GiftCardViewModel&&(window.GiftCardViewModel.Success(!1),window.GiftCardViewModel.Error(""));var n=e.form.serializeObject();n["Passengers[0].mobile"]=$("#mobile").intlTelInput("getNumber"),n["Passengers[0].phone"]=$("#phone").intlTelInput("getNumber"),e.loggingEnabled&&console.log("[PassengerDetails] serialization finished. passengerData: ",n);var r=JSON.stringify(n);return e.loggingEnabled&&console.log("[PassengerDetails] before enabling loader."),$.publish("extras/showExtrasLoading"),$("#btnContinuePassengerDetails").hide(),e.loggingEnabled&&console.log("[PassengerDetails] before PostAsync request - find PostAsync request in network tab."),$("#timbre-tax-message").hide(),$("#tax-message-container").hide(),$("#tourism-colombia-tax-message").hide(),$.ajax({type:"POST",url:"/PassengerDetailsPart/PostAsync",data:r,contentType:"application/json; charset=utf-8",dataType:"json",error:function(t){$("#btnContinuePassengerDetails").show(),$.publish("extras/hideExtrasLoading");var s="";try{s=t.responseText.substr(0,t.responseText.indexOf("</title>")).replace("</title>","").replace("<title>","").replace("<html>","").replace("<head>","")}catch(n){console.log(n)}if(s.indexOf("[SE]")>=0)try{dataLayer.push({event:"Session",infotype:"Passenger details"})}catch(r){console.log(r)}else try{dataLayer.push({event:"Error",errtype:"Passenger",errdetail:"General "+t.responseText})}catch(r){console.log(r)}e.loggingEnabled&&console.log("[PassengerDetails] Error returned. Msg",t),a.showError(e.localization.PostNotPossibleRestartYourSession)},success:function(t){$.publish("extras/hideExtrasLoading"),e.loggingEnabled&&(console.log("[PassengerDetails] Success function called. Check result property. Data",t),console.log("[PassengerDetails] Success function called. Options",e));try{if(t.result===!1)t.emailExist&&window.VivaFan.TopLogin?a.showLoginPrompt():t.duplicatePassport?a.showError(e.localization.PassportNumbersShouldBeUniqueText):t.duplicateKtn?a.showError(e.localization.KTNNumbersShouldBeUniqueText):a.showError(e.localization.AjaxRequestError),$("#btnContinuePassengerDetails").show();else{$("#divInfantService .passengerNo").val(t.adultsWithInfant),e.newsletterEnabled&&a.performNewsletterActions(),a.updateHandicapSsrsAsync(n),a.sendBoxever(t),a.showSummary(t),$("#passengerDetailsError ul").hide(),window.ezy.FareLockActive=t.IsFareLock===!0,window.passengerDetailsViewModel.PassengerDetailsDone=!0;var s={passengers:$.grep(t.PassengerData.Passengers,function(e){return"INF"!==e.Type})};$.publish("vivaScotiaCard/setPassengers",s),e.loggingEnabled&&console.log("[PassengerDetails] window.ezy.FareLockActive (should be false): "+window.ezy.FareLockActive+" ,options.isChaterFlight (should be false): "+e.isChaterFlight+" , to display extras."),window.ezy.FareLockActive||e.isChaterFlight!==!1?$.publish("payment/show"):($.publish("extras/show"),window.dataLayer.push({event:"DisplayExtras",infotype:"Ezy"}));var r=window.passengerDetailsViewModel.passengers(),o=ko.toJSON(r),i=o.extractToJsonAndThenParseSubsetOfJsonAndThenStringifyItBack();t.TimbreTaxAdded&&($("#timbre-tax-message").show(),$("#tax-message-container").show()),t.TourismColombiaTaxAdded&&($("#tourism-colombia-tax-message").show(),$("#tax-message-container").show()),$.cookie(e.passengerDetailsCookie,i),t.BrazeExternalUserId&&($.cookie("V3",t.BrazeExternalUserId,{expires:730,path:"/"}),window.dataLayer.push({event:"OptIn"})),window.upliftViewModel&&window.upliftViewModel.isPaymentFormVisible()&&(window.upliftViewModel.reInitiateUplift(),$.publish("payment/hideAndCloseAllPaymentOption"),$.publish("payment/show"))}}catch(l){e.loggingEnabled&&console.log("[PassengerDetails] Error in success callback function.",l),a.showError(e.localization.PostNotPossibleRestartYourSession)}}}),e.loggingEnabled&&console.log("[PassengerDetails] validation function finished."),!1},debug:!0,rules:{},ignore:":hidden:not(.dob, .passportExpiryDate)",messages:{},errorContainer:"#passengerDetailsError",errorLabelContainer:"#passengerDetailsError ul",wrapper:"li",invalidHandler:function(e,a){a.numberOfInvalids()&&(t=!0)},showErrors:function(e,a){this.defaultShowErrors(),($(".duplicate-ktn-number:visible").length>0||$(".duplicate-passport-number:visible").length>0)&&($("#passengerDetailsError ul").show(),$("#passengerDetailsError").show()),t&&$("html, body").animate({scrollTop:$("#passengerDetailsError").offset().top-75},500),t=!1}}),e.printBoardingPassSelect.each(function(a,t){s(t,e.localization.MakeASelectionValidation)}),e.state.each(function(a,t){s(t,e.localization.StateRequired)}),e.country.each(function(a,t){s(t,e.localization.CountryRequired)}),e.nationalitySelect.each(function(a,t){s(t,e.localization.NationalityRequired)}),e.name.each(function(a,t){$(t).rules("add",{required:!0,minlength:2,noDigits:!0,nameContainsDot:!0,messages:{required:e.localization.FullNameRequired,minlength:e.localization.FullNameRequired,noDigits:e.localization.FullNameRequired,nameContainsDot:e.localization.DotNotAllowedInName}})}),$(".passportExpiryDate").each(function(a,t){$(t).rules("add",{passportExpiryDateValidation:!0,messages:{passportExpiryDateValidation:e.localization.PassportExpiredText}})}),jQuery.validator.addMethod("nameContainsDot",function(e,a){return!e.match(/\./g)},"Your username contains a dot!"),$.validator.addMethod("passportExpiryDateValidation",function(a,t){if($(t).closest(".passportDetails").is(":hidden"))return!0;var s=moment(a,"YYYY-MM-DD");return s>=e.passportExpiryDate},e.localization.PassportExpiredText),$(e.email).each(function(a,t){-1!==$(t).attr("name").indexOf("[0]")&&$(t).rules("add",{required:!0,messages:{required:e.localization.EmailValid}}),$(t).rules("add",{email:!0,messages:{email:e.localization.EmailValid}})}),$(e.repeatEmail).each(function(a,t){-1!=$(t).attr("name").indexOf("[0]")&&$(t).rules("add",{required:!0,messages:{required:e.localization.EmailValid}}),$(t).rules("add",{email:!0,equalTo:$(t).closest(".row").find(".email"),messages:{email:e.localization.EmailValid,equalTo:e.localization.RepeatEmailValid}})}),$(e.mobile).each(function(a,t){-1!==$(t).attr("name").indexOf("[0]")&&$(t).rules("add",{phoneNumber:!0,messages:{phoneNumber:e.localization.MobileValid}})}),$(e.phone).each(function(a,t){-1!==$(t).attr("name").indexOf("[0]")&&$(t).rules("add",{required:!0,phoneNumber:!0,messages:{required:e.localization.PhoneValid,phoneNumber:e.localization.PhoneValid}})}),e.day.each(function(a,t){$(t).rules("add",{notEqual:"0",messages:{notEqual:e.localization.DayRequired}})}),e.year.each(function(a,t){$(t).rules("add",{notEqual:"0",messages:{notEqual:e.localization.YearRequired}})}),e.month.each(function(a,t){$(t).rules("add",{notEqual:"0",messages:{notEqual:e.localization.MonthRequired}})}),$(".dob").each(function(a,t){var s=$(this).attr("type"),n="INF"!==s&&"CHD"!==s,r=e.isInternationalFlight===!0||e.dateOfBirthRequiredForAdults===!0&&window.passengerDetailsViewModel.showAdultDateOfBirth()===!0;(n===!1||n&&r)&&($(t).rules("add",{DOBRequired:!0,messages:{DOBRequired:e.localization.DobRequired}}),$(t).rules("add",{DOBAfterDeparture:!0,messages:{DOBAfterDeparture:e.localization.DobIsAfterDeparture}})),"INF"===s&&$(t).rules("add",{CheckInfantDOB:!0,messages:{CheckInfantDOB:e.localization.InfantAgeOutsideRange}})}),$.validator.addMethod("travelWith",function(a){var t=[];e.travelWith.each(function(){var e=parseFloat($(this).val());e>=0&&t.push(e)});var s=!t.CheckForDuplicates(a);return s&&(e.travelWith.removeClass("error"),$("#passengerDetailsError").hide(),$("#passengerDetailsError label[for*='travelWith']").filter(":visible").css("display","none")),s},e.localization.TravelWithDuplicates),$.validator.addMethod("DOBRequired",function(e,a){var t=e.split("-"),s=parseInt(t[2]),n=parseInt(t[1]),r=parseInt(t[0]);return 0!==s&&!isNaN(s)&&0!==n&&!isNaN(n)&&0!==r&&!isNaN(r)},e.localization.DobRequired),$.validator.addMethod("DOBAfterDeparture",function(a,t){var s=moment(e.dateToCompareDOBWith),n=a.split("-"),r=parseInt(n[2]),o=parseInt(n[1])-1,i=parseInt(n[0]),l=moment().set({year:r,month:o,date:i});return s>=l},e.localization.DobIsAfterDeparture),$.validator.addMethod("CheckInfantDOB",function(a,t){var s=moment(e.dateToCompareDOBWith),n=a.split("-"),r=parseInt(n[2])+2,o=parseInt(n[1])-1,i=parseInt(n[0]),l=moment().set({year:r,month:o,date:i});return l.diff(s)>=0},e.localization.InfantAgeOutsideRange),jQuery.validator.classRuleSettings.travelWith={travelWith:!0},e.travelWith.each(function(a,t){$(t).rules("add",{notEqual:"-1",messages:{notEqual:e.localization.TravelWithRequired}})}),$(e.passportNumber).each(function(a,t){$(t).rules("add",{isValidPassportNumber:!0,messages:{isValidPassportNumber:e.localization.InvalidPassportNumber}})}),$(e.ktnNumber).each(function(a,t){$(t).rules("add",{isValidKtnNumber:!0,messages:{isValidKtnNumber:e.localization.InvalidKnownTravelerNumberText}})}),$.validator.addMethod("isValidKtnNumber",function(e,a){if($(this).closest(".passportDetails").is(":hidden"))return!0;var t=new RegExp("^[0-9]{9,10}$");return t.test(e)},e.localization.InvalidKnownTravelerNumberText),$.validator.addMethod("isValidPassportNumber",function(e,a){if($(this).closest(".passportDetails").is(":hidden"))return!0;var t=new RegExp("^[0-9a-zA-Z]{7,10}$");return t.test(e)},e.localization.InvalidPassportNumber)},a.validateDuplicateTravelDocuments=function(){a.validateDocumentByType(".ktn-number","duplicate-ktn-number"),a.validateDocumentByType(".passport-number","duplicate-passport-number"),$("#passengerDetailsError ul .duplicate-ktn-error").remove(),$("#passengerDetailsError ul .duplicate-passport-error").remove(),$(".duplicate-passport-number:visible").length>0&&$("#passengerDetailsError ul").append('<li class="duplicate-passport-error">'+e.localization.PassportNumbersShouldBeUniqueText+"</li>"),$(".duplicate-ktn-number:visible").length>0&&$("#passengerDetailsError ul").append('<li class="duplicate-ktn-error">'+e.localization.KTNNumbersShouldBeUniqueText+"</li>");var t=$("#passengerDetailsError  li").filter(function(){return"none"!==this.style.display}).length;0==t?($("#passengerDetailsError ul").hide(),$("#passengerDetailsError").hide()):($("#passengerDetailsError ul").show(),$("#passengerDetailsError").show())},a.validateDocumentByType=function(e,a){var t=[];$(e+":visible").each(function(){t.push($(this).val().trim().toLowerCase())}),$(e+":visible").each(function(){var e=$(this).val().trim().toLowerCase();if(""===e)return $(this).removeClass(a),!0;var s=t.filter(function(a){return a===e}).length;s>1?$(this).addClass(a):$(this).removeClass(a)})},a.sendBoxever=function(a){for(var t=a.PassengerData.Passengers[0],s=[],n=0;n<a.PassengerData.Passengers.length;n++){var r=a.PassengerData.Passengers[n];s.push({title:null!=t.Title?t.Title:"",firstName:r.Firstname,lastName:r.Lastname})}var o={box:"Passenger",sca:{consumer:s,contact:{title:null!=t.Title?t.Title:"",firstName:t.Firstname,lastName:t.Lastname,email:t.Email,mobile:t.Mobile,phone:t.Phone,state:t.State,countryCode:t.Country}}};dataLayer.push(o),console.log("Boxever.eventCreate(passengerEvent, function (data) { }, 'json');"),console.log(o);var i={ecommerce:{checkout:{actionField:{step:1,option:void 0!==e.newsletter&&e.newsletter[0].checked?"Yes":"No"},products:dataLayerSelectedProducts}},event:"checkoutPassenger"};dataLayer.push(i)},a.setSubscriptions=function(){$.subscribe("passengerInformation/show",a.show),$.subscribe("passengerInformation/showPaxEditLink",a.showPaxEditLink)},a.showPaxEditLink=function(e,a){window.passengerDetailsViewModel.showEditInfoLink(a)},a.IsNumeric=function(e){return/^\d+$/.test(e)},a.bindEvents=function(){if(e.mobile.on("change",function(){var a=e.mobile.intlTelInput("getSelectedCountryData");""===e.phone.val()&&e.phone.intlTelInput("selectCountry",a.iso2)}),e.passportNumber.on("focusout",function(){a.validateDuplicateTravelDocuments()}),e.ktnNumber.on("focusout",function(){a.validateDuplicateTravelDocuments()}),e.phone.on("change",function(){var a=e.phone.intlTelInput("getSelectedCountryData");""===e.mobile.val()&&e.mobile.intlTelInput("selectCountry",a.iso2)}),null!=a.passengers&&e.autocompleteWithCookie){var t=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,s=t?"blur":"keyup";e.form.find("#Adults\\[0\\]\\.FirstName").bind(s,a.checkForMatchingFirstNameInCookie)}e.edit.click(a.showForm),e.handicap.click(function(){var e=$(this).parent().find(".special-assistance-drop"),a=e.is(":visible");e.toggle(!a);var t=ko.dataFor(e[0]);if(t){var s=t.passengerNumber();a?window.passengerDetailsViewModel.printBoardingPassExcludedPassengerNumbers.remove(function(e){return e===s}):window.passengerDetailsViewModel.printBoardingPassExcludedPassengerNumbers.push(s)}console.log(window.passengerDetailsViewModel.printBoardingPassExcludedPassengerNumbers())}),e.email.bind("copy cut",function(e){return!1}),e.repeatEmail.bind("paste",function(e){return!1}),e.email.on("blur",function(){$(this).mailcheck({domains:e.mailcheck.domains,secondLevelDomains:e.mailcheck.secondLevelDomains,topLevelDomains:e.mailcheck.topLevelDomains,suggested:function(a,t){e.suggestedEmailAddress.text(t.full),e.didYouMeanEmail.fadeIn("fast")},empty:function(a){e.didYouMeanEmail.fadeOut("fast")}})}),e.suggestedEmailAddress.click(function(){var a=$(this).text();e.email.val(a),e.email.trigger("blur"),e.repeatEmail.trigger("blur"),e.didYouMeanEmail.fadeOut("fast")}),e.documentType.on("change",function(){a.UpdateErrorsAfterVisibilityChange()}),e.passportIncludeOption.on("change",function(){a.UpdateErrorsAfterVisibilityChange()})},a.UpdateErrorsAfterVisibilityChange=function(){setTimeout(function(){a.validateDuplicateTravelDocuments(),$(".ktn-number:hidden").each(function(){$("#passengerDetailsError label[for*='"+$(this).attr("id")+"']").parent().hide()}),$(".passport-number:hidden").each(function(){$("#passengerDetailsError label[for*='"+$(this).attr("id")+"']").parent().hide()}),$(".ktn-number:visible").each(function(){$(this).hasClass("error")&&$("#passengerDetailsError label[for*='"+$(this).attr("id")+"']").parent().show()}),$(".passport-number:visible").each(function(){$(this).hasClass("error")&&$("#passengerDetailsError label[for*='"+$(this).attr("id")+"']").parent().show()});var e=$("#passengerDetailsError  li").filter(function(){return"none"!==this.style.display}).length;e>0?($("#passengerDetailsError ul").show(),$("#passengerDetailsError").show()):$("#passengerDetailsError").hide()},500)},a.getAdult1FirstName=function(){for(var e="",t=a.passengers.length,s=0;t>s;s++){var n=a.passengers[s].type;if("CHD"!=n&&"INF"!=n){e=a.passengers[s].firstName;break}}return e},a.checkForMatchingFirstNameInCookie=function(t){if(a.isAutoCompleteDone||window.passengerDetailsViewModel.vivaFanLoggedIn())return!1;var s=$.trim(a.getAdult1FirstName().toString().toLowerCase()),n=$.trim($(this).val().toString().toLowerCase()),r=!1;return"keyup"===t.type&&3===n.length&&s.substring(0,3)===n?r=!0:n.length>1&&n===s&&(r=!0),r&&(a.isAutoCompleteDone=!0,confirm(e.localization.CookieComplete)&&a.autocompleteForm()),!0},a.getKOPassengerByType=function(e,a){for(var t=[],s=0;s<e.length;s++)e[s].type()==a&&t.push(e[s]);return t},a.getCookiePassengerByType=function(e,a){for(var t=[],s=0;s<e.length;s++)e[s].type==a&&t.push(e[s]);return t},a.autocompleteForm=function(){for(var e=window.passengerDetailsViewModel.passengers(),t=a.getKOPassengerByType(e,ezy.PaxTypes.Adult),s=a.getKOPassengerByType(e,ezy.PaxTypes.Child),n=a.getKOPassengerByType(e,ezy.PaxTypes.Infant),r=a.getCookiePassengerByType(a.passengers,ezy.PaxTypes.Adult),o=a.getCookiePassengerByType(a.passengers,ezy.PaxTypes.Child),i=a.getCookiePassengerByType(a.passengers,ezy.PaxTypes.Infant),l=0;l<t.length;l++)l<r.length&&(e[l].firstName(r[l].firstName),e[l].lastName(r[l].lastName),e[l].title(r[l].title),e[l].travelWith(r[l].travelWith),e[l].Day(r[l].Day),e[l].Month(r[l].Month),e[l].Year(r[l].Year),0===l&&(e[l].email(r[l].email),e[l].repeatemail(r[l].repeatemail),e[l].mobile(r[l].mobile),e[l].phone(r[l].phone),$("#mobile").intlTelInput("setNumber",r[l].mobile),$("#phone").intlTelInput("setNumber",r[l].phone)));for(var u=0,d=t.length;d<t.length+s.length;d++)u<o.length&&(e[d].firstName(o[u].firstName),e[d].lastName(o[u].lastName),e[d].title(o[u].title),e[d].travelWith(o[u].travelWith),e[d].Year(o[u].Year),e[d].Month(o[u].Month),e[d].Day(o[u].Day),u+=1);for(var c=0,p=t.length+s.length;p<t.length+s.length+n.length;p++)c<i.length&&(e[p].firstName(i[c].firstName),e[p].lastName(i[c].lastName),e[p].title(i[c].title),e[p].travelWith(i[c].travelWith),e[p].AgeMonths(i[c].AgeMonths),e[p].Year(i[c].Year),e[p].Month(i[c].Month),e[p].Day(i[c].Day),c+=1);window.passengerDetailsViewModel.selectCountryStateFromCookie(a.passengers[0]),jQuery.fn.placeholder.input===!1&&$(".passengerDetails [placeholder]").not(".repeatemail").trigger("blur.placeholder")},a.performNewsletterActions=function(){void 0!==e.newsletter&&e.newsletter[0].checked?dataLayer.push({event:"Passenger",infotype:"Newsletter",infodetail:"Checked"}):dataLayer.push({event:"Passenger",infotype:"Newsletter",infodetail:"Unchecked"})},a.sendAnalyticsEvent=function(e){try{ga("send","event",{eventCategory:e,eventAction:"Passenger details"})}catch(a){}},a.showSummary=function(a){dataLayer.push({event:"Extras"}),e.form.hide(),e.edit.show(),e.summary.show()},a.showForm=function(){e.summary.hide(),e.form.show(),$("#btnContinuePassengerDetails").show(),e.edit.hide(),window.passengerDetailsViewModel.PassengerDetailsDone=!1,setTimeout(function(){$(".firstname").first().focus()},500)},a.show=function(){dataLayer.push({event:"Passenger"}),jQuery.fn.placeholder.input===!1&&$(".passengerDetails [placeholder]").prop({autocomplete:"off"});var e=$("#passengerInformation");e.is(":visible")||e.velocity("slideDown",function(){var a=ezy.isScreenSize(["xs","sm"])?-60:-15,t=$(".headWrapper .container").height();a-=t,e.velocity("scroll",{duration:750,offset:a}),$("#btnContinuePassengerDetails").show()})},a.clearPlaceholder=function(e,a){var t=this,s=$(t);if(t.value==s.attr("placeholder")&&s.hasClass("placeholder"))if(s.data("placeholder-password")){if(s=s.hide().next().show().attr("id",s.removeAttr("id").data("placeholder-id")),e===!0)return s[0].value=a;s.focus()}else t.value="",s.removeClass("placeholder"),t==document.activeElement&&t.select()},a.showError=function(e){$("#passengerDetailsError ul").html(""),$("#passengerDetailsError ul").append("<li>"+e+"</li>"),$("#passengerDetailsError").show(),$("#passengerDetailsError ul").show(),$("#passengerDetailsError")[0].scrollIntoView()},t},String.prototype.extractToJsonAndThenParseSubsetOfJsonAndThenStringifyItBack=function(){for(var e=JSON.parse(this),a=[],t=0;t<e.length;t++){var s={firstName:e[t].firstName,lastName:e[t].lastName,fullName:e[t].fullName,type:e[t].type,Age:e[t].Age,Year:e[t].Year,Month:e[t].Month,Day:e[t].Day,AgeMonths:e[t].AgeMonths,email:e[t].email,repeatemail:e[t].repeatemail,mobile:e[t].mobile,phone:e[t].phone,selectedCountry:e[t].selectedCountry,selectedState:e[t].selectedState,title:e[t].title,passengersNo:e[t].passengerNumber,travelWith:e[t].travelWith};a.push(s)}return JSON.stringify(a)},Array.prototype.CheckForDuplicates=function(e){for(var a=this,t=[],s=0;s<a.length;s++)e==a[s]&&t.push(s);return t.length>1};var PassengerDetailsModel=function(e,a,t,s,n,r,o,i,l,u){var d={},c={},p=0,m=0,g=0,h=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],b=[1,2,3,4,5,6,7,8,9,10,11,12];return d.translations=a||{},d.familyMembers=ko.observableArray([]),d.countries=ko.observableArray([]),c.init=function(){var e=d.initViewModel();return e},d.printBoardingPassChange=function(e){var a={excludedPassengerNumbers:window.passengerDetailsViewModel.printBoardingPassExcludedPassengerNumbers(),remove:"0"===e||"NO"===e,printBoardingPassOption:!0};window.ExtrasViewModel.requestExtraChange&&window.ExtrasViewModel.requestExtraChange(a)},d.initViewModel=function(){var a={};if(a.PassengerDetailsDone=!1,a.vivaFanLoggedIn=ko.observable(window.VivaFan.TopLogin&&window.VivaFan.TopLogin.isLoggedIn()),a.vivaFanUserInfo=null,a.showEditInfoLink=ko.observable(!0),a.onVivaFanLogin=function(e){var t=e&&null===a.vivaFanUserInfo,s=e&&null!==a.vivaFanUserInfo;if(t)window.ezy.defaultAjax("/VivaFan/GetUserInfo",null,function(e){e&&(a.vivaFanUserInfo=e,a.setPassengerInfoFromVivaFanUserInfo(a.vivaFanUserInfo))},function(){console.log("Failed to get viva fan user info")},"GET");else if(s)a.setPassengerInfoFromVivaFanUserInfo(a.vivaFanUserInfo);else{var n=a.passengers()[0];n.firstNameDisabled(!1),n.lastNameDisabled(!1)}},a.setPassengerDetailsAfterVivaFanUpdate=function(e,t){var s=a.passengers()[0];s.firstName(t.firstName),s.lastName(t.lastName),s.Day(t.dob.day),s.Month(t.dob.month),s.Year(t.dob.year)},$.subscribe("vivaFanDataConfirmation/passengerDetailsUpdated",a.setPassengerDetailsAfterVivaFanUpdate),a.vivaFanLoggedIn.subscribe(a.onVivaFanLogin),a.setPassengerInfoFromVivaFanUserInfo=function(e){var t=a.passengers()[0];t.firstName(e.FirstName),t.lastName(e.LastName),t.profileLastName(e.LastName),t.profileFirstName(e.FirstName),t.profileDob(e.DateOfBirth),(e.HasValidCustomerProgram===!0||window.VivaFan.Popup&&window.VivaFan.Popup.hasContinuedBookingWithUpgrade)&&t.customerNumber(e.CustomerNumber);var s=window.VivaFan.Popup&&(window.VivaFan.Popup.hasContinuedBookingWithoutAccount||window.VivaFan.Popup.hasContinuedBookingWithUpgrade),n=(e.HasValidCustomerProgram||s)&&(!t.firstName()||!t.lastName());t.hasIncompleteVivaFanProfile(n);var r=e.HasValidCustomerProgram===!0||window.VivaFan.Popup&&window.VivaFan.Popup.hasContinuedBookingWithUpgrade,o=r||e.HasValidFaceRecognitionProgram,i=t.firstName()&&o&&n===!1,l=t.lastName()&&o&&n===!1,u=e.HasValidFaceRecognitionProgram;t.firstNameDisabled(i),t.lastNameDisabled(l),t.dobDisabled(u),t.hasFaceRecognitionProgram(e.HasValidFaceRecognitionProgram),t.faceRecognitionOptIn(e.DefaultFaceRecognitionOptInValue),t.shouldDisableNameFieldsBecauseOfVivaFan(r),t.email(e.Email),t.repeatemail(e.Email);var d=void 0==e.MobilePhone||""==e.MobilePhone?e.HomePhone:e.MobilePhone;t.mobile(d),t.phone(e.HomePhone),t.selectedStateCode=e.State,void 0!==e.Nationality&&""!==e.Nationality.trim()&&t.selectedCountry(e.Nationality),d&&$("#mobile").intlTelInput("setNumber",d),e.HomePhone&&$("#phone").intlTelInput("setNumber",e.HomePhone);var c=$.grep(t.country(),function(e){return e.code===a.vivaFanUserInfo.Nationality})[0];c&&t.selectedCountry(c)},a.printBoardingPassExcludedPassengerNumbers=ko.observableArray([]),a.printBoardingPassPrice=ko.observable(""),a.printBoardingPassSelectedValue=ko.observable("0"),a.HideBoardingPassSection=ko.observable(!1),a.preventAutoAssignedSeatsForVivaLight=!1,a.isVivaLight=!1,a.printBoardingPassSelectedValue.subscribe(function(e){d.printBoardingPassChange(e)}),a.printBoardingPassExcludedPassengerNumbers.subscribe(function(){var e=a.printBoardingPassSelectedValue();"0"!==e&&"NO"!==e&&d.printBoardingPassChange(a.printBoardingPassSelectedValue())}),a.passengers=ko.observableArray([]),a.passengerNumbers=ko.computed(function(){var e=[];return $.each(a.passengers(),function(){this.passengerNumber()>=0&&this.type()!==ezy.PaxTypes.Infant&&e.push(this.passengerNumber())}),e}),a.message=ko.observable(""),null!=s&&$.each(s,function(){d.familyMembers.push(d.member(this))}),null!=t){var n=$.grep(t,function(e){return"MX"===e.Code})[0],r=$.grep(t,function(e){return"US"===e.Code})[0];d.countries.push(d.country(n)),d.countries.push(d.country(r)),$.each(t,function(){d.countries.push(d.country(this))})}return $.each(e,function(){var e=d.passenger(this);a.passengers.push(e)}),a.onVivaFanLogin(a.vivaFanLoggedIn()),a.save=function(){a.message(ko.toJSON(a))},a.selectMexico=function(){var e=$.grep(d.countries(),function(e){return"MX"===e.code});1===e.length&&this.passengers()[0].selectedCountry(e[0])},a.selectMexicoForIssuingCountry=function(){var e=$.grep(d.countries(),function(e){return"MX"===e.code});1===e.length&&ko.utils.arrayForEach(this.passengers(),function(a){a.selectedIssuingCountry(e[0])})},a.selectCountryStateFromCookie=function(e){var t=$.grep(d.countries(),function(a){return a.code===e.selectedCountry.code})[0];a.passengers()[0].selectedCountry(t),setTimeout(function(){var t=$.grep(a.passengers()[0].states(),function(a){return a.Code===e.selectedState.Code})[0];a.passengers()[0].selectedState(t)},1e3)},a.noSidePadding=ko.computed(function(){$(window).width();return $(window).width()>767&&$(window).width()<1200?!0:void 0}),a.forceUpdateSelectedHandicapObservable=function(){$.each(window.passengerDetailsViewModel.passengers(),function(){this.selectedHandicap.valueHasMutated()})},a.showAdultDateOfBirth=ko.observable(!!u),a.useSameAddressForAllPassengers=ko.observable(!1),a.useSameAddressForAllPassengers.subscribe(function(e){if(e===!0){var t=a.passengers()[0];$.each(window.passengerDetailsViewModel.passengers(),function(e){0!==e&&(this.addedPassportDetails("true"),this.addedDestinationDetails("true"),this.destinationAddress(t.destinationAddress()),this.destinationCity(t.destinationCity()),this.destinationZip(t.destinationZip()),this.selectedDestinationCountry(t.selectedDestinationCountry()),this.selectedDestinationState(t.selectedDestinationState()),this.selectedDestinationStateObject(t.selectedDestinationStateObject()))})}}),a},d.showError=function(e){$("#passengerDetailsError ul").html("");var a=$.unique(e);$.each(a,function(e,a){$("#passengerDetailsError ul").append("<li>"+a+"</li>")}),$("#passengerDetailsError").show(),$("#passengerDetailsError ul").show(),$("#passengerDetailsError")[0].scrollIntoView()},d.country=function(e){var a={};return a.name=e.Name,a.code=e.Code,a},d.member=function(e){var a={};return a.FullName=e.FirstName+" "+e.LastName,a.FirstName=e.FirstName,a.LastName=e.LastName,a.CustomerNumber=e.CustomerNumber,a.PersonId=e.PersonId,a},d.state=function(e,a){var t={};return t.name=a,t.code=e,t},d.removeSpecialChars=function(e){return e=e.replace("é","e"),e=e.replace("É","E"),e=e.replace("è","e"),e=e.replace("È","E"),e=e.replace("ê","e"),e=e.replace("Ê","E"),e=e.replace("ë","e"),e=e.replace("Ë","E"),e=e.replace("í","i"),e=e.replace("Í","I"),e=e.replace("ì","i"),e=e.replace("Ì","I"),e=e.replace("î","i"),e=e.replace("Î","I"),e=e.replace("ï","i"),e=e.replace("Ï","I"),e=e.replace("ö","o"),e=e.replace("Ö","O"),e=e.replace("ó","o"),e=e.replace("Ó","O"),e=e.replace("ò","o"),e=e.replace("Ò","O"),e=e.replace("ô","o"),e=e.replace("Ô","O"),e=e.replace("ø","o"),e=e.replace("Ø","O"),e=e.replace("œ","oe"),e=e.replace("Œ","OE"),e=e.replace("ü","u"),e=e.replace("Ü","U"),e=e.replace("ú","u"),e=e.replace("Ú","U"),e=e.replace("ù","u"),e=e.replace("Ù","U"),e=e.replace("û","u"),e=e.replace("Û","U"),e=e.replace("ñ","n"),e=e.replace("Ñ","N"),e=e.replace("ç","c"),e=e.replace("Ç","C"),e=e.replace("ß","ss"),e=e.replace("ð","d"),e=e.replace("Ð","D"),e=e.replace("ý","y"),e=e.replace("Ý","Y"),e=e.replace("þ","th"),e=e.replace("Þ","TH"),e=e.replace("ÿ","y"),e=e.replace("ª","a"),e=e.replace("æ","ae"),e=e.replace("Æ","AE"),e=e.replace("å","a"),e=e.replace("Å","A"),e=e.replace("ä","a"),e=e.replace("Ä","A"),e=e.replace("á","a"),e=e.replace("Á","A"),e=e.replace("à","a"),e=e.replace("À","A"),e=e.replace("â","a"),e=e.replace("Â","A"),e=e.replace("ã","a"),e=e.replace("Ã","A"),e.replace(/[^a-zA-Z ]/g,"")},d.passenger=function(e){var a={};a.firstName=ko.observable(e.FirstName),a.lastName=ko.observable(e.LastName),a.customerNumber=ko.observable(e.CustomerNumber),a.personId=ko.observable(e.PersonId),a.firstNameDisabled=ko.observable(!1),a.lastNameDisabled=ko.observable(!1),a.dobDisabled=ko.observable(!1),a.hasFaceRecognitionProgram=ko.observable(!1),a.hasIncompleteVivaFanProfile=ko.observable(!1),a.fullName=ko.computed(function(){return d.removeSpecialChars(a.firstName()+" "+a.lastName())},this),a.initials=function(){try{return d.removeSpecialChars(a.firstName()).substring(0,1).toUpperCase()+d.removeSpecialChars(a.lastName()).substring(0,1).toUpperCase();
}catch(e){return""}},a.type=ko.observable(e.Type),a.typeTranslation=ko.computed(function(){return a.type()===ezy.PaxTypes.Adult?d.translations.AdultType:a.type()===ezy.PaxTypes.Child?d.translations.ChildType:a.type()===ezy.PaxTypes.Infant?d.translations.InfantType:a.type()},this),a.typeBase=ko.computed(function(){return a.type()!==ezy.PaxTypes.Child&&a.type()!==ezy.PaxTypes.Infant&&a.type()!==ezy.PaxTypes.Comp?"Adults":a.type()===ezy.PaxTypes.Child?"Children":a.type()===ezy.PaxTypes.Infant?"Infants":void 0},this),a.typeValidation=ko.computed(function(){return a.type()!==ezy.PaxTypes.Child&&a.type()!==ezy.PaxTypes.Infant&&a.type()!==ezy.PaxTypes.Comp?d.translations.CompleteTextAdult:a.type()===ezy.PaxTypes.Child?d.translations.CompleteTextChild:"INF"===a.type()?d.translations.CompleteTextInfant:void 0},this),a.typeNumber=ko.computed(function(){return a.type()!==ezy.PaxTypes.Child&&a.type()!==ezy.PaxTypes.Infant&&a.type()!==ezy.PaxTypes.Comp?(p++,p):a.type()===ezy.PaxTypes.Child?(m++,m):a.type()===ezy.PaxTypes.Infant?(g++,g):1},this),a.email=ko.observable(e.Email),a.repeatemail=ko.observable(e.Email),a.mobile=ko.observable(e.Mobile),a.phone=ko.observable(e.Phone),a.handicap=ko.observable(e.Handicap),a.handicap.subscribe(function(){window.ExtrasViewModel.seating.HandleBlockedSeatsForPassengerAndFlight(a.passengerNumber())}),a.faceRecognitionOptIn=ko.observable(!1),a.shouldDisableNameFieldsBecauseOfVivaFan=ko.observable(!1),a.profileFirstName=ko.observable(e.FirstName),a.profileLastName=ko.observable(e.LastName);var t=e.Year+"-"+e.Month+"-"+e.Day;a.profileDob=ko.observable(t),a.faceRecognitionOptIn.subscribe(function(e){var t=a;if(e===!0?(t.firstNameDisabled(!0),t.lastNameDisabled(!0),t.dobDisabled(!0)):(t.dobDisabled(!1),t.shouldDisableNameFieldsBecauseOfVivaFan()===!1&&(t.firstNameDisabled(!1),t.lastNameDisabled(!1))),e===!0){t.firstName(t.profileFirstName()),t.lastName(t.profileLastName());var s=t.profileDob().split("-");t.Year(s[0]),t.Month(s[1]),t.Day(s[2])}}),a.emailOptIn=ko.observable(e.EmailOptIn),a.states=ko.observableArray([]),a.statesDestination=ko.observableArray([]),a.familyMembers=ko.observableArray(d.familyMembers()),a.country=ko.observableArray(d.countries()),a.title=ko.observable(e.Title),a.passengerNumber=ko.observable(e.PassengerNumber),a.travelWith=ko.observable(void 0==e.TravelWith&&e.Type==ezy.PaxTypes.Infant?a.typeNumber()-1:e.TravelWith-1),a.wrongDay=ko.observable(!1),a.wrongMonth=ko.observable(!1),a.wrongDate=ko.computed(function(){return a.wrongDay()||a.wrongMonth()},a),a.wrongDateErrors=ko.observableArray(),a.Day=ko.observable(e.Day),a.Month=ko.observable(e.Month),a.Year=ko.observable(e.Year),a.ShowDateOfBirth=ko.observable(!1),a.SetShowDateOfBirth=function(){var e=void 0!==a.Day()&&void 0!==a.Month()&&void 0!==a.Year();e===!0?a.ShowDateOfBirth(!0):a.ShowDateOfBirth(!1)},a.SetShowDateOfBirth(),a.Day.subscribe(function(){a.SetShowDateOfBirth()}),a.Month.subscribe(function(){a.SetShowDateOfBirth()}),a.Year.subscribe(function(){a.SetShowDateOfBirth()}),a.selectedHandicap=ko.observable(e.HandicapSsr),a.selectedHandicap.subscribe(function(e){window.ExtrasViewModel.seating&&window.ExtrasViewModel.seating.HandleBlockedSeatsForPassengerAndFlight(a.passengerNumber())}),a.dateOfBirthDayOptions=ko.computed(function(){a.wrongDay(!1);var e=parseInt(a.Day()),t=parseInt(a.Month()),s=parseInt(a.Year()),u=h,c=moment().set({year:s,month:t-1});if(0>=t||isNaN(t)||0>=s||isNaN(s))return u;if(u=u.slice(0,c.daysInMonth()),void 0===n)return u;var p=!1,m=!1,g=null,b=null;if(a.type()===ezy.PaxTypes.Infant?(g=moment(o),b=moment(n)):a.type()===ezy.PaxTypes.Child?(g=moment(i),b=moment(r)):(g=moment(l),b=moment("1900")),s<=b.year()&&t<=b.month()+1?(u=u.slice(b.date()-1),p=!0):s>=g.year()&&t>=g.month()+1&&(u=u.slice(0,g.date()),m=!0),e>0||!isNaN(e)){var f=ko.utils.arrayFirst(u,function(a){return e===a});f?a.wrongDay(!1):(p?a.Day(u[u.length-1]):p||m||a.Day(1),a.wrongDate()||a.type()!==ezy.PaxTypes.Child&&a.type()!==ezy.PaxTypes.Infant||(p?a.Month(2):a.Month(1),a.wrongDay(!0),a.wrongDateErrors.push(d.translations.AgeOutsideRange+a.typeTranslation()+" "+a.typeNumber()),d.showError(a.wrongDateErrors())))}return u},a),a.dateOfBirthMonthOptions=ko.computed(function(){a.wrongMonth(!1);var e=parseInt(a.Day()),t=parseInt(a.Month()),s=parseInt(a.Year()),u=b;if(0>=s||isNaN(s))return u;if(void 0===n)return u;var c=!1,p=!1,m=null,g=null;if(a.type()===ezy.PaxTypes.Infant?(m=moment(o),g=moment(n)):a.type()===ezy.PaxTypes.Child?(m=moment(i),g=moment(r)):(m=moment(l),g=moment("1900")),s<=g.year()?(u=u.slice(g.month()),p=!0,c=!0):s>=m.year()&&(u=u.slice(0,m.month()+1),c=!0),c&&(t>0||!isNaN(t))&&(e>0||!isNaN(e))){var h=ko.utils.arrayFirst(u,function(e){return t===e});h?a.wrongMonth(!1):a.wrongDate()||(p&&a.Month(2),a.wrongMonth(!0),a.wrongDateErrors.push(d.translations.AgeOutsideRange+a.typeTranslation()+" "+a.typeNumber()),d.showError(a.wrongDateErrors()))}return u},a),a.dateOfBirthYearOptions=ko.computed(function(){var e=[],t=moment(o),s=moment(n),u=moment(r),d=moment(i),c=moment(l);if(a.type()===ezy.PaxTypes.Infant)for(var p=s.year();p<=t.year();p++)e.push(p);else if(a.type()===ezy.PaxTypes.Child)for(var p=u.year();p<=d.year();p++)e.push(p);else for(var p=1900;p<=c.year();p++)e.push(p);return e=e.sort(function(e,a){return a>e?1:-1})},a),a.addedPassportDetails=ko.observable("false"),a.addedDestinationDetails=ko.observable("false"),a.mexicanResident=ko.observable("true"),a.getCountryDataRequest=function(e){e&&ezy.defaultAjax("/PassengerDetailsPart/GetCountryData",{country:e},function(e){a.states(e);var t=$.grep(e,function(e){return e.Code===a.selectedStateCode})[0];a.selectedState(t),a.selectedStateObject(t)})};var s=a.country()[0];return a.selectedCountry=ko.observable(s),a.getCountryDataRequest(s?s.code:null),a.selectedCountry.subscribe(function(e){a.getCountryDataRequest(e.code),$("#phone").intlTelInput("selectCountry",e.code),$("#mobile").intlTelInput("selectCountry",e.code)}),a.selectedStateCode="",a.selectedState=ko.observable(),a.selectedStateObject=ko.observable(void 0),a.selectedState.subscribe(function(e){var t=$.grep(a.states(),function(a){return a.Code===e})[0];a.selectedStateObject(t?t:void 0)}),a.selectedMember=ko.observable(void 0),a.selectedNationality=ko.observable(),a.selectedNationalityObject=ko.observable(void 0),a.selectedNationality.subscribe(function(e){var t=$.grep(a.country(),function(a){return a.code===e})[0];a.selectedNationalityObject(t?t:void 0),a.mexicanResident(void 0)}),a.documentType=ko.observable(),a.passportNumber=ko.observable(),a.knownTravelerNumber=ko.observable(),a.redressNumber=ko.observable(),a.expiryDay=ko.observable(),a.expiryMonth=ko.observable(),a.expiryYear=ko.observable(),a.selectedIssuingCountry=ko.observable(),a.selectedIssuingCountryObject=ko.observable(void 0),a.selectedIssuingCountry.subscribe(function(e){var t=$.grep(a.country(),function(a){return a.code===e})[0];a.selectedIssuingCountryObject(t?t:void 0)}),a.selectedBirthCountry=ko.observable(),a.selectedBirthCountryObject=ko.observable(void 0),a.selectedBirthCountry.subscribe(function(e){var t=$.grep(a.country(),function(a){return a.code===e})[0];a.selectedBirthCountryObject(t?t:void 0)}),a.destinationAddress=ko.observable(),a.destinationCity=ko.observable(),a.destinationZip=ko.observable(),a.selectedDestinationCountry=ko.observable(),a.selectedDestinationCountryObject=ko.observable(void 0),a.selectedDestinationCountry.subscribe(function(e){var t=$.grep(a.country(),function(a){return a.code===e})[0];a.selectedDestinationCountryObject(t?t:void 0),ezy.defaultAjax("/PassengerDetailsPart/GetCountryData",{country:t.code},function(e){a.statesDestination(e),void 0!==a.selectedDestinationStateObject()&&a.selectedDestinationState(a.selectedDestinationStateObject().Code)})}),a.selectedDestinationState=ko.observable(),a.selectedDestinationStateObject=ko.observable(void 0),a.selectedDestinationState.subscribe(function(e){var t=$.grep(a.statesDestination(),function(a){return a.Code===e})[0];a.selectedDestinationStateObject(t?t:void 0)}),a.selectedMember.subscribe(function(){var e=a.selectedMember();void 0!=e&&(a.firstName(e.FirstName),a.lastName(e.LastName),a.customerNumber(e.CustomerNumber),a.personId(e.PersonId),a.disableSelectedMembers())}),a.disableSelectedMembers=function(){setTimeout(function(){$(".familyMemberSelect option").prop("disabled",!1),$(".familyMemberSelect").each(function(){var e=$(this).val();e&&$('option[value="'+$(this).val()+'"]').each(function(){$(this).prop("disabled",!0)})})},500)},a},c};
ezy=window.ezy||{},moment=window.moment||{},ezy.views.flight.extras=function(){var e={},t={},a={};t.releaseAndReserveSeat=!1,a.locator=null;var r=null;return a.init=function(r){e=r,a.locator=e.locator,t.setSubscriptions(),void 0===window.passengerDetailsViewModel&&(window.passengerDetailsViewModel=new window.PassengerDetailsModel(e.passengers,e.translations).init()),t.setEvents(),t.setFancyboxEvents()},t.showPaymentSection=function(){t.sendBoxever(),$.publish("payment/show")},t.acceptThresholdFee=function(e,t){$.ajax({type:"POST",url:"/Pricing/AcceptThresholdFee",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({price:t.Price,hash:t.PriceHashed,productCode:t.ProductCode}),error:function(){$.publish("extras/showPaymentSection")},success:function(e){e.Success===!0?($.publish("bookingBasket/show",e.UpdatedStateJsonResult.Data.BookingBasketTemplateData),$.publish("extras/showPaymentSection"),$.publish("availability/updateFlightPrice",{combinedFlightReference:e.CombinedFlightReference,amount:t.Price})):$.publish("extras/showPaymentSection")}})},t.declineThresholdFee=function(e,t){$.ajax({type:"POST",url:"/Pricing/DeclineThresholdFee",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({price:t.Price,hash:t.PriceHashed,productCode:t.ProductCode}),error:function(){setTimeout(function(){location.reload()},2e3)},success:function(e){e.Success===!0&&void 0!==e.RedirectUrl?setTimeout(function(){window.location.href=e.RedirectUrl},2e3):setTimeout(function(){location.reload()},2e3)}})},t.setEvents=function(){$.browser.msie&&$("input:radio, input:checkbox").click(function(){this.blur(),this.focus()}),window.changeBusOption=function(e,a,r){var n=$(".busNoTransport"+a).is(":checked"),s=$('.busSelection[data-transport-id="'+a+'"]'),i=$("#busTravelFrom"+a).val();if("station"===e&&void 0!==r){var o=$("#busTravelFrom"+a+" option"),c="";i!==r?c=$("#busTravelFrom"+a+' option[value="'+r+'"]').prop("outerHTML"):$.each(o,function(e,t){$(t).val()!==r&&(c+=$(t).prop("outerHTML"))}),c=c.replace('selected="selected"',""),$("#busTravelTo"+a).html(c)}var d=$("#busTravelTo"+a).val();i!==d&&(n?s.hide():s.show(),t.transportationChange(a))},t.setParkingDefaultsDates(),t.setFancyboxEvents()},t.validateInsurance=function(){if(e.ValidateInsuranceExtra===!1)return!0;var t=!0,a=[];return $(".radOption.radInsuranceOption:visible").each(function(){var e=$(this),t=e.attr("name");-1===$.inArray(t,a)&&a.push(t)}),$.each(a,function(e,a){var r=$('input[name="'+a+'"]:checked',"#divExtrasInsurance");return 0===r.length?(t=!1,!1):!0}),t},t.setParkingDefaultsDates=function(){if(window.criteriaModel){var e=moment(window.criteriaModel.GetCriteria().BoardDate).format("DD/MM/YYYY");if($("#car-parking-arrival").val(e),$("#car-parking-date").val(e),""!==window.criteriaModel.GetCriteria().ReturnDate){var t=moment(window.criteriaModel.GetCriteria().ReturnDate).add(1,"days").format("DD/MM/YYYY");$("#car-parking-departure").val(t)}else $("#car-parking-departure").val(e)}},t.changeParking=function(){if($("input:radio[name='radCarParking']").is(":checked")){var e="0"!==$("input[name='radCarParking']:checked").val();t.selectExtraCarParking(e)}},window.changeParking=t.changeParking,t.setFancyboxEvents=function(){$("a.fancybox-extras").each(function(){$(this).fancybox({maxWidth:$(this).attr("data-fancybox-max-width"),minHeight:"auto",wrapCSS:$(this).attr("data-fancybox-wrap-css"),transitionIn:"elastic",transitionOut:"elastic",speedIn:600,speedOut:200,overlayShow:!1,padding:0,helpers:{overlay:{locked:!1}}})})},t.hideContinueButton=function(){e.bottomContainer.hide()},t.showContinueButton=function(){e.bottomContainer.show(),$("#extrasContinue").show()},t.showPreselectedMessage=function(){$("#extras-preselected-message").length>0&&$("#extras-preselected-message").show()},t.hidePreselectedMessage=function(){$("#extras-preselected-message").length>0&&$("#extras-preselected-message").hide()},t.compareCarDates=function(e,t){try{var a=new Date(e),r=new Date(t),n=a-r;if(n>0)return!0}catch(s){alert("Date parsing error in car parking: "+s.message)}return!1},t.selectExtraCarParking=function(e){var a=e?$("#car-parking-amount :selected").text():0,r=$("#car-parking-arrival").datepicker({dateFormat:"yyyy-mm-dd"}).val(),n=$("#car-parking-departure").datepicker({dateFormat:"yyyy-mm-dd"}).val(),s=t.compareCarDates(r,n);s&&($("#car-parking-arrival").val(n),r=n),e?$("#airport-parking-additional-options").show():$("#airport-parking-additional-options").hide(),$.ajax({url:"/Pricing/AddParking",type:"POST",dataType:"json",data:{Cars:a,CarArrival:r,CarLeaving:n},success:function(e){e.UpdatedStateJsonResult.Data.Success?(t.passengerSSRSuccess(null,e.UpdatedStateJsonResult.Data),$("#divExtrasCarParking").find(".price-holder").html(e.ParkingAmount)):$.each(e.UpdatedStateJsonResult.Data.Errors,function(){console.log(this.toString())})},error:function(e){t.passengerSSRError(e),window.dataLayer.push({event:"Error",errtype:"Extra",errdetail:"Parking"})}})},t.basketRefreshed=function(e,t){$.publish("payment/updatePaymentHeaderAmount")},t.clearSummaryHeaders=function(){$(".extrasHead .amount").empty(),$(".extrasHead .totalamount").empty()},t.show=function(){var e=$("#extras").is(":hidden");e&&($("#extras").velocity("slideDown",function(){var e=$(window).width()<768?-60:-15,t=$(".headWrapper .container").height();e-=t,$("#extras").velocity("scroll",{duration:750,offset:e}),setTimeout(function(){$("#extras .readMore").first().focus()},500)}),t.showPreselectedMessage(),t.showContinueButton(),window.ExtrasViewModel.setPreselected())},t.hide=function(){var e=$("#extras").is(":visible");e&&($("#extras").hide(),t.hidePreselectedMessage(),t.hideContinueButton())},t.setSubscriptions=function(){$.subscribe("extras/slideDown",t.extraContainerSlideDown),$.subscribe("extras/slideUp",t.extraContainerSlideUp),$.subscribe("extras/setVivaProductFromAvail",t.setVivaProductFromAvail),$.subscribe("extras/show",t.show),$.subscribe("extras/hide",t.hide),$.subscribe("bookingBasket/update",t.basketRefreshed),$.subscribe("extras/setCarParkingMinDate",t.setCarParkingMinDate),$.subscribe("extras/setParkingDates",t.setParkingDates),$.subscribe("extras/showContinueButton",t.showContinueButton),$.subscribe("extras/hideContinueButton",t.hideContinueButton),$.subscribe("extras/showPreselectedMessage",t.showPreselectedMessage),$.subscribe("extras/hidePreselectedMessage",t.hidePreselectedMessage),$.subscribe("extras/hideExtrasLoading",t.hideExtrasLoading),$.subscribe("extras/showExtrasLoading",t.showExtrasLoading),$.subscribe("extras/setFancyboxEvents",t.setFancyboxEvents),$.subscribe("extras/showPaymentSection",t.showPaymentSection),$.subscribe("extras/acceptThresholdFee",t.acceptThresholdFee),$.subscribe("extras/declineThresholdFee",t.declineThresholdFee),$.subscribe("extras/sendBoxever",t.sendBoxever)},t.showExtrasLoading=function(){$("#extras-loading").show()},t.hideExtrasLoading=function(){$("#extras-loading").hide()},t.getProductOptionValue=function(e,t,a){var r=a;return null===e||void 0===e?r:($.each(e,function(){return this.Name===t?(r=this.Value,!1):!0}),r)},t.getSequencesValue=function(e,t,a){var r=a;return null===e||void 0===e?r:($.each(e,function(){return this.SequenceType===t?(r=this.SequenceValue,!1):!0}),r)},t.setParkingDates=function(e){var a=$("#car-parking-date").val();if(a){var r=new Date(Date.parse(a));$("#car-parking-arrival").datepicker({dateFormat:"dd/mm/yy",defaultDate:"+0d",numberOfMonths:2,selectOtherMonths:!1,showOtherMonths:!1,minDate:new Date(r.getFullYear(),r.getMonth(),r.getDate()),firstDay:1,maxDate:"+12M"}),$("#car-parking-departure").datepicker({dateFormat:"dd/mm/yy",defaultDate:"+1d",numberOfMonths:2,selectOtherMonths:!1,showOtherMonths:!1,minDate:new Date(r.getFullYear(),r.getMonth(),r.getDate()),firstDay:1,maxDate:"+12M"}),$("#car-parking-arrival").datepicker("option","onSelect",t.changeParking),$("#car-parking-departure").datepicker("option","onSelect",t.changeParking)}},t.passengerSSRError=function(t){ezy.GoogleAnalyticsSendPageView("GeneralExtraError"),"0"==t.status?$("#flightBookingError").append(e.translations.errorMessages.connectionInterrupted+"<br />"):$("#flightBookingError").append(e.translations.errorMessages.pricing+": ErrorCode:"+t.status+"<br /><br />"),$("#flightBookingError")[0].scrollIntoView(),$("#flightBookingError").velocity("slideDown")},t.passengerSSRSuccess=function(e,t){$.publish("bookingBasket/show",t.BookingBasketTemplateData),$.publish("payment/updateextrasinsummary",t),window.ExtrasViewModel.setExtrasAmounts(t)},t.showChoosenExtraDescription=function(e){e?$(".extrasHead[data-extra-type='"+e+"'] .titleText").hide():$(".extrasHead .titleText").hide(),$(".extras .extrasHead h3").addClass("summary")},t.hideChoosenExtraDescription=function(e){e?$(".extrasHead[data-extra-type='"+e+"'] .titleText").show():$(".extrasHead .titleText").show(),$(".extras .extrasHead h3").removeClass("summary")},t.unselectExtraCarParking=function(){var t=e.controls.carparking.carArrival.attr("data-default-date"),a=e.controls.carparking.carDeparture.attr("data-default-date");e.controls.carparking.priceHolder.html(""),e.controls.carparking.numberOfCarsSelectBox.val("1"),e.controls.carparking.carArrival.val(t),e.controls.carparking.carDeparture.val(a),$.ajax({url:"/ExtrasCarParking/RemoveParking",type:"POST",data:{},success:function(e){$.publish("bookingBasket/show",e.BookingBasketTemplateData),$.publish("payment/updateextrasinsummary",e)},error:function(){window.dataLayer.push({event:"Error",errtype:"Extra",errdetail:"Parking"})}})},t.transportationChange=function(e){var a=$("#busAdults"+e).val(),r=void 0!==$("#busChildren"+e)[0]?$("#busChildren"+e).val():"0",n=$("#busRoundTrip"+e).is(":checked"),s=$("#busFareType"+e).length?$("#busFareType"+e).val():"",i=!$("#busNoTransport"+e).is(":checked");i?$(".busSelection[data-transport-id='"+e+"']").show():$(".busSelection[data-transport-id='"+e+"']").hide();var o={Add:i,Adults:parseInt(a),Children:parseInt(r),From:$("#busTravelFrom"+e).val(),To:$("#busTravelTo"+e).val(),SupplierId:e,IsRoundTrip:n,FareType:s};ezy.defaultAjax("/Pricing/TransportationChangeAsync",o).error(function(e){console.log("Error in /Pricing/TransportationChange"),console.log(o),t.passengerSSRError(e),window.dataLayer.push({event:"Error",errtype:"Extra",errdetail:"Transportation"})}).success(function(a){a.UpdatedStateJsonResult.Data.Success?(t.passengerSSRSuccess(null,a.UpdatedStateJsonResult.Data),$("#price-holder"+e).html(a.TotalTransportationAmount)):$.each(a.UpdatedStateJsonResult.Data.Errors,function(){console.log(this.toString())})})},t.setVivaProductFromAvail=function(e,t){r=t,window.ExtrasViewModel.currentVivaProduct(r)},t.extraContainerSlideDown=function(){$("#additional-extras-loading").hide(),$(".extras-details").velocity("slideDown",{complete:function(){var e=$(window).width()<768?-60:-15;ezy.scrollToElement(".extras-details",750,e)}})},t.extraContainerSlideUp=function(){$(".extras-details").velocity("slideUp")},t.getBoxeverExtraCode=function(e){var t=$.grep(e.ServiceCharges,function(e){return e.TicketCode.length>2})[0];switch(t.TicketCode){case"VIP":case"EXP":case"SEA":return"SEAT";case"BAG":return"BAG";case"SEG":return"INSURANCE";case"MEL":return"MEAL";case"MOD":return"FEE";default:return"OTHER"}},t.sendBoxever=function(){$.ajax({type:"POST",url:"/Pricing/GetBookingBasketData",contentType:"application/json; charset=utf-8",dataType:"json",error:t.passengerSSRError,success:function(e){for(var a=[],r=0;r<e.SSRFees.length;r++){var n=e.SSRFees[r],s=$.grep(e.PassengerFees,function(e){return e.FeeCode===n.Code})[0];a.push({type:s?t.getBoxeverExtraCode(s):"OTHER",itemId:s?s.SSRCode:n.Code,productId:n.Code,name:n.Description,price:n.Amount,quantity:n.Count})}var i={box:"Benefits",sca:{product:a}};window.dataLayer.push(i),window.dataLayer.push({ecommerce:{checkout:{actionField:{step:2,option:"ezy"},products:window.dataLayerSelectedProducts}},event:"checkoutExtras"})}})},a};var Product={SMART:"VivaSmart",OTA:"VivaOTA",LIGHT:"VivaLight",BASIC:"VivaBasic"},Direction={OUT:"out",IN:"in"},SeatType={FREE:"Free",PREFERRED:"Preferred",SELECTED:"Selected",BLOCKED:"Blocked",RESERVED:"Reserved",AISLE:"Aisle",REGULAR:"Regular",INCLUDED:"Included",VIP:"Vip",SPACE:"Space"};
FusionWidget=window.FusionWidget,ExtrasViewModel=window.ExtrasViewModel,ga=window.ga,ezy=window.ezy,_currencyHelper=window._currencyHelper,accounting=window.accounting,ezy.views.flight.seating=function(){var e={},t={},a={},s={},n=null,i=-1;return t.getSeatingStartTime=null,e.init=function(e,i){t.setSubscriptions(),a=i,s=e,n=s.controls},t.setSubscriptions=function(){$.subscribe("extras/setSeating",t.setSeating),$.subscribe("extras/setAutoAssignedSeats",t.setAutoAssignedSeats),$.subscribe("extras/vipSsrChange",t.vipSsrChange),$.subscribe("extras/hideSeating",t.hideAndDisableSeatExtra),$.subscribe("extras/getSeatingDone",t.getSeatingDone),$.subscribe("extras/clearSeating",t.clearSeating),$.subscribe("extras/seatingChangeSsr",t.SeatingChangeSsr),$.subscribe("extras/selectSeat",t.selectSeat),$.subscribe("extras/selectNextSeat",t.selectNextSeat),$.subscribe("changebooking/pricingsuccess",t.changeBookingPricingSuccess),$.subscribe("extras/getSeating",t.getSeating),$.subscribe("extras/removeSeatFromPassenger",t.removeSeatFromPassenger),$.subscribe("extras/setSeatPricesToEachSeat",t.setSeatPricesToEachSeat),$.subscribe("extras/releaseAutoAssignSeat",t.releaseAutoAssignSeat),$.subscribe("extras/acceptAutoAssignSeat",t.acceptAutoAssignSeat),$.subscribe("extras/hideProposedSeatPanel",t.hideProposedSeatPanel)},t.setSeatPricesToEachSeat=function(){$.each(a.seatingFlights(),function(e,a){var s=window.RouteInfo.LegDictionary[a.FlightKey],n=-1!==$.inArray(a.FlightKey,window.RouteInfo.OutboundFlightKeys)&&window.RouteInfo.OutboundFlightKeys.length>1||-1!==$.inArray(a.FlightKey,window.RouteInfo.InboundFlightKeys)&&window.RouteInfo.InboundFlightKeys.length>1,i=window.RouteInfo.OutboundFlightKeys[1]===a.FlightKey||window.RouteInfo.InboundFlightKeys[1]===a.FlightKey,r=a.SeatRows();$.each(r,function(e,a){$.each(a.Seats,function(e,a){var r=t.matchingPricingOption(s,a.SeatType(),a.Window||a.IsAisleSeat,a.NoSeatsInFront,a.LastRow,a.SeatGroup);if(null!=r){var o=r.Price;i&&(o=0),a.Color=r.Color,a.Hash=r.PriceHash,a.OriginalPrice=o,a.PriceInDecimal=o*(n?2:1),a.PriceOptions=r.PricingOptions,a.IsFusion=!!r.IsFusion,a.FusionSeatGroup=t.getFusionSeatGroup(a.SeatType(),a.SeatGroup)}})}),a.SeatRows([]),a.SeatRows(r)})},t.matchingPricingOption=function(e,s,n,i,r,o){var l=null;return $.each(a.seatPrices(),function(a,c){var u=0;$.each(c.PricingOptions,function(e,a){"True"===a.Value&&(a.Value=!0),"False"===a.Value&&(a.Value=!1);var l=window.ezy.constants.fusion.extras.seat,c=a.Name===l.pricingOption.seatGroup;(c&&a.Value===t.getFusionSeatGroup(s,o)||c&&a.Value===s||a.Name===l.pricingOption.aisleWindow&&a.Value===n||a.Name===l.pricingOption.noSeatInFront&&a.Value===i||a.Name===l.pricingOption.lastRow&&a.Value===r)&&u++});var S=!1;void 0!==c.Sequences&&null!==c.Sequences?$.each(c.Sequences,function(t,a){"Leg"===a.Name&&a.Value===e&&(S=!0)}):S=!0,u===c.PricingOptions.length&&S&&(l=this)}),l},t.getFusionSeatGroup=function(e,t){var a=window.ezy.constants.fusion.extras.seat;return e===SeatType.VIP?a.types.Priority:e===SeatType.SPACE?a.types.MoreSpace:e===SeatType.INCLUDED&&2===t?a.types.Upfront:e===SeatType.INCLUDED&&4===t?a.types.Basic:""},t.setSeatmapHeight=function(){var e=400,t=63,a=210,i=20,r=t*s.nrOfSeats,o=r+a+i;o>e&&n.seatmaps.css({height:o+"px"})},t.setAutoAssignedSeats=function(e,n,i){self.preventAutoAssignedSeatsForVivaLight!==!1&&i!==!1||(i&&(a.preSelectedSeatsOutbound([]),a.preSelectedSeatsInbound([])),$.each(n,function(e,s){$.each(a.seatingFlights(),function(e,t){t.FlightKey===s.FlightKey&&$.each(t.SeatRows(),function(e,n){n.RowNumber===s.RowNumber&&$.each(n.Seats,function(e,n){if(n.SeatNumber===s.SeatNumber&&(s.Price=n.Price,s.PriceInDecimal=s.IsFree?0:n.PriceInDecimal,s.OriginalPrice=n.OriginalPrice,s.PriceOptions=n.PriceOptions,s.Hash=n.Hash,s.IsFusion=n.IsFusion,s.FusionSeatGroup=n.FusionSeatGroup,s.SeatType=ko.observable(n.SeatType()),i)){var r={PassengerNumber:s.PassengerNumber,SeatNumber:s.SeatNumber};t.IsDeparture()?a.preSelectedSeatsOutbound.push(r):a.preSelectedSeatsInbound.push(r)}})})}),t.updateSeats(new ezy.Seat(s),s.PassengerNumber,i===!1)}),i&&(a.selectedPassenger.valueHasMutated(),a.selectedPassenger(0),window.dataLayer.push({event:"Seating",infotype:"PreSelectSeats",infodetail:s.changeBookingViewType}))),a.currentFlightSelectedIndex(0),a.hasManuallyAssignedSeats(i===!1)},t.getSeating=function(e,s,n){t.getSeatingStartTime=(new Date).getTime(),a.getSeatingLoading(!0),t.blockSeatMap(),ezy.defaultAjax("/Seating/GetSeatingForAllFlightsAsync").error(function(){$(".extras.seat").hide().addClass("disabled")}).success(function(e){$.publish("extras/setSeating",[e]),a.AutoAssignedSeats=e.selectedSeats}).done(function(){$.publish("extras/getSeatingDone",[n,s]),self.preventAutoAssignedSeatsForVivaLight===!1&&window.ExtrasViewModel.seating.HandleBlockedSeatsForPassengerAndFlight()})},t.changeBookingPricingSuccess=function(e,a,s,n,i){$.publish("extras/slideDown"),t.doChangeBookingSeating(a,s,i)},t.hideProposedSeatPanel=function(){$(".seats-popover-location").popover("hide"),$(".seats-popover-location-mobile").popover("hide")},t.selectSeat=function(e,s,n,i,r){if(t.hideProposedSeatPanel(),!r&&s.ExitRow)return t.showSeatConfirmDialog(s,n,i),!0;var o=t.getOldSeat(n,s.FlightKey);if(i){if(i===!0&&a.enableDeselectSeatVB===!0){var l=s.getSelectedPassengerNumber();t.unassignSeats(s,l);var c=$.grep(a.selectedSeats(),function(e){return e.isManuallyAssigned()===!0})[0];void 0===c&&a.hasManuallyAssignedSeats(!1),""!==o&&(t.releaseAndReserveSeat=!1,t.releaseSeat(s,o,l))}}else t.updateSeats(s,n,!0),a.hasManuallyAssignedSeats(!0),t.selectNextSeat(),""!==o?(t.releaseAndReserveSeat=!0,t.releaseSeat(s,o,n)):(t.releaseAndReserveSeat=!1,t.reserveSeat(s,o,n));return!1},t.removeSeatFromPassenger=function(e,a,s){var n=t.getOldSeat(s,a);t.removeSeatFromSelectedSeats(a,s),t.releaseAndReserveSeat=!1,t.releaseSeat({},n,s)},window.dataLayer.push({event:"Seating",infotype:"RemoveSeatFromPassenger",infodetail:s.changeBookingViewType}),t.removeSeatFromSelectedSeats=function(e,t){a.selectedSeats.remove(function(a){return a.PassengerNumber===t&&a.FlightKey===e})},t.updateSeats=function(e,s,n){t.removeSeatFromSelectedSeats(e.FlightKey,s),a.selectedSeats.push(new ezy.SelectedSeat(e,s,n))},t.unassignSeats=function(e,a){t.removeSeatFromSelectedSeats(e.FlightKey,a)},t.getOldSeat=function(e,t){var s=ko.utils.arrayFirst(a.selectedSeats(),function(a){return e===a.PassengerNumber&&a.FlightKey===t});return s?s.SeatNumber:""},t.reserveSeat=function(e,n,i){t.blockSeatMap();var r={seatSelection:{SeatNumber:e.SeatNumber,PassengerNumber:i,FlightKey:e.FlightKey}};ezy.defaultAjax("/Seating/ReserveSeatAsync",r).success(function(n){if(n.d&&(n=n.d),n.Response.Success){window.dataLayer.push({event:"Seating",infotype:"ReserveSeat",infodetail:s.changeBookingViewType,infodesc:e.SeatType}),$.publish("extras/seatingChangeSsr");var r=$.grep(a.selectedSeats(),function(t){return t.SeatNumber===e.SeatNumber&&t.FlightKey===e.FlightKey&&t.PassengerNumber===i})[0];void 0!==r&&null!==r&&(e.PriceInDecimal=r.PriceInDecimal)}else window.dataLayer.push({event:"Error",errtype:"Seating",errdetail:"Alert reserve seat"}),alert(n.Response.Error);t.unblockSeatMap(),t.releaseAndReserveSeat=!1}).error(function(){t.unblockSeatMap(),t.releaseAndReserveSeat=!1})},t.selectNextSeat=function(){var e=t.getNextPassenger();return e===i?a.selectedPassenger(0):(a.selectedPassenger(e),0===e&&a.nextFlight()),e===i&&t.selectPassengerWithoutSeat(a.selectedFlightKey()),!0},t.selectPassengerWithoutSeat=function(){var e=t.getNextPassengerWithNoSeat(a.selectedSeats(),a.selectedFlightKey());e!==i&&(a.selectedPassenger(e),a.currentFlightSelectedIndex(0))},t.getNextPassenger=function(){var e=0,t=s.nrOfSeats-1;if(a.selectedPassenger()===t)return e;var n=a.selectedPassenger()+1,r=ExtrasViewModel.getExtraByType("ExtrasPetTravel"),o=!1;return r&&(o=r.HasSelectedPetOnboard(n)),o?i:n},t.getNextPassengerWithNoSeat=function(e,t){for(var a=i,n=0;n!==s.nrOfSeats;n++){var r=!1;if($.each(e,function(e,a){return a.PassengerNumber===n&&a.FlightKey===t?(r=!0,!1):!0}),!r){a=n;break}}return a},t.releaseAutoAssignSeat=function(e,a){t.blockSeatMap(),ezy.defaultAjax("/Seating/RejectProposedSeats",a).success(function(e){e.Response.Success?($.publish("extras/seatingChangeSsr"),t.clearSeating(),t.unblockSeatMap()):(ga("send","event",{eventCategory:"seating",eventAction:"AlertReleaseSeatError",eventLabel:s.changeBookingViewType}),alert(e.Response.Error),t.unblockSeatMap(),t.releaseAndReserveSeat=!1)}).error(function(){$.publish("extras/seatingChangeSsr"),t.unblockSeatMap()})},t.acceptAutoAssignSeat=function(e){t.blockSeatMap(),ezy.defaultAjax("/Seating/AcceptProposedSeats").success(function(e){e.Response.Success?ezy.defaultAjax("/Pricing/RefreshBasket").success(function(e){$.publish("bookingBasket/show",e.BookingBasketTemplateData),t.unblockSeatMap()}):(ga("send","event",{eventCategory:"seating",eventAction:"AlertAcceptSeatError",eventLabel:s.changeBookingViewType}),alert(e.Response.Error),t.unblockSeatMap(),t.releaseAndReserveSeat=!1)}).error(function(){$.publish("extras/seatingChangeSsr"),t.unblockSeatMap()})},t.releaseSeat=function(e,a,n){t.blockSeatMap();var i={seatSelection:{SeatNumber:a,PassengerNumber:n,FlightKey:e.FlightKey}};ezy.defaultAjax("/Seating/ReleaseSeatAsync",i).success(function(i){i.Response.Success?t.releaseAndReserveSeat?t.reserveSeat(e,a,n):($.publish("extras/seatingChangeSsr"),t.unblockSeatMap()):(ga("send","event",{eventCategory:"seating",eventAction:"AlertReleaseSeatError",eventLabel:s.changeBookingViewType}),alert(i.Response.Error),t.unblockSeatMap(),t.releaseAndReserveSeat=!1)}).error(function(){$.publish("extras/seatingChangeSsr"),t.unblockSeatMap()})},t.doChangeBookingSeating=function(e,a,s){t.blockSeatMap(),e=ko.utils.arrayMap(e,function(e){return null===e||void 0===e?null:{from:e.DepartureAirport,to:e.ArrivalAirport,date:e.DepartureDateText,flightnumber:e.FlightNumber,classcode:e.ClassCode,segmentKey:e.SegmentKey,type:e.AvailType}}),ezy.defaultAjax("/Seating/GetSeatingForAllFlightsAsync").error(function(){$.publish("extras/hideSeating")}).success(function(e){$.publish("extras/setSeating",[e])}).done(function(){$.publish("extras/getSeatingDone",[s,e]),window.ExtrasViewModel.edit(!0),$("#change-flight-details .change-controls input[type=submit]").on("click",function(){$.publish("extras/slideUp"),$.publish("payment/hideAndCloseAllPaymentOption")}),$("#additional-extras-loading").hide()})},t.showAndEnableSeatExtra=function(){var e=window.ExtrasViewModel.getExtraByType("ExtrasSeat");e.Open(!0),window.dataLayer.push({event:"Seating",infotype:"Display",infodetail:s.changeBookingViewType})},t.blockSeatMap=function(){window.seatingViewModel.showLoading(!0)},t.unblockSeatMap=function(){window.seatingViewModel.showLoading(!1)},t.updateSeatPrices=function(e,t,s){a.totalSeatAndVipPrice(t),a.totalSeatPrice(e),a.totalSeatPriceValue(s)},t.hideAndDisableSeatExtra=function(){var e=$("#extrasForm .extras.seat");e.hide().addClass("disabled")},t.getNumberOfSeats=function(e){var t=0;return $.each(e,function(){$.each(this.Seats,function(){t++})}),t},t.getNumberOfAvailableSeats=function(e){var t=0;return $.each(e,function(){$.each(this.Seats,function(){this.CanBeSelected()&&t++})}),t},t.getSeatingDone=function(e,n){window.EnableFlightSelectionOnFusionResponse!==!0&&$.publish("availability/enableFlightSelection");var i=!0,r=0===a.seatingFlights().length;if(r&&(i=!1,"Date"===s.changeBookingViewType&&($.publish("extras/slideUp"),n&&"0.00"!==n?$.publish("payment/show"):$.publish("changebooking/showPerformChangeContainer"))),$.publish("extras/setAutoAssignedSeats",[window.seatingViewModel.AutoAssignedSeats,!0]),self.preventAutoAssignedSeatsForVivaLight===!1)for(var o=0;o!==s.nrOfSeats;o++)a.updateAssignedAtAirportForPassenger(o);window.passengerDetailsViewModel.PassengerDetailsDone&&window.ezy.FareLockActive&&$.publish("payment/show"),i?(t.showAndEnableSeatExtra(),t.setSelectedSeatNumbers(),a.currentFlightSelectedIndex(0),a.getSeatingLoading(!1),t.unblockSeatMap(),t.setSeatmapHeight()):(t.hideAndDisableSeatExtra(),"Seat"===s.changeBookingViewType&&$(".extras-details.booking-part").hide())},t.setSelectedSeatNumbers=function(){$.each(s.selectedSeats,function(e,s){$.each(a.seatingFlights(),function(e,t){t.FlightKey===s.FlightKey&&$.each(t.SeatRows(),function(e,t){t.RowNumber===s.RowNumber&&$.each(t.Seats,function(e,t){t.SeatNumber===s.SeatNumber&&(s.OriginalPrice=t.Originalprice,s.Price=t.Price,s.PriceInDecimal=t.PriceInDecimal,s.PriceOptions=t.PriceOptions,s.Hash=t.Hash,s.IsFusion=t.IsFusion,ko.isObservable(s.SeatType)===!0?s.SeatType(t.SeatType()):s.SeatType=ko.observable(t.SeatType()))})})}),t.updateSeats(new ezy.Seat(s),s.PassengerNumber,!1)})},t.SeatingChangeSsr=function(){var e=[];ko.utils.arrayForEach(a.selectedSeats(),function(a){e.push(t.seatToSendToServer(a))});var s={selectedSeats:e};ezy.defaultAjax("/Pricing/SeatingChangeAsync",s).success(function(e){$.publish("bookingBasket/show",e.UpdatedState.Data.BookingBasketTemplateData),$.publish("payment/updateextrasinsummary",e.UpdatedState.Data),t.updateSeatPrices(e.TotalSeatPriceString,e.TotalSeatAndVipPriceString,e.TotalSeatPrice),window.ExtrasViewModel.setExtrasAmounts(e.UpdatedState.Data),window.ExtrasViewModel.handleIncludedSsrsForSeat(e.UpdatedState.Data),t.unblockSeatMap()})},t.seatToSendToServer=function(e){var t=void 0!==window.RouteInfo.LegDictionary?window.RouteInfo.LegDictionary[e.FlightKey]:0,a=e.FusionSeatGroup;return void 0!==e.PriceOptions&&null!==e.PriceOptions&&e.PriceOptions.length&&(a=e.PriceOptions[0].Value),{Date:new Date,FlightKey:e.FlightKey,FlightNumber:e.FlightNumber,SeatNumber:e.SeatNumber,PassengerNumber:e.PassengerNumber,OriginalPrice:e.OriginalPrice,Price:e.PriceInDecimal,Hash:e.Hash,SeatType:e.SeatType,IsFusion:e.IsFusion,FusionSeatGroup:e.FusionSeatGroup,FirstFusionPriceOptionValue:a,SegmentNumber:e.SegmentNumber,LegNumber:void 0===t?0:t}},t.clearSeating=function(){a.seatSelectedDetailsText(s.translations.pleaseSelectSeat),a.isRandomSeatAssignmentConsentChecked(!1),a.hasManuallyAssignedSeats(!1),$(".passengerSeat").find(".selectedSeatNumber").text(""),$(".passengerSeat").attr("data-price",""),a.selectedSeats.removeAll()},t.showSeatConfirmDialog=function(e,a,n){var i={modal:!0,buttons:[{clsName:"button accept",title:"<span>"+s.translations.confirmSeatPopup.ConfirmDialogText+"<i></i></span>",value:!0,altTitle:s.translations.confirmSeatPopup.ConfirmDialogText},{clsName:"button cancel",title:"<span>"+s.translations.confirmSeatPopup.CancelDialogText+"<i></i></span>",value:!1,altTitle:s.translations.confirmSeatPopup.CancelDialogText}],maxWidth:500};ezy.fancyConfirm(s.translations.confirmSeatPopup.ConfirmExitRowDialogContent,s.translations.confirmSeatPopup.ConfirmExitRowDialogQuestion,i,function(s){s&&t.selectSeat(null,e,a,n,!0),$.fancybox.close()})},t.setSeating=function(e,s){if(s.Success){var n=s.Flights;self.preventAutoAssignedSeatsForVivaLight=s.preventAutoAssignedSeatsForVivaLight,$.each(n,function(e,t){var s=[];$.each(t.SeatRows,function(e,t){s.push(new ezy.SeatRow(t))}),t.SeatRows=ko.observableArray(s),t.DashedFlightKey=ezy.replaceSpacesWithDashes(t.FlightKey),t.Open=window.ko.observable(!1),t.Expand=function(){t.Open(!t.Open())},t.IsDeparture=function(){var e=-1!==$.inArray(t.FlightKey,window.RouteInfo.OutboundFlightKeys);return e},t.GetFlightKeys=function(){var e=t.IsDeparture()?window.RouteInfo.OutboundFlightKeys:window.RouteInfo.InboundFlightKeys;return e},t.GetLegNumber=function(){var e=t.GetFlightKeys();return e.indexOf(t.FlightKey)+1},t.GetNumbersOfLegs=function(){var e=t.GetFlightKeys();return e.length},t.ShowOutFlightLabel=function(){return window.RouteInfo.DepartureAirportCode===t.DepartureStation},t.ShowInFlightLabel=function(){return window.RouteInfo.DestinationAirportCode===t.DepartureStation},t.IsSelected=function(){return a.selectedFlightKey()===t.FlightKey},t.GetNumberOfFlight=function(){var e=$.map(a.seatingFlights(),function(e){return e.FlightKey});return e.indexOf(t.FlightKey)+1},t.AnySeatsAvailable=function(){var e=!1;return $.each(t.SeatRows(),function(s,n){return $.each(n.Seats,function(s,n){var i=void 0!==$.grep(a.getSelectedSeatsForFlightKey(t.FlightKey),function(e){return e.SeatNumber===n.SeatNumber})[0];return n.CanBeSelected()&&i===!1?(e=!0,!1):!0}),!0}),e},t.GetNumberOfAvailableSeats=function(){var e=0;return $.each(t.SeatRows(),function(s,n){return $.each(n.Seats,function(s,n){var i=void 0!==$.grep(a.getSelectedSeatsForFlightKey(t.FlightKey),function(e){return e.SeatNumber===n.SeatNumber})[0];return n.CanBeSelected()&&i===!1&&e++,!0}),!0}),e}}),a.seatingFlights(n),a.selectedSeats([]),a.vipSeatUpgradeText(s.vipSeatUpgradeText),a.extraSpaceSeatUpgradeText(s.extraSpaceSeatUpgradeText),t.setAutoAssignedSeats(null,s.selectedSeats,!0),a.currentFlightSelectedIndex(0),a.currentFlightSelectedIndex.valueHasMutated()}},e},function(e,t,a){"use strict";e.SeatingViewModel=function(s){var n=this,i=s.translation;n.nrOfSeats=s.nrOfSeats,n.translation=s.translation,n.onlyShowPriceOnFirstFlight=s.onlyShowPriceOnFirstFlight,n.showRandomSeatAssignmentMessage=s.showRandomSeatAssignmentMessage,n.enableDeselectSeatVB=s.enableDeselectSeatVB,n.AutoAssignedSeats=[],n.AirportNames=e.RouteInfo,n.vipSeatUpgradeText=t.observable(""),n.extraSpaceSeatUpgradeText=t.observable(""),n.seatsOut=t.observableArray([]),n.seatsIn=t.observableArray([]),n.showLoading=t.observable(!1),n.showLoading.subscribe(function(){n.seatDetailsVisible(!1)}),n.seatPrices=t.observableArray([]),n.proposedSeatDecisionPopoverVisible=t.observable(!1),n.seatPrices.subscribe(function(){a.publish("extras/setSeatPricesToEachSeat")}),n.getSeatingLoading=t.observable(!0),n.isAutoAssignedSeat=function(e,t,s){var i=!1;return a.each(n.AutoAssignedSeats,function(a,n){return n.PassengerNumber===e&&n.SeatNumber===t&&n.FlightKey===s?(i=!0,!1):!0}),i},n.getAutoAssignedSeats=function(e){var t=a.grep(n.AutoAssignedSeats,function(t){return t.PassengerNumber===e});return t},n.hasManuallyAssignedSeats=t.observable(!1),n.getSelectedSeatsForPassenger=function(e){return a.grep(n.selectedSeats(),function(t){return t.PassengerNumber===e})},n.passengerHasSelectedVipSeat=function(e){var t=a.grep(n.selectedSeats(),function(t){return t.PassengerNumber===e&&"VIP"===t.SeatType})[0];return!!t},n.showAssignedAtAirport=function(){var e=this,t=n.getSelectedSeat.call(e),a=n.selectedFlight();return!(a&&a.AnySeatsAvailable()||n.getSeatingLoading()||t)},n.selectedPassengerName=function(){var t=a.grep(e.passengerDetailsViewModel.passengers(),function(e){return e.passengerNumber()===n.selectedPassenger()})[0];return t?t.fullName():""},n.seatingFlights=t.observableArray([]),n.selectedSeats=t.observableArray([]),n.preSelectedSeatsOutbound=t.observableArray([]),n.preSelectedSeatsInbound=t.observableArray([]),n.getNumberOfFlights=function(){return n.seatingFlights().length},n.getPreselectedSeatsForPassenger=function(e,t){var s=t?n.preSelectedSeatsOutbound():n.preSelectedSeatsInbound(),i=a.grep(s,function(t){return t.PassengerNumber===e.passengerNumber()}),r=a.map(i,function(e){return e.SeatNumber});return r.join(" &rarr; ")},n.isRoundTrip=function(){return e.RouteInfo.IsRoundTrip},n.totalPriceWrapperVisible=t.observable(!0),n.totalSeatPrice=t.observable(""),n.totalSeatPriceValue=t.observable(0),n.totalSeatAndVipPrice=t.observable(""),n.isInternational=t.observable(!1),n.isRandomSeatAssignmentConsentChecked=t.observable(!1),n.preventAutoAssignedSeatsForVivaLight=!1,n.isRandomSeatAssignmentConsentChecked.subscribe(function(e){n.seatAssignmentConsentNotAccepted(!e)}),s.isInternational&&n.isInternational(!0),n.selectPassenger=function(t){var a=t.passengerNumber();n.selectedPassenger(a),n.HandleBlockedSeatsForPassengerAndFlight(),e.dataLayer.push({event:"Seating",infotype:"SelectPassenger",infodetail:s.changeBookingViewType})},n.selectedFlight=t.observable(),n.currentFlightSelectedIndex=t.observable(-1),n.nextFlightDisabled=t.observable(!1),n.prevFlightDisabled=t.observable(!1),n.prevFlight=function(){n.prevFlightDisabled()===!1&&n.currentFlightSelectedIndex(n.currentFlightSelectedIndex()-1)},n.nextFlight=function(){n.nextFlightDisabled()===!1&&n.currentFlightSelectedIndex(n.currentFlightSelectedIndex()+1)},n.currentFlightSelectedIndex.subscribe(function(e){n.prevFlightDisabled(0>=e),n.nextFlightDisabled(e>=n.seatingFlights().length-1);var t=n.seatingFlights()[n.currentFlightSelectedIndex()];n.selectedFlight(t),null!==t&&void 0!==t&&n.selectedFlightKey(t.FlightKey)}),n.acceptProposedSeats=function(){n.proposedSeatDecisionPopoverVisible()===!0&&a.publish("extras/acceptAutoAssignSeat"),a.publish("extras/hideProposedSeatPanel"),a.grep(n.selectedSeats(),function(e){e.isManuallyAssigned(!0)}),n.proposedSeatDecisionPopoverVisible(!1)},n.rejectProposedSeats=function(){a.publish("extras/releaseAutoAssignSeat",[n.selectedSeats()]),a.publish("extras/hideProposedSeatPanel"),n.proposedSeatDecisionPopoverVisible(!1)},n.initializeDecisionPanelForProposedSeats=function(){function e(){for(var e=document.getElementsByClassName("popover"),t=new MutationObserver(function(e){e.forEach(function(e){e.target.hasAttribute("x-out-of-boundaries")?e.target.style.display="none":e.target.style.display="block"})}),a=0;a<e.length;a++)t.observe(e[a],{attributes:!0,attributeFilter:["x-out-of-boundaries"]})}if(n.selectedSeats()&&n.selectedSeats().length>0){var t=a(".seating-seatmap-flight-header-mobile");if("none"!==t.css("display")){var s=a(".seats-popover-location-mobile");s.popover({content:a("#seats-selections-popover-content").html(),html:!0,trigger:"manual",placement:"bottom",fallbackPlacement:[]}),s.popover("show"),n.proposedSeatDecisionPopoverVisible(!0),s.on("shown.bs.popover",function(){n.scrollToSelectedSeat()}),e()}else{var i=document.getElementById("divExtrasSeat"),r=a(".seats-popover-location");r.popover({content:a("#seats-selections-popover-content").html(),html:!0,trigger:"manual",placement:"bottom",fallbackPlacement:[],boundary:i}),r.popover("show"),n.proposedSeatDecisionPopoverVisible(!0),r.on("shown.bs.popover",function(){n.scrollToSelectedSeat()})}a(".actions__reject").on("click",function(){n.rejectProposedSeats()}),a(".actions__accept").on("click",function(){n.acceptProposedSeats()})}},n.upgradeSeats=function(){a.publish("extras/hideProposedSeatPanel"),n.proposedSeatDecisionPopoverVisible(!1);var e=this,t=ExtrasViewModel.getExtraByType("ExtrasPetTravel");if(e.UpgradeForAllPassengers!==!1||e.PassengerNumber){if(t&&t.HasSelectedPetOnboard())return void n.PetNotAllowedInVipSeatDialog()}else if(e.PassengerNumber=n.selectedPassenger(),t&&t.HasSelectedPetOnboard(e.PassengerNumber))return void n.PetNotAllowedInVipSeatDialog();n.showLoading(!0),ezy.defaultAjax("/Seating/UpgradeSeat",e).success(function(e){e.Success?(a.publish("extras/setAutoAssignedSeats",[e.SelectedSeats,!1]),a.publish("extras/selectNextSeat")):alert("Something went wrong."),a.publish("extras/seatingChangeSsr")}).error(function(){alert("Something went wrong."),a.publish("extras/seatingChangeSsr")})},n.getSeatMapClass=function(){var t=e.passengerDetailsViewModel.passengers().length,a="seating-scrollable-container--low";return 3>=t?a="seating-scrollable-container--low":t>3&&5>=t?a="seating-scrollable-container--mid":t>5&&(a="seating-scrollable-container--high"),"seating-scrollable-container "+a},n.isMobile=function(){return!!ezy.isScreenSize(["xs","sm"])},n["continue"]=function(){var t=e.ExtrasViewModel.getExtraByType("ExtrasSeat");t.Open(!1)},n.blockExitrowSeatsForWheelchair=function(){a.each(n.seatsOut(),function(e,t){a.each(t.Seats,n.blockSeat)}),a.each(n.seatsIn(),function(e,t){a.each(t.Seats,n.blockSeat)})},n.unblockExitrowSeatsForNonWheelchair=function(){a.each(n.seatsOut(),function(e,t){a.each(t.Seats,n.unblockSeat)}),a.each(n.seatsIn(),function(e,t){a.each(t.Seats,n.unblockSeat)})},n.focusSeating=function(){a('.seatItem[tabindex="0"]:visible').first().focus()},n.selectPassengerByKey=function(e,t){13===t.keyCode&&n.selectPassenger(e,t),27===t.keyCode&&n.leaveFocus()},n.leaveFocus=function(){a(".passengerSeat").hasClass("selected")?a(".passengerSeat.selected").focus():a("#pvip-checkbox").focus()},n.removeSeatFromPassenger=function(e){var t=n.selectedFlightKey(),s=e.passengerNumber();a.publish("extras/removeSeatFromPassenger",[t,s])},n.getSelectedSeat=function(){var e=this,t=a.grep(n.selectedSeats(),function(t){return t.PassengerNumber===e.passengerNumber()&&t.FlightKey===n.selectedFlightKey()})[0];return t},n.selectedPassenger=t.observable(0),n.selectedFlightKey=t.observable(""),n.getSelectedSeatsForFlightKey=function(e){return a.grep(n.selectedSeats(),function(t){return t.FlightKey===e})},n.getSelectedSeatsForSelectedFlightKey=function(){return n.getSelectedSeatsForFlightKey(n.selectedFlightKey())},n.getSeatsForFlightKey=function(e){var t=a.grep(n.seatingFlights(),function(t){return t.FlightKey===e})[0];return t?t.SeatRows:[]},n.getSeatsForSelectedFlightKey=function(){return n.getSeatsForFlightKey(n.selectedFlightKey())},n.selectedSeatForSelectedFlightKeyAndPassenger=function(){var e=n.selectedPassenger(),t=n.getSelectedSeatsForSelectedFlightKey(),s=a.grep(t,function(t){return t.PassengerNumber===e})[0];return s?s.SeatNumber:""},n.selectedPassenger.subscribe(function(e){var t=a("[id='Passengers["+e+"]_Handicap']").prop("checked")||-1!==a.inArray(e,s.passengerNumbersWithSpecialAssistance);t?n.blockExitrowSeatsForWheelchair():n.unblockExitrowSeatsForNonWheelchair(),n.scrollToSelectedSeat()}),n.scrollToSelectedSeat=function(){var e=n.getSelectedSeatsForSelectedFlightKey(),t=a.grep(e,function(e){return e.PassengerNumber===n.selectedPassenger()})[0];if(t){var s=a(".background-seatmap-"+n.selectedFlight().DashedFlightKey),i=s.scrollTop(),r=s.find(".seatItem.seatNr"+t.SeatNumber).position(),o=void 0==r?0:r.top;s.animate({scrollTop:i+o},500)}},n.selectedFlightKey.subscribe(function(t){n.updateNanoScroller(n.scrollToSelectedSeat),e.dataLayer.push({event:"Seating",infotype:"ShowSeatmap",infodetail:s.changeBookingViewType,infodesc:t})}),n.getSpecialSeatsInventory=function(){var e=n.getSeatsForSelectedFlightKey(),t=0,s=0;return e!==[]&&a.each(e(),function(e,n){a.each(n.Seats,function(e,a){"Vip"===a.SeatType()&&t++,"Space"===a.SeatType()&&s++})}),{PriorityQuantity:t,MoreSpaceQuantity:s}},n.updateNanoScroller=function(e){setTimeout(function(){var t=a(".nano");t.nanoScroller({destroy:!0}),t.nanoScroller({iOSNativeScrolling:!0,preventPageScrolling:!0,alwaysVisible:!0}),e&&e()},1e3)},n.quickSelectVisible=t.observable(!1),n.toggleQuickSelect=function(){n.quickSelectVisible(!n.quickSelectVisible())},n.seatSelectedDetailsPosistionTop=t.observable(""),n.seatSelectedDetailsPosistionLeft=t.observable(""),n.seatSelectedDetailsText=t.observable(i.pleaseSelectSeat),n.seatSelectedDetailsVisible=t.observable(!1),n.showSelectedSeatDetails=function(e,t){if(ezy.isScreenSize(["xs","sm"]))return!0;var s=a(t.target).hasClass("passengerSeat")?a(t.target):a(t.target).closest(".passengerSeat"),r=s.attr("data-price"),o=s.offset();return n.seatSelectedDetailsText(i.pleaseSelectSeat),r&&n.seatSelectedDetailsText(r),o&&(n.seatSelectedDetailsPosistionTop(o.top+5+"px"),n.seatSelectedDetailsPosistionLeft(o.left+85+"px"),n.seatSelectedDetailsVisible(!0)),!0},n.isSeatsAvailable=function(){return n.seatingFlights().length>0},n.PetNotAllowedInVipSeatDialog=function(e){var t={modal:!0,buttons:[{clsName:"button accept",title:"<span>"+s.translation.PetNotAllowedInVipSeatDialog.AcceptButtonText+"<i></i></span>",value:!0,altTitle:s.translation.PetNotAllowedInVipSeatDialog.AcceptButtonText}],maxWidth:500};ezy.fancyAccept('<div class="condition-text"><p style="text - align: center;"><span class="largeRed"><strong>'+s.translation.PetNotAllowedInVipSeatDialog.Content+"</strong></span></p></div>",t,function(){if(void 0!==e){a.each(n.getAutoAssignedSeats(e),function(t,s){a.publish("extras/selectSeat",[s,e,!1])});var t=ExtrasViewModel.getExtraByType("ExtrasPetTravel");t.SelectBoxChange()}a.fancybox.close()})},n.HandleBlockedSeatsForPassengerAndFlight=function(t){if(void 0===t&&(t=n.selectedPassenger()),-1!==t){t!==n.selectedPassenger()&&n.selectedPassenger(t);var i=ExtrasViewModel.getExtraByType("ExtrasPetTravel"),r=!1;i&&(r=i.HasSelectedPetOnboard(t));var o=[],l=a.grep(e.passengerDetailsViewModel.passengers(),function(e){return e.passengerNumber()===t})[0],c=l.selectedHandicap(),u=-1!==a.inArray(c,s.specialAssistanceSsrsThatCanSelectSeat),S=c&&"no"!==c||-1!==a.inArray(t,s.passengerNumbersWithSpecialAssistance);l.handicap()&&S&&!u&&o.push(["BlockSeatForSpecialAssistance",!0]),r&&o.push(["BlockSeatForPet",!0]),n.handleBlockedSeats(o,t)}},n.releaseSeatIfSelected=function(e,t,s){var i=[],r=a.grep(n.selectedSeats(),function(e){return e.FlightKey===s}),o=a.grep(r,function(a){return a.SeatNumber===e&&a.PassengerNumber===t});return o.length>0&&(a.each(o,function(e,t){a.publish("extras/removeSeatFromPassenger",[s,t.PassengerNumber]),i.push(a.extend({},t))}),a.publish("extras/selectNextSeat")),i},n.blockSeat=function(e,t,s,i){if(0===t.length)return[];var r=0;a.each(t,function(t,s){var n=s[0],i=s[1];a.isArray(i)?a.each(i,function(t,a){return e[n]===a?(r++,!1):!0}):e[n]===i&&r++});var o=[],l=r===t.length;return l&&e.OriginalCanBeSelected===!0&&(e.CanBeSelected(!1),e.SeatType(SeatType.BLOCKED),o=n.releaseSeatIfSelected(e.SeatNumber,i,e.FlightKey)),o},n.unblockSeat=function(e,t){t.OriginalSeatType&&t.OriginalCanBeSelected===!0&&(t.CanBeSelected(t.OriginalSeatType!==SeatType.BLOCKED),t.SeatType(t.OriginalSeatType))},n.handleBlockedSeats=function(e,t){n.unblockBlockedSeats();var s=[],i=[];a.each(n.seatsOut(),function(i,r){a.each(r.Seats,function(){var i=n.blockSeat(this,e,"out",t);a.each(i,function(e,t){s.push(t)})})}),a.each(n.seatsIn(),function(s,r){a.each(r.Seats,function(){var s=n.blockSeat(this,e,"in",t);a.each(s,function(e,t){i.push(t)})})}),n.updateAssignedAtAirportForPassenger(t),(s.length>0||i.length>0)&&n.handleReAssignSeatForPetPassenger(s,i)},n.updateAssignedAtAirportForPassenger=function(e){a.each(n.seatingFlights(),function(t,a){var s=n.getSelectedSeatsForFlightKey(a.FlightKey),i=n.getSeatsForFlightKey(a.FlightKey);n.updateAssignedAtAirportForFlight(e,s,a.AnySeatsAvailable(),i,t+1)})},n.updateAssignedAtAirportForFlight=function(e,t,s,i,r){var o=a.grep(t,function(t){return t.PassengerNumber===e})[0],l=s===!1&&void 0===o&&i.length>0;l?-1===a.inArray(e,n.passengersThatDoNotRequireSeat())&&n.passengersThatDoNotRequireSeat.push(e):n.passengersThatDoNotRequireSeat.remove(function(t){return t===e})},n.handleReAssignSeatForPetPassenger=function(e,t){alert(i.SeatHaveBeenReleasedPet),n.showLoading(!0),ezy.scrollToElement("#divExtrasSeat",500,-50);var s={Reservations:[]};a.each(e,function(){s.Reservations.push({FlightKey:this.FlightKey,PassengerNumber:this.PassengerNumber})}),a.each(t,function(){s.Reservations.push({FlightKey:this.FlightKey,PassengerNumber:this.PassengerNumber})}),ezy.defaultAjax("/Seating/ReservePetSeatAsync",s).success(function(e){e.Success?(a.publish("extras/setAutoAssignedSeats",[e.SelectedSeats,!1]),n.HandleBlockedSeatsForPassengerAndFlight()):alert("Something went wrong."),a.publish("extras/seatingChangeSsr")}).error(function(){alert("Something went wrong."),a.publish("extras/seatingChangeSsr")})},n.passengersThatDoNotRequireSeat=t.observableArray([]),n.unblockBlockedSeats=function(){a.each(n.seatsOut(),function(e,t){a.each(t.Seats,n.unblockSeat)}),a.each(n.seatsIn(),function(e,t){a.each(t.Seats,n.unblockSeat)})},n.hideSelectedSeatDetails=function(){n.seatSelectedDetailsVisible(!1),n.seatSelectedDetailsText(i.pleaseSelectSeat)},n.toggleSeatInfo=function(){a("#seatInfo").is(":visible")?a("#seatInfo").velocity("slideUp"):a("#seatInfo").velocity("slideDown")},n.seatDetailsWidth=t.observable(""),n.seatDetailsHeight=t.observable(""),n.seatDetailsPosistionTop=t.observable(""),n.seatDetailsPosistionLeft=t.observable(""),n.seatDetailsColorType=t.observable(""),n.seatDetailsText=t.observable(""),n.seatDetailsVisible=t.observable(!1),
n.isSelectable=function(e){return-1!==e.indexOf(SeatType.BLOCKED)?!1:-1!==e.indexOf(SeatType.RESERVED)?!1:-1===e.indexOf(SeatType.AISLE)},n.seatItemEvents=function(){var t=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!e.MSStream;return t?{}:{mouseover:n.showSeatDetails,mouseout:n.hideSeatDetails,keypress:n.selectSeatByKey}},n.showSeatDetails=function(t,s){if(ezy.isScreenSize(["xs","sm"]))return!0;var i=a(s.target).hasClass("seatItem")||a(s.target).hasClass("exitrow")?a(s.target):a(s.target).parent(),r=i.width(),o=r/2,l=140,c=50,u=50,S=0,g=0,d=0;if(t.IsExitRow)n.seatDetailsText("<div class='exitrow-popup-content'>"+n.translation.ExitrowPopupText+"</div>"),l=300,d=i.position().top+-1*c+u,g=i.position().left+o+l/2*-1+S,n.seatDetailsWidth(l+"px"),n.seatDetailsHeight(c+"px"),n.seatDetailsPosistionTop(d+"px"),n.seatDetailsPosistionLeft(g+"px"),n.seatDetailsColorType((t.IsVipRow()?"vip":"space")+"-color"),n.seatDetailsVisible(!0);else if(n.isSelectable(s.currentTarget.className)){var p=a("<div>"),h=a("<div>").addClass("popup-column"),b=a("<div>").addClass("popup-column").addClass("seat-number"),f=a("<div>").addClass("seat-type"),y=a("<div>").addClass("price"),v=a("<div>").addClass("exitrow-web-checkin").html(n.translation.ExitrowSeatPopupText);f.html(t.GetSeatTypeDisplayName());var m="";if(m=_currencyHelper.format(t.PriceInDecimal),n.onlyShowPriceOnFirstFlight===!1)y.html(m);else{var P=2===e.RouteInfo.OutboundFlightKeys.length&&1===n.currentFlightSelectedIndex(),F=2===e.RouteInfo.InboundFlightKeys.length&&3===n.currentFlightSelectedIndex();(P||F)&&(m=""),y.html(m)}var w=a.grep(t.EquipmentProperies,function(e,t){return"PREFER"===e.TypeCode})[0];if(w){var x=a("<div>").addClass("seat-type-info").html(n.translation.PreferSeatPopupText);h.prepend(x),c+=13}h.prepend(f),h.prepend(y),b.html(t.SeatNumber),p.prepend(b),p.prepend(h),t.ExitRow===!0&&(p.append(v),c=65,l=190),n.seatDetailsText(p.html()),d=i.position().top+-1*c+u,g=i.position().left+o+l/2*-1+S,n.seatDetailsWidth(l+"px"),n.seatDetailsHeight(c+"px"),n.seatDetailsPosistionTop(d+"px"),n.seatDetailsPosistionLeft(g+"px"),n.seatDetailsColorType(t.SeatType().toLowerCase()+"-color"),n.seatDetailsVisible(!0)}return!0},n.hideSeatDetails=function(){n.seatDetailsVisible(!1),n.seatDetailsText("")},n.selectNextPassenger=function(){a.publish("extras/selectNextSeat")},n.selectSeatFromPassengerList=function(e,t,a){n.selectedPassenger(t),n.selectSeat(e,a)},n.selectSeat=function(t,r){n.acceptProposedSeats();var o=n.selectedPassenger(),l=ExtrasViewModel.getExtraByType("ExtrasPetTravel");if(l&&l.HasSelectedPetOnboard(o))return void n.PetNotAllowedInVipSeatDialog();var c=n.getSelectedSeatsForSelectedFlightKey(),u=a.grep(c,function(e){return e.SeatNumber===t.SeatNumber})[0];if(u&&n.enableDeselectSeatVB===!0&&a.publish("extras/selectSeat",[t,o,!0]),u)return n.selectedPassenger(u.PassengerNumber),!0;if(-1===o)return e.dataLayer.push({event:"Seating",infotype:"AlertPleaseSelectPassenger",infodetail:s.changeBookingViewType}),alert(i.pleaseSelectPassengerText),!0;if(n.isSelectable(r.currentTarget.className)){var S=-1!==r.currentTarget.className.indexOf(SeatType.SELECTED);a.publish("extras/selectSeat",[t,o,S])}return!0},n.selectSeatByKey=function(e,t){13===t.keyCode&&n.selectSeat(e,t),27===t.keyCode&&n.leaveFocus()},n.seatAssignmentConsentNotAccepted=t.observable(!1),n.showSeatAssignmentConsent=function(){return n.showRandomSeatAssignmentMessage===!0&&0===n.selectedSeats().length&&"VivaSmart"!==e.ExtrasViewModel.currentVivaProduct()},n.validateRandomSeatAssignConsentCheckbox=function(){return n.isRandomSeatAssignmentConsentChecked()===!1?(n.seatAssignmentConsentNotAccepted(!0),!1):!0},n.validateSeating=function(){var e=n.seatingFlights().length>0;return e?n.proposedSeatDecisionPopoverVisible()===!0?(n.acceptProposedSeats(),n.validationSuccess(),!0):n.showSeatAssignmentConsent()?n.validateRandomSeatAssignConsentCheckbox()?(n.validationSuccess(),!0):(n.validationError(),n.showNoSeatSelectedPopup(),!1):n.isInternational()?(n.validationSuccess(),!0):(n.validationSuccess(),!0):!0},n.showNoSeatSelectedPopup=function(){a.fancybox({href:"#no-seat-selected-popup",hideOnContentClick:!1,helpers:{overlay:{locked:!1}},padding:5,margin:ezy.isScreenSize(["xs"])?0:10,autoSize:!1,autoWidth:ezy.isScreenSize(["md","lg"]),autoHeight:!0,fixed:!0,autoCenter:!0})},n.continueManualSeatSelectionFromPopup=function(){a.fancybox.close(),ezy.scrollToElement("#divExtrasSeat",500,-50)},n.continueWithoutSeatSelectionFromPopup=function(){n.proposedSeatDecisionPopoverVisible()===!0&&n.rejectProposedSeats(),n.isRandomSeatAssignmentConsentChecked(!0),n.seatAssignmentConsentNotAccepted(!1),a.fancybox.close(),e.ExtrasViewModel.sections["continue"]()},n.validationError=function(){e.dataLayer.push({event:"Error",errtype:"Seating",errdetail:"Validation"})},n.validationSuccess=function(){e.dataLayer.push({event:"Seating",infotype:"SeatingCompleted",infodetail:s.changeBookingViewType})},n.getNumberOfPassengerThatMustHaveSeat=function(e,t){for(var s=0,n=0;n!==e;n++)-1===a.inArray(n,t)&&s++;return s},n.selectedPassengerHasSeatType=function(){var e=ExtrasViewModel.seating,t=this,s=a.grep(e.selectedSeats(),function(a){return a.PassengerNumber===e.selectedPassenger()&&(a.SeatType===t||a.OriginalSeatType===t)})[0];return!!s}},ezy.Seat=function(s){var n=this;n.Aisle=s.Aisle,n.AllowForSpecialAssistanceThatCanSelectSeat=s.AllowForSpecialAssistanceThatCanSelectSeat,n.BlockSeatForInfant=s.BlockSeatForInfant,n.BlockSeatForPet=s.BlockSeatForPet,n.BlockSeatForSpecialAssistance=s.BlockSeatForSpecialAssistance,n.OriginalCanBeSelected=n.OriginalCanBeSelected?n.OriginalCanBeSelected:s.CanBeSelected,n.CanBeSelected=t.observable(s.CanBeSelected),n.EquipmentProperies=s.EquipmentProperies,n.ExitRow=s.ExitRow,n.ExtraSpace=s.ExtraSpace,n.FlightKey=s.FlightKey,n.FlightNumber=s.FlightNumber,n.IsAisleSeat=s.IsAisleSeat,n.LastRow=s.LastRow,n.Middle=s.Middle,n.NoSeatsInFront=s.NoSeatsInFront,n.Note=s.Note,n.IsFusion=s.IsFusion,n.FusionSeatGroup=s.FusionSeatGroup,n.PriceOptions=s.PriceOptions,n.Hash=s.Hash,n.OriginalPrice=s.OriginalPrice,n.Price=s.Price,n.PriceInDecimal=s.PriceInDecimal,n.PriceWithoutTaxInDecimal=s.PriceWithoutTaxInDecimal,n.RowNumber=s.RowNumber,n.SeatAvailability=s.SeatAvailability,n.SeatGroup=s.SeatGroup,n.SeatLetter=s.SeatLetter,n.SeatMapType=s.SeatMapType,n.SeatNumber=s.SeatNumber,n.SeatType=t.isObservable(s.SeatType)?s.SeatType:t.observable(s.SeatType),n.OriginalSeatType=s.OriginalSeatType,n.SegmentNumber=s.SegmentNumber,n.Window=s.Window,n.IsVipRow=function(){return n.RowNumber>=1&&n.RowNumber<=3},n.GetSeatTypeDisplayName=function(){return n.SeatType()===SeatType.VIP?e.seatingViewModel.translation.VipSeatDisplayName:n.SeatType()===SeatType.SPACE?e.seatingViewModel.translation.SpaceSeatDisplayName:n.SeatType()===SeatType.INCLUDED?e.seatingViewModel.translation.IncludedSeatDisplayName:n.SeatType()},n.isSelected=function(){var e=ExtrasViewModel.seating,t=e.getSelectedSeatsForSelectedFlightKey(),s=a.grep(t,function(e){return e.SeatNumber===n.SeatNumber})[0];return void 0!==s},n.seatIcon=function(){var e="seaticon",t="cabin";n.SeatType()===SeatType.SPACE&&(t="morespace"),n.SeatType()===SeatType.VIP&&(t="vip"),n.CanBeSelected()!==!1||n.SeatType()!==SeatType.BLOCKED&&n.SeatType()!==SeatType.RESERVED||(n.OriginalSeatType===SeatType.SPACE?t="morespace":n.OriginalSeatType===SeatType.VIP&&(t="vip"));var s="taken";if(n.CanBeSelected()===!0&&(s="available"),n.isSelected()===!0){var i=ExtrasViewModel.seating,r=a.grep(i.getSelectedSeatsForSelectedFlightKey(),function(e){return e.SeatNumber===n.SeatNumber})[0];if(r&&0==r.isManuallyAssigned())return e+"-"+t+"-preselected.svg"}return n.isSelected()===!0&&(s="selected"),e+"-"+t+"-"+s+".svg"},n.isSelectedForSelectedPassenger=t.computed(function(){var e=ExtrasViewModel.seating,t=e.getSelectedSeatsForSelectedFlightKey(),s=a.grep(t,function(t){return t.PassengerNumber===e.selectedPassenger()&&t.SeatNumber===n.SeatNumber&&t.showSeatNumber()})[0];return void 0!==s}),n.getSelectedPassengerInitials=t.computed(function(){var t=ExtrasViewModel.seating,s=t.getSelectedSeatsForSelectedFlightKey(),i=a.grep(s,function(e){return e.SeatNumber===n.SeatNumber})[0];if(!i)return"";var r=a.grep(e.passengerDetailsViewModel.passengers(),function(e){return e.passengerNumber()===i.PassengerNumber})[0];return r?r.initials():""}),n.getSelectedPassengerNumber=t.computed(function(){var t=ExtrasViewModel.seating,s=t.getSelectedSeatsForSelectedFlightKey(),i=a.grep(s,function(e){return e.SeatNumber===n.SeatNumber})[0];if(!i)return"";var r=a.grep(e.passengerDetailsViewModel.passengers(),function(e){return e.passengerNumber()===i.PassengerNumber})[0];return r?r.passengerNumber():""})},ezy.SeatRow=function(e){var t=this;t.FlightKey=e.FlightKey,t.IsExitRow=e.IsExitRow,t.IsWingRow=e.IsWingRow,t.RowNumber=e.RowNumber,t.IsVipRow=function(){return t.RowNumber>=1&&t.RowNumber<=3},t.Seats=[],a.each(e.Seats,function(e,a){t.Seats.push(new ezy.Seat(a))})},ezy.SelectedSeat=function(a,s,n){var i=this;i.OriginalSeat=a,i.PassengerNumber=s,i.SeatNumber=a.SeatNumber,i.FlightNumber=a.FlightNumber,i.FlightKey=a.FlightKey,i.PriceInDecimal=a.PriceInDecimal,i.OriginalPrice=a.OriginalPrice,i.Hash=a.Hash,i.FusionSeatGroup=a.FusionSeatGroup,i.PriceOptions=a.PriceOptions,a.SeatType()===SeatType.VIP?i.SeatType=e.seatingViewModel.translation.VipSeatDisplayName:a.SeatType()===SeatType.SPACE?i.SeatType=e.seatingViewModel.translation.SpaceSeatDisplayName:a.SeatType()===SeatType.INCLUDED?i.SeatType=e.seatingViewModel.translation.IncludedSeatDisplayName:i.SeatType=a.SeatType(),i.OriginalSeatType=a.OriginalSeatType,i.IsFusion=a.IsFusion,i.Color="#adadad","Vip"===i.OriginalSeatType?i.Color="#85a4c0":"Space"===i.OriginalSeatType&&(i.Color="#fcd6a7"),i.isManuallyAssigned=t.observable(n),i.showSeatNumber=function(){return"VivaSmart"===ExtrasViewModel.currentVivaProduct()||i.isManuallyAssigned()},i.getSeatIconTemplate=t.computed(function(){return e.seatingViewModel.getSelectedSeatsForPassenger(i.PassengerNumber)&&i.isManuallyAssigned()===!1?"seat-icon-template-proposed":e.seatingViewModel.getSelectedSeatsForPassenger(i.PassengerNumber)?"seat-icon-template-selected":e.seatingViewModel.selectedPassenger()===i.PassengerNumber?"seat-icon-template-focused":"seat-icon-template-available"})}}(window,ko,jQuery);
function BookingBasketViewModel(e){var s=this;return s.basket=ko.mapping.fromJS(e),s.showTuaMessage=ko.observable(e.ShowTuaMessage),s.tuaIsIncludedInFarePrice=ko.observable(e.TuaIsIncludedInFarePrice),s.showTuaAddedMessage=ko.computed(function(){if(!window.ExtrasViewModel||!window.ExtrasViewModel.getExtraByType)return!1;var e=window.ExtrasViewModel.getExtraByType("ExtrasMexicoDepartureTax");return e&&"true"===e.selectedOption()},s),s.showVivaZeroTuaAddedMessage=function(){return window.productClassSelector?window.productClassSelector.preAddTuaVivaZeroActive():!1},s}ezy.views.flight.bookingbasket=function(){var e={},s={},o={};o.ViewModel=null;var i=!1;return o.init=function(o){e=o,s.setEvents(),s.setSubscriptions(),s.setIEsettings()},s.setIEsettings=function(){$.support.opacity||screen.availWidth<1540&&$("#bookingBasket").addClass("ie8")},s.setEvents=function(){s.setScrollFollow(),$("#toggleBasket").click(function(){s.toggleBasket()}),$(".basketPayment__header, .basketPassengers__header, .basketFlight__header").click(function(){var e=$(this).children("div[class^='arrow-']");e.toggleClass("arrow-up"),e.toggleClass("arrow-down"),$(this).siblings(".toggleable").slideToggle()})},s.enableBasketExpand=function(){$("#basketArrow").show()},s.disableBasketExpand=function(){$("#basketArrow").hide()},s.setSubscriptions=function(){$.subscribe("bookingBasket/showLoading",s.showLoading),$.subscribe("bookingBasket/hideLoading",s.hideLoading),$.subscribe("bookingBasket/hide",s.hide),$.subscribe("bookingBasket/hideWholeBookingBasket",s.hideWholeBookingBasket),$.subscribe("bookingBasket/show",s.show)},s.show=function(e,a){i=!0,s.hideLoading(),s.enableBasketExpand(),$("#basketNoneSelected").hide(),ezy.isScreenSize(["lg"])?s.showBasket():s.hideBasket();try{if(null==a)throw"bookingbasket data is null";null!==o.ViewModel?(ko.mapping.fromJS(a,{},o.ViewModel.basket),$.publish("bookingBasket/update",o.ViewModel.basket)):(o.ViewModel=new BookingBasketViewModel(a),ko.applyBindings(o.ViewModel,$("#bookingBasket")[0]))}catch(e){confirm("bookingbasket error: "+e.message+", reload browser?")&&window.location.reload()}},s.hide=function(){s.minusShoppingCartIcon(),$("#basketLoading").hide(),$("#basketBody").hide(),s.disableBasketExpand()},s.hideWholeBookingBasket=function(){$("#bookingBasket").hide()},s.showLoading=function(){$("#basketLoading").show(),$("#basketBody").hide(),$("#basketNoneSelected").hide(),"none"!=$(".minimized").css("display")&&$(".basketHeader").addClass("closed").removeClass("open")},s.hideLoading=function(){$("#basketLoading").hide(),$(".basketHeader").removeClass("closed").addClass("open"),i=!0},s.toggleBasket=function(){$("#basketNoneSelected").is(":visible")||$("#basketBody").is(":visible")?s.hideBasket():s.showBasket()},s.hideBasket=function(){$("#basketBody").velocity("slideUp"),$("#basketNoneSelected").velocity("slideUp"),$("#basketArrow").removeClass("open").addClass("close"),$(".basketHeader").addClass("closed").removeClass("open"),s.plusShoppingCartIcon()},s.showBasket=function(){if(i){var e=$("#basketBody");e.is(":visible")||e.velocity("slideDown")}else $("#basketNoneSelected").velocity("slideDown");$("#basketArrow").removeClass("close").addClass("open"),$(".basketHeader").removeClass("closed").addClass("open"),s.minusShoppingCartIcon()},s.plusShoppingCartIcon=function(){$("#toggleBasket").find("i").addClass("plus").removeClass("minus")},s.minusShoppingCartIcon=function(){$("#toggleBasket").find("i").addClass("minus").removeClass("plus")},s.setScrollFollow=function(){var e=$(".booking").length>0?$(".booking"):$("#manageBooking"),s=$("#bookingBasket"),o=$(".headWrapper .container");$(window).scroll(function(){var i=s.height(),a=e.offset().top,t=$(this).scrollTop(),n=a+e.height()-o.height(),d=t>=a-o.height(),l=t+i>=n;d&&!l?s.addClass("fixed"):s.removeClass("fixed")})},o};
function PaymentSummaryViewModel(e,a){var t=this;t.basket=ko.mapping.fromJS(e.PaymentData.BookingSummaryTemplateDataVB);var n=e.PaymentData.Payments.length>0?e.PaymentData.Payments:[{Name:a,Amount:e.PaymentData.TotalPriceString,Extra:""}];return t.Payments=ko.observableArray(n),t.modifyExtras=function(){var e=ezy.isScreenSize(["xs","sm"])?-60:-15,a=$(".headWrapper .container").height();e-=a,$("#extras").is(":visible")&&$("#extras").velocity("scroll",{duration:750,offset:e}),$("#divFusionExtrasOffer").is(":visible")&&$("#divFusionExtrasOffer").velocity("scroll",{duration:750,offset:e})},t}ezy.views.flight.payment=function(){var e={},a={},t={};return a.summaryViewModel=null,a.hasPreselectedPayment=!1,a.fusionExtrasOfferInformation="ezy",a.fusionExtrasOfferCxid="",a.fusionExtrasOfferResponseId="",a.fusionAvailabilityOfferCxid="",a.fusionAvailabilityOfferResponseId="",a.locator="",a.isAntiFraudScriptInitialized=!1,t.init=function(t){e=t,a.setEvents(),a.setSubscriptions(),a.setValidation()},a.paymentTableData={TotalAmount:0,OutstandingAmount:0,OutstandingText:"Total",Payments:[]},a.getSerializedForm=function(t){var n=e.form.serializeObject();return n.TermsAndConditions=t,""==n.SelectPayment&&(n.SelectPayment=a.getSelectedPayment()),n},a.getSelectedPayment=function(){return e.form.find(".up").closest(".paymentHead").attr("data-paymenttype")},a.setEvents=function(){$("#payments .paymentHead").click(a.openPaymentOption),$("#payments .paymentGroupHead").click(a.onPaymentGroupClick),$("#bookNow").click(function(){if(console.log("TUA validation: entered"),window.ExtrasViewModel&&window.ExtrasViewModel.getExtraByType){console.log("TUA validation: entered");var e=window.ExtrasViewModel.getExtraByType("ExtrasMexicoDepartureTax");if(e){var t=e.ShouldValidateTuaSelection();if(console.log("TUA validation: successfully fetched TUA extra"),console.log("TUA validation: shouldValidate: "+t),t)return window.dataLayer.push({event:"TUARequired"}),e.bookButtonHasBeenClicked(!0),ezy.scrollToElement("#extras-tua-error-container",500,-70),console.log("TUA validation: completed. Returning validation error."),!1}}console.log("TUA validation: completed. No validation error."),$("#btnBookNow").click();var n=a.getSelectedPayment(),i={box:"Payment",payment:n};dataLayer.push(i),console.log("Boxever.eventCreate(paymentEvent, function (data) { }, 'json');"),console.log(i),dataLayer.push({ecommerce:{checkout:{actionField:{step:3,option:n},products:dataLayerSelectedProducts}},event:"checkoutPayment"}),dataLayer.push({ecommerce:{checkout:{actionField:{step:4,option:"change"},products:dataLayerSelectedProducts}},event:"checkoutBooking"})}),e.performChangeButton.click(function(){if("Date"===e.changeBookingViewType)$.publish("changebooking/commitChanges");else if("Extras"===e.changeBookingViewType||"Seat"===e.changeBookingViewType){a.showLoading();var t=a.getSerializedForm(!0);e.bookHandler(JSON.stringify(t))}else"Name"===e.changeBookingViewType?$.publish("changebooking/commitChanges"):"MexicoDepartureTaxPage"===e.changeBookingViewType&&$.publish("changebooking/commitChanges")}),e.validationControls.accertifyPayNow.cardType.change(function(){a.onPaymentOptionChanged($(this).closest(".payment").find(".paymentHead"),!1,!0,!0)}),e.validationControls.accertifyInstallments.cardType.change(function(){a.onPaymentOptionChanged($(this).closest(".payment").find(".paymentHead"),!1,!0,!0)}),e.validationControls.accertifyInstallments.installments.change(function(){a.onPaymentOptionChanged($(this).closest(".payment").find(".paymentHead"),!1,!0,!0),$(e.validationControls.accertifyInstallments.cardNumber).valid()}),e.validationControls.banamexDebitCard.cardType.change(function(){a.onPaymentOptionChanged($(this).closest(".payment").find(".paymentHead"),!1,!0,!0)}),e.validationControls.vivaScotiaCard.installments.change(function(){a.onPaymentOptionChanged($(this).closest(".payment").find(".paymentHead"),!1,!0,!0)}),e.validationControls.accertifyPayNow.copyPassengerDetails.change(function(){var t={firstName:e.validationControls.accertifyPayNow.firstName,lastName:e.validationControls.accertifyPayNow.lastName,phone:e.validationControls.accertifyPayNow.phone,viewModel:window.accertifyPayNowViewModel};this.checked?a.copyPassengerDetailsToPaymentControls(t):a.clearPassengerDetailsFromPaymentControls(t)}),e.validationControls.accertifyInstallments.copyPassengerDetails.change(function(){var t={firstName:e.validationControls.accertifyInstallments.firstName,lastName:e.validationControls.accertifyInstallments.lastName,phone:e.validationControls.accertifyInstallments.phone,viewModel:window.accertifyInstallmentsViewModel};this.checked?a.copyPassengerDetailsToPaymentControls(t):a.clearPassengerDetailsFromPaymentControls(t)}),e.validationControls.banamexDebitCard.copyPassengerDetails.change(function(){var t={firstName:e.validationControls.banamexDebitCard.firstName,lastName:e.validationControls.banamexDebitCard.lastName,phone:e.validationControls.banamexDebitCard.phone,viewModel:window.banamexDebitCardViewModel};this.checked?a.copyPassengerDetailsToPaymentControls(t):a.clearPassengerDetailsFromPaymentControls(t)}),e.cvvIcons.mouseover(function(){a.showCvvHelp(this)}),e.cvvIcons.mouseout(function(){e.cvvPopup.container.stop(!0).fadeOut("fast")}),e.popup.links.click(function(e){e.preventDefault(),e.stopImmediatePropagation(),$.fancybox.open({helpers:{overlay:{locked:!1}},maxWidth:700,href:$(this).attr("href")})}),e.installmentsPopup.accept.click(function(e){e.preventDefault(),e.stopImmediatePropagation(),a.hideAccertifyInstallmentsPopup(),a.onPaymentOptionChanged($("#accertify-installments .paymentHead")[0],!0)}),e.installmentsPopup.cancel.click(function(e){e.preventDefault(),e.stopImmediatePropagation(),a.hideAccertifyInstallmentsPopup(),a.onPaymentOptionChanged($("#accertify-pay-now .paymentHead")[0],!0)}),e.validationControls.voucher.addVoucher.click(a.addVoucher),$("#voucher-payment, #paymentSummary").on("click",".remove-voucher-button",a.removeVoucher),$("#get-scotia-bank-balance").click(a.getScotiaBankBalance)},a.sendAntiFraudData=function(){"undefined"!=typeof _cc&&a.isAntiFraudScriptInitialized===!1&&void 0!==initializeAntiFraudScript&&(initializeAntiFraudScript(),a.isAntiFraudScriptInitialized=!0)},a.getScotiaBankBalance=function(){$("#scotia-bank-balance-result-container").hide(),$("#scotia-bank-balance-loader").show();var e=$("#ScotiaBankPayment_CardNumber").val();$.ajax({type:"POST",url:"/Payment/GetScotiaBankBalance",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({accountNumber:e}),success:function(e){e.success===!0&&($("#scotia-bank-balance").html(e.balance),$("#scotia-bank-balance-loader").hide(),$("#scotia-bank-balance-result-container").show())},complete:function(){$("#scotia-bank-balance-loader").hide()}})},a.addVoucher=function(){var t={voucherReference:$("#voucher-number").val()};$("#voucher-error-container").hide(),$("#voucher-loader-container").show(),$.ajax({type:"POST",url:"/Payment/AddVoucher",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(t),success:function(e){if(e.success===!0){var n=$(".added-voucher-template .added-voucher").clone();n.find(".voucher-number").html(t.voucherReference),n.find(".voucher-amount").html(e.voucherAmount),$("#added-vouchers").append(n),$("#added-vouchers").show(),$("#voucher-loader-container").hide(),$(".cash-payment").addClass("hidden"),$.publish("bookingBasket/show",e.Basket),ko.mapping.fromJS(e.Basket,{},a.summaryViewModel.basket)}else void 0!==e.error&&null!==e.error&&($("#voucher-loader-container").hide(),$("#voucher-error-container").html(e.error),$("#voucher-error-container").show())},error:function(){$("#voucher-loader-container").hide(),$("#voucher-error-container").html(e.translations.errorAddingVoucher),$("#voucher-error-container").show()}})},a.removeVoucher=function(){var e=$(this).closest(".added-voucher"),t=e.find(".voucher-number").html(),n={voucherReference:t};$.ajax({type:"POST",url:"/Payment/RemoveVoucher",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(n),success:function(i){i.success===!0?(e.remove(),window.GiftCardViewModel&&window.GiftCardViewModel.RemoveVoucher(t),$(".added-voucher").each(function(){var e=$(this).find(".voucher-number").html();e===n.voucherReference&&$(this).remove()}),0===$("#added-vouchers .added-voucher").length&&($("#added-vouchers").hide(),$(".cash-payment").removeClass("hidden")),$.publish("bookingBasket/show",i.Basket),ko.mapping.fromJS(i.Basket,{},a.summaryViewModel.basket)):void 0!==i.error&&null!==i.error&&($("#voucher-loader-container").hide(),$("#voucher-error-container").html(i.error),$("#voucher-error-container").show())}})},a.copyPassengerDetailsToPaymentControls=function(e){if(window.passengerDetailsViewModel){var a=window.passengerDetailsViewModel.passengers()[0];if(a){e.firstName.val(a.firstName()),e.lastName.val(a.lastName());var t=$("#phone").intlTelInput("getNumber");t.length>0?e.phone.intlTelInput("setNumber",$("#phone").intlTelInput("getNumber")):e.phone.intlTelInput("setNumber",a.phone()),e.viewModel.setSelectedCountry(a.selectedCountry().name),e.viewModel.setSelectedState(a.state())}}else $.ajax({type:"POST",url:"/PaymentsContainer/GetPassengerDetails",contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){null!=a.passenger&&(e.firstName.val(a.passenger.FirstName),e.lastName.val(a.passenger.LastName),e.phone.val("+"+a.passenger.HomePhone),e.viewModel.setSelectedCountry(a.passenger.Country),e.viewModel.setSelectedState(a.passenger.State))}})},a.clearPassengerDetailsFromPaymentControls=function(e){e.firstName.val(""),e.lastName.val(""),e.phone.val(""),e.viewModel.setSelectedCountry(void 0),e.viewModel.setSelectedState(void 0)},a.showCvvHelp=function(a){var t=$(a).offset().left+$(a).width()/2,n=$(a).offset().top+$(a).height(),i=e.cvvPopup.container.width()/2,o=10.5,r=t-i-2,s=n+4;0>r&&(r=0),e.cvvPopup.arrow.css({left:i-o}),e.cvvPopup.container.css({left:r,top:s}),e.cvvPopup.container.fadeIn("fast")},a.showNipHelp=function(a){var t=$(a).offset().left+$(a).width()/2,n=$(a).offset().top+$(a).height(),i=e.cvvPopup.container.width()/2,o=10.5;e.nipPopup.arrow.css({left:i-o}),e.nipPopup.container.css({left:t-i-2,top:n+4}),e.nipPopup.container.fadeIn("fast")},a.preselectMexicoDepartureTax=function(){window.ExtrasViewModel&&window.ExtrasViewModel.preselectMexicoDepartureTax&&window.ExtrasViewModel.preselectMexicoDepartureTax()},a.show=function(t){$("#payment-loading-loader, #additional-payment-loading").show(),a.preselectMexicoDepartureTax(),window.ezy.scrollToElement("#payment-loading-loader, #additional-payment-loading",500,-120);var n=function(){$("#payment-loading-loader, #additional-payment-loading").hide(),$.publish("changebooking/hidePerformChangeContainer"),$(".payment-details").show(),a.sendAntiFraudData(),$("#payments").velocity("slideDown",function(){var e=$(window).width()<768?-60:-15,a=$(".headWrapper .container").height();e-=a,"PayLandingPage"!==t&&$("#payments").velocity("scroll",{duration:750,offset:e}),$("#payments .payment:first .paymentHead .paymentAmount-wrapper a").focus()}),e.shouldPreselectPaymentOption===!0&&a.hasPreselectedPayment===!1&&(a.hasPreselectedPayment=!0,$('#payments .payment:not(.inactive) .paymentHead[data-paymenttype="'+e.paymentNames.accertifyPayNow+'"]').click())},i=function(){a.updatePaymentHeaderAmounts(n),a.setPaymentGroupVisibility()};a.hideInactivePayments(i),$.publish("vivacash/setVivaCashBalance"),window.GiftCardViewModel&&(window.GiftCardViewModel.VoucherPayAll()?(a.noAdditionalPayment(),$("#paymentSummary").show(),$("#paymentForm .payment").addClass("hidden")):$("#paymentForm .payment").removeClass("hidden"))},a.updatePaymentHeaderAmounts=function(e){var t=$("#payments .payment:not(.inactive) .paymentHead").map(function(){return $(this).attr("data-paymenttype")}).get();a.setPaymentHeaderAmounts("undefined"==typeof e?null:e,t)},a.setPaymentGroupVisibility=function(){$(".payment-group").each(function(e,a){var t=$(a).find(".payment-list .payment").not(".inactive").length>0;t?$(a).show():$(a).hide()})},a.hideInactivePayments=function(e){$.ajax({type:"POST",url:"/Payment/GetPaymentsActiveStatus",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){void 0!==e.inactivePayments&&($(e.inactivePayments).each(function(){var e=this;a.hidePaymentByPaymentType(e)}),$(e.activePayments).each(function(){var e=this;a.showPaymentByPaymentType(e)}));var t=$("#accertify-installments");if(t.length){var n=t.find(".paymentHead").attr("data-paymenttype");void 0!==e.inactivePayments&&-1!==$.inArray(n,e.inactivePayments)||a.setAccertifyInstallmentOptions()}var i=$("#viva-scotia-card");if(i.length){var o=i.find(".paymentHead").attr("data-paymenttype");void 0!==e.inactivePayments&&-1!==$.inArray(o,e.inactivePayments)||a.setVivaCardInstallmentOptions()}},complete:e})},a.reloadPayments=function(e,t){var n=function(){$.unblockUI()};$.ajax({type:"POST",url:"/Payment/GetPaymentsActiveStatus",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){void 0!==e.inactivePayments&&($(e.inactivePayments).each(function(){var e=this;a.hidePaymentByPaymentType(e)}),$(e.activePayments).each(function(){var e=this;a.showPaymentByPaymentType(e)}),a.setPaymentGroupVisibility())},complete:function(){t===!0&&a.updatePaymentHeaderAmounts(n,null)}})},a.hidePaymentByPaymentType=function(e){var a=$('.paymentHead[data-paymenttype="'+e+'"]');a.length&&(a.parent().hide(),a.parent().addClass("inactive"))},a.showPaymentByPaymentType=function(e){var a=$('.paymentHead[data-paymenttype="'+e+'"]');a.length&&(a.parent().show(),a.parent().removeClass("inactive"))},a.setAccertifyInstallmentOptions=function(){$.ajax({type:"POST",url:"/Payment/GetActiveAccertifyInstallmentOptions",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){if(void 0!==e.activeOptions&&$("#AccertifyInstallmentsPayment_Installments").length){$("#AccertifyInstallmentsPayment_Installments").html("");var a=$("#AccertifyInstallments_MonthsWithoutInterest").val(),t=$("#AccertifyInstallments_MonthsWithoutInterest18").val();$(e.activeOptions).each(function(e,n){18===n?$("#AccertifyInstallmentsPayment_Installments").append('<option value="'+n+'">'+t+"</option>"):$("#AccertifyInstallmentsPayment_Installments").append('<option value="'+n+'">'+n+" "+a+"</option>")})}}})},a.setVivaCardInstallmentOptions=function(){$.ajax({type:"POST",url:"/Payment/GetVivaCardInstallmentOptions",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var a=$("#VivaScotiaCardPayment_Installments");if(a.length&&void 0!==e.options){a.html("");var t=$("#VivaScotiaCardPayment_OneMonthWithOutInterestTranslation").val(),n=$("#VivaScotiaCardPayment_MonthsWithOutInterestTranslation").val();a.append('<option value="1">'+t+"</option>"),$(e.options).each(function(e,t){a.append('<option value="'+t+'">'+t+" "+n+"</option>")})}}})},a.setPaymentHeaderAmounts=function(e,a){var t={AccertifyPayNowSelectedCard:$("#AccertifyPayNowPayment_PaymentForm").val(),AccertifyInstallmentsSelectedCard:$("#AccertifyInstallmentsPayment_PaymentForm").val(),AccertifyInstallmentsSelectedInstallment:$("#AccertifyInstallmentsPayment_Installments").val(),BanamexDebitCardSelectedCard:$("#BanamexDebitCardPayment_PaymentForm").val(),VivaScotiaCardSelectedInstallment:$("#VivaScotiaCardPayment_Installments").val(),PaymentNames:a};window.upliftViewModel&&window.upliftViewModel.enabled&&!t.PaymentNames.includes("UL")&&t.PaymentNames.push("UL"),$.ajax({type:"POST",url:"/Payment/GetPaymentAmountsAsync",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),dataType:"json",success:function(e){void 0!==e.paymentAmounts&&$.each(e.paymentAmounts,function(e,a){var t=$('#payments .paymentHead[data-paymenttype="'+e+'"] .paymentAmount');t.length&&t.html(a),"UL"===e&&window.upliftViewModel&&window.upliftViewModel.enabled&&window.upliftViewModel.initUplift(100*parseFloat(a.replace(",","")))})},complete:e})},a.showFirstPaymentOption=function(){$(".payment:visible :first").trigger("click")},a.setSubscriptions=function(){$.subscribe("payment/show",a.show),$.subscribe("payment/updatePaymentHeaderAmount",a.updatePaymentHeaderAmounts),$.subscribe("payment/setPaymentGroupVisibility",a.setPaymentGroupVisibility),$.subscribe("payment/newBookingSubmit",a.newBookingSubmit),$.subscribe("payment/hideLoading",a.hideLoading),$.subscribe("payment/showBookError",a.showBookError),$.subscribe("payment/updateextrasinsummary",a.updateExtrasInSummary),$.subscribe("payment/updateAmountInSummary",a.updateAmountInSummary),$.subscribe("payment/noAdditionalPayment",a.noAdditionalPayment),$.subscribe("payment/hideAndCloseAllPaymentOption",a.hideAndCloseAllPaymentOption),$.subscribe("payment/setAllPaymentOptionToDefault",a.setAllPaymentOptionToDefault),$.subscribe("payment/triggerSelectedFlightOut",a.triggerSelectedFlightOut),$.subscribe("payment/showFirstPaymentOption",a.showFirstPaymentOption),$.subscribe("changebooking/hidePerformChangeContainer",a.hidePerformChangeContainer),$.subscribe("changebooking/showPerformChangeContainer",a.showPerformChangeContainer),$.subscribe("payment/setFusionExtrasOfferInformation",a.setFusionExtrasOfferInformation),$.subscribe("payment/setFusionAvailabilityOfferInformation",a.setFusionAvailabilityOfferInformation),$.subscribe("payment/reloadPayments",a.reloadPayments)},a.setFusionExtrasOfferInformation=function(e,t){a.fusionExtrasOfferInformation=t.offerType,a.fusionExtrasOfferCxid=t.cxid,a.fusionExtrasOfferResponseId=t.responseId},a.setFusionAvailabilityOfferInformation=function(e,t){a.fusionAvailabilityOfferCxid=t.cxid,a.fusionAvailabilityOfferResponseId=t.responseId},a.showLoading=function(){$("#bookNow").html(e.translations.pleaseWaitButton+"<i></i>"),$("#bookNow").attr("disabled","disabled"),$("#btnBookNow").attr("disabled","disabled"),$.blockUI({message:$("#pleaseWaitContent").html(),css:{border:"none",padding:"20px",fadeIn:0},overlayCSS:{opacity:.5}})},a.hideLoading=function(){$("#bookNow").html(e.translations.bookNowButton+"<i></i>"),$("#bookNow").removeAttr("disabled"),$("#btnBookNow").removeAttr("disabled"),$.unblockUI()},a.newBookingSubmit=function(e,t){var n=!1;$.ajax({type:"POST",url:"/Payment/BookAsync",data:t,contentType:"application/json; charset=utf-8",dataType:"json",error:function(e){a.handleBookError({Errors:[{ErrorDetail:e.responseText.substr(0,e.responseText.indexOf("</title>")).replace("</title>","").replace("<title>","").replace("<html>","").replace("<head>","")}]})},success:function(e){a.locator=void 0!==e&&null!==e?e.Locator:"locatornotfound",a.LogBookingSuccessEvents("OnPaymentSuccess",a.locator),n=!0,void 0!==e&&null!==e&&e.HaveError===!0?a.handleBookError(e):a.onBookingSubmitSuccess(e)},complete:function(){a.LogBookingSuccessEvents("OnPaymentComplete",a.locator),n!==!0&&a.hideLoading()}})},a.onBookingSubmitSuccess=function(e){a.LogBookingSuccessEvents("OnSendDecisionCallback",a.locator),a.HandleUpliftPaymentAnalytics(),a.handleBookSuccess(e)},a.HandleUpliftPaymentAnalytics=function(){try{if(window.upliftViewModel){var t=a.getSelectedPayment();t===e.paymentNames.uplift?window.upliftViewModel.sendOrderSubmitForInstallments():window.upliftViewModel.sendOrderSubmitForPayInFull()}}catch(n){console.log(n)}},a.LogBookingSuccessEvents=function(e,a){try{ezy.Analytics.SendEvent("BookingInfo",a+" - "+e)}catch(t){console.log(t)}},a.setValidation=function(){e.form.validate({submitHandler:function(t){if(!$(t).valid()){try{dataLayer.push({event:"Error",errtype:"Payment",errdetail:"Payment validation failed"})}catch(n){}return!1}var i=$("#chkTermsAndConditions").is(":checked");if(!i)return a.handleBookError({Errors:[{ErrorDetail:e.translations.acceptTermsAndConditions}]}),!1;a.showLoading();var o=$(t).serializeObject();o.TermsAndConditions=i,o["AccertifyPayNowPayment.Phone"]=$("#AccertifyPayNowPayment_Phone").intlTelInput("getNumber"),o["AccertifyInstallmentsPayment.Phone"]=$("#AccertifyInstallmentsPayment_Phone").intlTelInput("getNumber"),o["BanamexDebitCardPayment.Phone"]=$("#BanamexDebitCardPayment_Phone").intlTelInput("getNumber");var r=e.changeBookingViewType;"Extras"==r||"Name"==r||"Date"==r||"Seat"==r?dataLayer.push({event:"Change",infotype:r}):"None"==r&&dataLayer.push({event:"Booking"}),o.FusionExtrasOfferInformation=a.fusionExtrasOfferInformation,o.FusionExtrasOfferCxid=a.fusionExtrasOfferCxid,o.FusionExtrasOfferResponseId=a.fusionExtrasOfferResponseId,o.FusionAvailabilityOfferCxid=a.fusionAvailabilityOfferCxid,o.FusionAvailabilityOfferResponseId=a.fusionAvailabilityOfferResponseId,o.SelectPayment=$(t).find(".up").closest(".paymentHead").attr("data-paymenttype"),o.UpliftPayment=window.upliftViewModel?window.upliftViewModel.upliftPostObject:null;var s=JSON.stringify(o);return e.bookHandler(s),!1},debug:!0,rules:{},messages:{},errorContainer:".paymentErrorPayment",errorLabelContainer:".paymentErrorPayment ul",wrapper:"li"}),a.setAccertifyPayNowValidation(),a.setAccertifyInstallmentsValidation(),a.setBanamexDebitCardValidation(),a.setToditoCashValidation(),a.setScotiaBankValidation(),a.setVivaScotiaCardValidation(),a.setValidationConfirmation()},a.clearValidation=function(){var a=$(e.form).validate();$("[name]",e.form[0]).each(function(){a.successList.push(this),a.showErrors()}),a.resetForm(),a.reset()},a.showPerformChangeContainer=function(){e.performChangeContainer.show()},a.hidePerformChangeContainer=function(){e.performChangeContainer.hide()},a.handleBookSuccess=function(e){window.location.href=e.Url},a.showBookError=function(e,t){a.handleBookError(t)},a.handleBookError=function(e){a.hideLoading(),$(".paymentErrorPayment ul").html(""),$.each(e.Errors,function(e,t){$(".paymentErrorPayment ul").append("<li>"+t.ErrorDetail+"</li>");var n="";if(t.ErrorDetail.indexOf("[ValidateBooking]")>-1?n="Booking validate failed":t.ErrorDetail.indexOf("[BalanceRecalculated]")>-1?n="Booking balance recalculated":t.ErrorDetail.indexOf("[AmountDontMatch]")>-1?n="Booking amounts dont match":t.ErrorDetail.indexOf("[InvalidPriceCalculation]")>-1?n="Invalid price calculation":t.ErrorDetail.indexOf("[ClientDisconnected]")>-1?n="Client disconnected":t.ErrorDetail.indexOf("[SubmitBooking]")>-1?n="Submit booking":t.ErrorDetail.indexOf("[SubmitBookingDuplicate]")>-1?n="Submit booking duplicate":t.ErrorDetail.indexOf("[SubmitBookingQueueReject]")>-1?n="Submit booking queue reject":t.ErrorDetail.indexOf("[CreditCardFailed]")>-1&&(n="Credit card failed"),""!=n)try{dataLayer.push({event:"Error",errtype:"Booking",errdetail:n}),"W3"===a.getSelectedPayment()&&dataLayer.push({event:"Error",errtype:"VivaCash",errdetail:t.ErrorDetail})}catch(i){}if(t.ErrorDetail.indexOf("[SE]")>=0)try{dataLayer.push({event:"Session",infotype:"Payment"})}catch(i){}}),$(".paymentErrorPayment").show(),$(".paymentErrorPayment ul").show(),$(".paymentErrorPayment")[0].scrollIntoView()},a.addSelectListValidation=function(e,a){e.length>0&&e.rules("add",{notEqual:"-1",messages:{notEqual:a}})},a.addKnockoutListValidation=function(e,a,t){$(e).rules("add",{required:{depends:function(){var e=$(a).val();return""===e}},messages:{required:t}})},a.addCreditCardValidation=function(e,a,t,n){$(e).rules("add",{required:!0,creditcard2:function(){return $(a).val()},messages:{required:t,creditcard2:n}})},a.addVivaScotiaCardValidation=function(e,a,t){$(e).rules("add",{required:!0,creditcard2:function(){return"VivaScotiaCard"},messages:{required:a,creditcard2:t}})},a.addBinValidationForInstallments=function(a,t,n){$(a).rules("add",{vivaBinValidation:function(){return{bins:t,installments:$(e.validationControls.accertifyInstallments.installments).val()}},messages:{vivaBinValidation:n}})},a.addBinValidationForDebitCards=function(e,a,t){$(e).rules("add",{vivaDebitCardBinValidation:function(){return{bins:a}},messages:{vivaBinValidation:t}})},a.addCvvNumberValidation=function(e,a,t,n){$(e).rules("add",{required:!0,cvv:function(){return $(a).val()},messages:{required:t,cvv:n}})},a.addNameValidation=function(e,a){e.length>0&&e.rules("add",{required:!0,minlength:1,noDigits:!0,messages:{required:a,minlength:a,noDigits:a}})},a.addRequiredValidation=function(e,a,t,n){e.length>0&&(void 0!==t&&void 0!==n?e.rules("add",{required:!0,minlength:1,maxlength:t,messages:{required:a,minlength:a,maxlength:n}}):e.rules("add",{required:!0,minlength:1,messages:{required:a,minlength:a}}))},a.addRequiredValidationDigitsOnly=function(e,a){e.length>0&&e.rules("add",{required:!0,minlength:1,digits:!0,messages:{required:a,minlength:a,digits:a}})},a.addNumberValidation=function(e,a){e.length>0&&e.rules("add",{required:!0,number:!0,messages:{required:a,number:a}})},a.setValidationCreditCard=function(){a.addSelectListValidation(e.validationControls.creditCard.expiryYear,e.translations.youNeedToSelectYear),a.addSelectListValidation(e.validationControls.creditCard.expiryMonth,e.translations.youNeedToSelectMonth),a.addNameValidation(e.validationControls.creditCard.firstName,e.translations.fullNameRequiredFirstName),a.addNameValidation(e.validationControls.creditCard.lastName,e.translations.fullNameRequiredLastName),e.validationControls.creditCard.cardNumber.length>0&&$(e.validationControls.creditCard.cardNumber).rules("add",{required:!0,creditcard2:function(){return e.validationControls.creditCard.cardType.val()},messages:{required:e.translations.creditCardMissing,creditcard2:e.translations.creditCardInvalid}}),e.validationControls.creditCard.cvvNumber.length>0&&$(e.validationControls.creditCard.cvvNumber).rules("add",{required:!0,cvv:function(){return e.validationControls.creditCard.cardType.val()},messages:{required:e.translations.cvvInvalid,cvv:e.translations.cvvInvalid}})},a.setAccertifyPayNowValidation=function(){$("#accertify-pay-now").length&&(a.addCreditCardValidation(e.validationControls.accertifyPayNow.cardNumber,e.validationControls.accertifyPayNow.cardType,e.translations.creditCardMissing,e.translations.creditCardInvalid),a.addCvvNumberValidation(e.validationControls.accertifyPayNow.cvv,e.validationControls.accertifyPayNow.cardType,e.translations.cvvMissing,e.translations.cvvInvalid),a.addSelectListValidation(e.validationControls.accertifyPayNow.expirationYear,e.translations.youNeedToSelectYear),a.addSelectListValidation(e.validationControls.accertifyPayNow.expirationMonth,e.translations.youNeedToSelectMonth),a.addNameValidation(e.validationControls.accertifyPayNow.firstName,e.translations.fullNameRequiredFirstName),a.addNameValidation(e.validationControls.accertifyPayNow.lastName,e.translations.fullNameRequiredLastName),a.addRequiredValidation(e.validationControls.accertifyPayNow.address,e.translations.addressRequired),a.addRequiredValidation(e.validationControls.accertifyPayNow.city,e.translations.cityRequired),a.addRequiredValidation(e.validationControls.accertifyPayNow.zip,e.translations.zipRequired),a.addKnockoutListValidation(e.validationControls.accertifyPayNow.countryDrop,e.validationControls.accertifyPayNow.country,e.translations.youNeedToSelectCountry),a.addKnockoutListValidation(e.validationControls.accertifyPayNow.stateDrop,e.validationControls.accertifyPayNow.state,e.translations.youNeedToSelectState),$(e.validationControls.accertifyPayNow.phone).rules("add",{required:!0,phoneNumber:!0,messages:{required:e.translations.youNeedToEnterValidPhoneNumber}}))},a.setAccertifyInstallmentsValidation=function(){$("#accertify-installments").length&&(a.addCreditCardValidation(e.validationControls.accertifyInstallments.cardNumber,e.validationControls.accertifyInstallments.cardType,e.translations.creditCardMissing,e.translations.creditCardInvalid),a.addBinValidationForInstallments(e.validationControls.accertifyInstallments.cardNumber,e.invalidBinsForInstallments,e.translations.cardInvalidForInstallments),a.addCvvNumberValidation(e.validationControls.accertifyInstallments.cvv,e.validationControls.accertifyInstallments.cardType,e.translations.cvvMissing,e.translations.cvvInvalid),a.addSelectListValidation(e.validationControls.accertifyInstallments.expirationYear,e.translations.youNeedToSelectYear),a.addSelectListValidation(e.validationControls.accertifyInstallments.expirationMonth,e.translations.youNeedToSelectMonth),a.addNameValidation(e.validationControls.accertifyInstallments.firstName,e.translations.fullNameRequiredFirstName),a.addNameValidation(e.validationControls.accertifyInstallments.lastName,e.translations.fullNameRequiredLastName),a.addRequiredValidation(e.validationControls.accertifyInstallments.address,e.translations.addressRequired),a.addRequiredValidation(e.validationControls.accertifyInstallments.city,e.translations.cityRequired),a.addRequiredValidation(e.validationControls.accertifyInstallments.zip,e.translations.zipRequired),a.addKnockoutListValidation(e.validationControls.accertifyInstallments.countryDrop,e.validationControls.accertifyInstallments.country,e.translations.youNeedToSelectCountry),a.addKnockoutListValidation(e.validationControls.accertifyInstallments.stateDrop,e.validationControls.accertifyInstallments.state,e.translations.youNeedToSelectState),$(e.validationControls.accertifyInstallments.phone).rules("add",{required:!0,phoneNumber:!0,messages:{required:e.translations.youNeedToEnterValidPhoneNumber}}))},a.setBanamexDebitCardValidation=function(){$("#banamex-debit-card").length&&(a.addCvvNumberValidation(e.validationControls.banamexDebitCard.cvv,e.validationControls.banamexDebitCard.cardType,e.translations.cvvMissing,e.translations.cvvInvalid),a.addSelectListValidation(e.validationControls.banamexDebitCard.expirationYear,e.translations.youNeedToSelectYear),a.addSelectListValidation(e.validationControls.banamexDebitCard.expirationMonth,e.translations.youNeedToSelectMonth),a.addNameValidation(e.validationControls.banamexDebitCard.firstName,e.translations.fullNameRequiredFirstName),a.addNameValidation(e.validationControls.banamexDebitCard.lastName,e.translations.fullNameRequiredLastName),a.addRequiredValidation(e.validationControls.banamexDebitCard.address,e.translations.addressRequired),a.addRequiredValidation(e.validationControls.banamexDebitCard.city,e.translations.cityRequired),a.addRequiredValidation(e.validationControls.banamexDebitCard.zip,e.translations.zipRequired),a.addKnockoutListValidation(e.validationControls.banamexDebitCard.countryDrop,e.validationControls.banamexDebitCard.country,e.translations.youNeedToSelectCountry),a.addKnockoutListValidation(e.validationControls.banamexDebitCard.stateDrop,e.validationControls.banamexDebitCard.state,e.translations.youNeedToSelectState),a.addBinValidationForDebitCards(e.validationControls.banamexDebitCard.cardNumber,e.invalidBinsForDebitCards,e.translations.invalidDebitCards),$(e.validationControls.banamexDebitCard.phone).rules("add",{required:!0,phoneNumber:!0,messages:{required:e.translations.youNeedToEnterValidPhoneNumber}}))},a.setToditoCashValidation=function(){$("#todito-cash").length&&(a.addRequiredValidationDigitsOnly(e.validationControls.toditoCash.cardNumber,e.translations.toditoCardNumberInvalid),a.addRequiredValidationDigitsOnly(e.validationControls.toditoCash.nip,e.translations.toditoCardNumberInvalid))},a.setScotiaBankValidation=function(){$("#scotia-bank").length&&(a.addCreditCardValidation(e.validationControls.scotiaBank.cardNumber,$("#scotia-bank-card-type"),e.translations.creditCardMissing,e.translations.creditCardInvalid),a.addRequiredValidation(e.validationControls.scotiaBank.cardNumber,e.translations.creditCardMissing),a.addRequiredValidationDigitsOnly(e.validationControls.scotiaBank.zip,e.translations.invalidZip),a.addSelectListValidation(e.validationControls.scotiaBank.expirationYear,e.translations.youNeedToSelectYear),a.addSelectListValidation(e.validationControls.scotiaBank.expirationMonth,e.translations.youNeedToSelectMonth))},a.setVivaScotiaCardValidation=function(){$("#viva-scotia-card").length&&(a.addVivaScotiaCardValidation(e.validationControls.vivaScotiaCard.cardNumber,e.translations.creditCardMissing,e.translations.vivaScotiaCardInvalid),
a.addCvvNumberValidation(e.validationControls.vivaScotiaCard.cvv,"MC",e.translations.cvvMissing,e.translations.cvvInvalid),a.addSelectListValidation(e.validationControls.vivaScotiaCard.expirationYear,e.translations.youNeedToSelectYear),a.addSelectListValidation(e.validationControls.vivaScotiaCard.expirationMonth,e.translations.youNeedToSelectMonth),a.addKnockoutListValidation(e.validationControls.vivaScotiaCard.name,e.validationControls.vivaScotiaCard.firstName,e.translations.youNeedToSelectName),a.addRequiredValidation(e.validationControls.vivaScotiaCard.address,e.translations.addressRequired),a.addRequiredValidation(e.validationControls.vivaScotiaCard.city,e.translations.cityRequired),a.addRequiredValidation(e.validationControls.vivaScotiaCard.zip,e.translations.zipRequired),a.addKnockoutListValidation(e.validationControls.vivaScotiaCard.countryDrop,e.validationControls.vivaScotiaCard.country,e.translations.youNeedToSelectCountry),a.addKnockoutListValidation(e.validationControls.vivaScotiaCard.stateDrop,e.validationControls.vivaScotiaCard.state,e.translations.youNeedToSelectState),$(e.validationControls.vivaScotiaCard.phone).rules("add",{required:!0,phoneNumber:!0,messages:{required:e.translations.youNeedToEnterValidPhoneNumber}}))},a.setValidationConfirmation=function(){e.validationControls.confirmation.termsAndConditions&&$(e.validationControls.confirmation.termsAndConditions).rules("add",{required:!0,messages:{required:e.translations.acceptTermsAndConditions}})},a.closeAllPaymentOptions=function(){$("#payments .boxInner").velocity("slideUp"),$("#payments .arrow").removeClass("up").addClass("down"),$(".paymentError").hide(),$("#paymentSummary").hide()},a.hideAndCloseAllPaymentOption=function(){$.publish("changebooking/hidePerformChangeContainer"),a.closeAllPaymentOptions(),$("#SelectPayment").val(""),$("#payments").hide(),a.currentPaymentTab=null},a.setAllPaymentOptionToDefault=function(){$("#payments .boxInner").velocity("slideUp"),$("#payments .arrow").removeClass("up").addClass("down"),$(".paymentError").hide(),$("#paymentSummary").hide(),$("#SelectPayment").val(""),a.currentPaymentTab=null},a.currentPaymentTab=null,a.openPaymentOption=function(){var t=this;if(this===a.currentPaymentTab)return void a.onDeselectPaymentOption();if("None"===window.RouteInfo.CurrentChangeBookingView){var n=window.ExtrasViewModel.getExtraByType("ExtrasMexicoDepartureTax");if(n&&n.shouldShowPushPayNowPopup())return void n.pushPayNowPopup(function(){a.openPaymentOption.apply(t)})}var i=$(this).attr("data-paymenttype");return i===e.paymentNames.accertifyInstallments?void a.displayAccertifyInstallmentsPopup():(i===e.paymentNames.uplift?($("#bookNow").addClass("payment-button--disabled"),$("#bookNow").parent().addClass("payment-button-div--disabled")):$("#bookNow").hasClass("payment-button--disabled")&&i!==e.paymentNames.uplift&&i!==e.paymentNames.vivaCash&&($("#bookNow").removeClass("payment-button--disabled"),$("#bookNow").parent().removeClass("payment-button-div--disabled")),i===e.paymentNames.vivaCash&&$("#vivacash-header-balance").hide(),void a.onPaymentOptionChanged(this,!0))},a.onPaymentGroupClick=function(){var e=$(this).closest(".payment-group");e.hasClass("open")?(e.find(".payment-list").slideUp(),e.removeClass("open")):(e.addClass("open"),e.find(".payment-list").slideDown())},a.displayAccertifyInstallmentsPopup=function(){e.installmentsPopup.container.css("display","block"),e.installmentsPopup.block.css("display","block"),$("#accertifyInstallmentsConditions").find(".accept-conditions").focus()},a.hideAccertifyInstallmentsPopup=function(){e.installmentsPopup.container.css("display","none"),e.installmentsPopup.block.css("display","none")},a.onDeselectPaymentOption=function(){a.currentPaymentTab=null,a.closeAllPaymentOptions(),a.showSelectAnotherPayment(),$("#SelectPayment").val(""),$("#vivacash-header-balance").show()},a.onPaymentOptionChanged=function(e,t,n,i){a.clearValidation(),a.currentPaymentTab=e,a.BlockElement($(".payment .box"));var o=$(e).attr("data-paymenttype");$("#SelectPayment").val(o),t&&a.closeAllPaymentOptions();var r=$(e).find("i.arrow");r.removeClass("down").removeClass("up").addClass("loading");var s=$(e).closest(".payment").find(".confirmText").html();null!=s&&s.length>0&&$("#lblConfirmText").html(s);var l=$("#paymentSummary");l.is(":visible")&&a.BlockElement(l,"[loading...]"),a.getPaymentInfo(o,a.changePaymentAjaxSuccessHandler,$(e),n,i)},a.changePaymentAjaxSuccessHandler=function(t,n,i){if($("#paymentSummary").show(),$.publish("bookingBasket/show",t.PaymentData.BookingSummaryTemplateDataVB),null!=a.summaryViewModel){ko.mapping.fromJS(t.PaymentData.BookingSummaryTemplateDataVB,{},a.summaryViewModel.basket),t.PaymentData.Payments.length>0&&"NONE"==t.PaymentData.Payments[t.PaymentData.Payments.length-1].Identity&&(t.PaymentData.Payments[t.PaymentData.Payments.length-1].Name=e.translations.pleaseSelectPayment);var o=t.PaymentData.Payments.length>0?t.PaymentData.Payments:0==t.TotalAmountIncludingFees?[{Name:e.translations.noPaymentNeededForThisChange,Amount:t.PaymentData.TotalPriceString,Extra:""}]:[{Name:e.translations.pleaseSelectPayment,Amount:t.PaymentData.TotalPriceString,Extra:""}];a.summaryViewModel.Payments(o)}else t.PaymentData.Payments.length>0&&"NONE"==t.PaymentData.Payments[t.PaymentData.Payments.length-1].Identity&&(t.PaymentData.Payments[t.PaymentData.Payments.length-1].Name=e.translations.pleaseSelectPayment),a.summaryViewModel=new PaymentSummaryViewModel(t,e.translations.pleaseSelectPayment),ko.applyBindings(a.summaryViewModel,$("#paymentSummary")[0]);a.UnblockElement($("#paymentSummary")),a.UnblockElement($(".payment .box"));var r=null!==n?n.next(".boxInner"):null,s=null!==n?n.find("i.arrow"):null;null!==s&&s.removeClass("down").addClass("up"),null!==r&&i!==!0&&0!=t.TotalAmountIncludingFees&&r.velocity("slideDown",function(){var e=ezy.isScreenSize(["xs","sm"])?-60:-15,a=$(".headWrapper .container").height();e-=a,r.parent().velocity("scroll",{duration:750,offset:e}),r.find("select:first").focus(),"UL"===r.parent().find(".paymentHead").attr("data-paymenttype")&&void 0!==window.Uplift.Payments&&window.Uplift.Payments.select()}),a.log()},a.noAdditionalPayment=function(){a.getPaymentInfo("",a.changePaymentAjaxSuccessHandler,null,!0)},a.updateExtrasInSummary=function(e,t){if(a.summaryViewModel&&a.summaryViewModel.basket){var n=t.BookingBasketTemplateData;n||(n=t.BookingSummaryTemplateDataVB),ko.mapping.fromJS(n,{},a.summaryViewModel.basket),t.Payments&&a.summaryViewModel.Payments(t.Payments)}a.log()},a.updateAmountInSummary=function(e,t){a.summaryViewModel&&a.summaryViewModel.basket&&ko.mapping.fromJS(t,{},a.summaryViewModel.basket)},a.getPaymentInfo=function(e,t,n,i,o){var r=a.getPaymentDetailsForPaymentForm(e);a.defaultAjax("/PaymentDetails/ChangePayment",{paymentForm:e,cardType:r.cardType,installments:r.installments},function(r){t(r,n,i),o===!0&&a.setPaymentHeaderAmounts(null,e),window.ExtrasViewModel&&window.ExtrasViewModel.handleIncludedSsrsForPayment&&window.ExtrasViewModel.handleIncludedSsrsForPayment(r)},function(e){var a="";try{a=e.responseText.substr(0,e.responseText.indexOf("</title>")).replace("</title>","").replace("<title>","").replace("<html>","").replace("<head>","")}catch(t){}if(a.indexOf("[SE]")>=0)try{dataLayer.push({event:"Session",infotype:"Change payment"})}catch(n){}})},a.getPaymentDetailsForPaymentForm=function(a){var t={cardType:"",installments:0};return a===e.paymentNames.accertifyPayNow?t.cardType=$("#AccertifyPayNowPayment_PaymentForm").val():a===e.paymentNames.accertifyInstallments?(t.cardType=$("#AccertifyInstallmentsPayment_PaymentForm").val(),t.installments=$("#AccertifyInstallmentsPayment_Installments").val()):a==e.paymentNames.banamexDebitCard&&(t.cardType=$("#BanamexDebitCardPayment_PaymentForm").val()),t},a.defaultAjax=function(a,t,n,i){return void 0!==i&&null!==i||(i=function(a){dataLayer.push({event:"Error",errtype:"Payment",errdetail:"General"});var t="";try{t=a.responseText.substr(0,a.responseText.indexOf("</title>")).replace("</title>","").replace("<title>","").replace("<html>","").replace("<head>","")}catch(n){}if(t.indexOf("[SE]")>=0){try{dataLayer.push({event:"Session",infotype:"Change payment method"})}catch(i){}t=e.translations.sessionEnded}$(".paymentErrorPayment ul").html(""),$(".paymentErrorPayment ul").append("<li>"+t+"</li>"),$(".paymentErrorPayment").show(),$(".paymentErrorPayment ul").show(),$(".paymentErrorPayment")[0].scrollIntoView()}),$.ajax({type:"POST",url:a,data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",error:i,success:n})},a.BlockElement=function(e,a){e.block({message:a,css:{border:"none",padding:"5px",fadeIn:0},overlayCSS:{opacity:.2}})},a.UnblockElement=function(e){e.unblock()},t.ClearPaymentVat=function(){$(".vat .txtVatNumber").val(""),$(".vat .txtVatCompanyName").val(""),$(".vat .txtCompanyAddress").val("")},a.showSelectAnotherPayment=function(){$("#paymentErrorPaymentTop ul").html(""),$("#paymentErrorPaymentTop ul").append("<li>"+e.translations.selectAnotherPayment+"</li>"),$("#paymentErrorPaymentTop").show(),$("#paymentErrorPaymentTop ul").show()},a.triggerSelectedFlightOut=function(){$(".availability .flight .price .select :radio[name=flightsout]:checked").length>0&&$(".availability .flight .price .select :radio[name=flightsout]:checked").click()},a.log=function(){var e="";$("#paymentSummary").each(function(){e+=$(this).clone().wrap("<p>").parent().html()}),$("#LogText").val(e)},t};
var UpliftViewModel=function(){var t={},e={},i={};return window.upReady=function(){e.initPayMonthly()},t.init=function(n){i=n,t.enabled=n.enabled,e.consoleLoggingEnabled=n.consoleLoggingEnabled,e.minThreshold=100*n.minAmountInUsd,e.maxThreshold=100*n.maxAmountInUsd},t.upliftPostObject=new Object,t.isUpliftOfferAvailable=ko.observable(!1),e.upliftPaymentAmount=0,t.initUplift=function(t){void 0!==i.upliftPayment&&t!==e.upliftPaymentAmount&&e.handleInitialization(t)},t.reInitiateUplift=function(){var t=e.upliftPaymentAmount;void 0!==i.upliftPayment&&e.handleInitialization(t)},e.handleInitialization=function(i){if(window.Uplift)try{var n=e.buildTripInfoOut(i);window.Uplift.Payments.load(n),e.upliftPaymentAmount=i,e.consoleLoggingEnabled&&(console.log("[Uplift] Payments.load(tripInfo) executed. tripInfo: ",n),console.log("[Uplift] handleInitialization pub.isUpliftOfferAvailable() ",t.isUpliftOfferAvailable()),console.log("[Uplift] handleInitialization pub.isPaymentFormVisible() ",t.isPaymentFormVisible())),t.isUpliftOfferAvailable()&&t.isPaymentFormVisible()&&t.showUplift(i)}catch(o){console.log(o)}else e.consoleLoggingEnabled&&console.log("[Uplift] handleInitialization - window.Uplift is not available.")},t.sendOrderSubmitForInstallments=function(){try{var t="Pay Monthly",i=["Pay In Full","Pay Monthly"],n={mode_of_payment:t,payment_options:i};e.processOrderSubmit(n)}catch(o){console.log(o)}},t.sendOrderSubmitForPayInFull=function(){try{var t="Pay In Full",i=["Pay In Full","Pay Monthly"],n={mode_of_payment:t,payment_options:i};e.processOrderSubmit(n)}catch(o){console.log(o)}},e.processOrderSubmit=function(t){if(window.Uplift){var i=e.upliftPaymentAmount,n=e.buildTripInfo(i);window.Uplift.Analytics.orderSubmit(n,t),e.consoleLoggingEnabled&&(console.log("[Uplift] Analytics.orderSubmit(tripInfo, data) executed."),console.log("[Uplift] Analytics.orderSubmit(tripInfo, data) tripInfo: ",n),console.log("[Uplift] Analytics.orderSubmit(tripInfo, data) data: ",t))}else e.consoleLoggingEnabled&&console.log("[Uplift] processOrderSubmit - window.Uplift is not available.")},t.isPaymentFormVisible=function(){var t=document.getElementById("payments"),e=window.getComputedStyle(t);return"none"!==e.display},t.showUplift=function(t){if(window.Uplift)try{e.consoleLoggingEnabled&&console.log("[Uplift] showUplift entered"),e.initPayMonthlyCO();var i=e.buildTripInfoOut(t);window.Uplift.Payments.load(i),e.consoleLoggingEnabled&&console.log("[Uplift] Uplift.Payments.load(buildTripInfoCO) executed. buildTripInfoCO",i)}catch(n){console.log(n)}else e.consoleLoggingEnabled&&console.log("[Uplift] showUplift - window.Uplift is not available.")},e.initPayMonthly=function(){void 0!==i.upliftPayment&&window.Uplift&&window.Uplift.Payments.init({apiKey:i.upliftPayment.upliftApiKey,locale:i.upliftPayment.locale,currency:"USD",onChange:e.OnUpliftChangeCallback})},e.initPayMonthlyCO=function(){void 0!==i.upliftPayment&&window.Uplift&&window.Uplift.Payments.init({apiKey:i.upliftPayment.upliftApiKey,locale:i.upliftPayment.locale,currency:"USD",checkout:!0,container:i.upliftPayment.container,onChange:e.OnUpliftChangeCallback})},e.buildTripInfo=function(t){var e=new Object;e.order_amount=t,e.travelers=[],$.each(window.passengerDetailsViewModel.passengers(),function(t,n){if(n.type()!==ezy.PaxTypes.Infant&&n.type()!==ezy.PaxTypes.Child){var o=new Object;o.id=t,o.first_name=n.firstName(),o.last_name=n.lastName();var l=n.type()===ezy.PaxTypes.Adult&&i.upliftPayment.isInternational===!0,a=n.type()===ezy.PaxTypes.Adult&&window.passengerDetailsViewModel.showAdultDateOfBirth()===!0;if(l||a){var r=moment().set({year:n.Year(),month:n.Month()-1,date:n.Day()}).format("MM/DD/YYYY").toString();o.date_of_birth=r}e.travelers.push(o)}}),e.air_reservations=[];var n=new Object;if(void 0!==window.criteriaViewModel){n.trip_type=window.criteriaViewModel.isOneWay()===!0?"oneway":"roundtrip",n.origin=window.criteriaViewModel.selectedFromAirport(),n.destination=window.criteriaViewModel.selectedToAirport2(),n.itinerary=[];var o=new Object;o.departure_apc=window.criteriaViewModel.selectedFromAirport(),o.arrival_apc=window.criteriaViewModel.selectedToAirport2();var l=window.criteriaViewModel.departureDate();o.departure_time=l.replace(new RegExp("-","g"),""),n.itinerary.push(o)}return e.air_reservations.push(n),e},e.buildTripInfoOut=function(t){var i=window.passengerDetailsViewModel.passengers()[0],n=e.buildTripInfo(t);return n.billing_contact=new Object,n.billing_contact.street_address="true"===i.addedDestinationDetails()?i.destinationAddress():"",n.billing_contact.postal_code="true"===i.addedDestinationDetails()?i.destinationZip():"",n.billing_contact.city="true"===i.addedDestinationDetails()?i.destinationCity():"",n.billing_contact.email=i.email(),n.billing_contact.first_name=i.firstName(),n.billing_contact.last_name=i.lastName(),n.billing_contact.phone=i.phone(),n.billing_contact.region="US"===i.selectedCountry().code?i.selectedState():"",n.billing_contact.country=i.selectedCountry().code,n},e.padZero=function(t,e){for(var i=t+"";i.length<e;)i="0"+i;return i},e.OnUpliftChangeCallback=function(n){var o={OFFER_AVAILABLE:function(){e.consoleLoggingEnabled&&console.log("[Uplift] OFFER_AVAILABLE",n);var o=0;if(!n.offer)return void(e.consoleLoggingEnabled&&console.log("[Uplift] OFFER_AVAILABLE - offer object is not available"));if(o=n.offer.price,o<e.minThreshold||o>e.maxThreshold)return void(e.consoleLoggingEnabled&&console.log("[Uplift] OFFER_AVAILABLE - offer disabled because of uplift amount "+o+" is not between: "+e.minThreshold+" and "+e.maxThreshold+" webapp restrictions"));t.isUpliftOfferAvailable(!0);var l=i.upliftPayment.installmentText;if(l=l.replace("{0}",Math.ceil(n.offer.number_of_payments)),l=l.replace("{1}",(n.offer.monthly_payment_amount/100).toFixed(2)),i.upliftPayment.installmentTextLabel.html(l),t.isPaymentFormVisible()===!1)return void(e.consoleLoggingEnabled&&console.log("[Uplift] OFFER_AVAILABLE - action stopped - payment form is not visible"));var a=$("#uplift-payment-form").hasClass("inactive")===!1;return a===!1?void(e.consoleLoggingEnabled&&console.log("[Uplift] OFFER_AVAILABLE - payment is not available due to backend rules")):($(i.upliftPayment.container).show(),window.Uplift.Payments.select(),void(e.consoleLoggingEnabled&&console.log("[Uplift] OFFER_AVAILABLE - Uplift payment selected")))},TOKEN_AVAILABLE:function(){e.consoleLoggingEnabled&&console.log("[Uplift] TOKEN_AVAILABLE",n);var t=$("#uplift-payment-form").hasClass("inactive")===!1;t?(window.Uplift.Payments.getToken(),$("#bookNow").removeClass("payment-button--disabled"),$("#bookNow").parent().removeClass("payment-button-div--disabled"),$(".payment, .payment-group").hide(),$(".uplift").show()):e.consoleLoggingEnabled&&console.log("[Uplift] TOKEN_AVAILABLE - payment is not available due to backend rules")},TOKEN_RETRIEVED:function(){var i=n.token;if(e.consoleLoggingEnabled&&(console.log("[Uplift] TOKEN_RETRIEVED",n),console.log("[Uplift] TOKEN_RETRIEVED JSON.stringify",JSON.stringify(n))),null!==i&&Object.keys(i).length>0){var o=e.padZero(i.expiration_month,2);t.upliftPostObject=new Object,t.upliftPostObject.Amount=n.offer.price,t.upliftPostObject.CVVNumber=i.card_ccv,t.upliftPostObject.ExpiryDateMonth=o,t.upliftPostObject.NameOnCard=i.name_on_card,t.upliftPostObject.ExpiryDateYear=i.expiration_year.toString().substring(2,4),t.upliftPostObject.CardNumber=i.card_number,t.upliftPostObject.PaymentForm="MASTERCARD"===i.card_type?"MC":"VI",t.upliftPostObject.Zip=i.contact.postal_code,t.upliftPostObject.Email=i.contact.email,t.upliftPostObject.FirstName=i.contact.first_name,t.upliftPostObject.LastName=i.contact.last_name,t.upliftPostObject.City=i.contact.city,t.upliftPostObject.State=i.contact.region,t.upliftPostObject.Phone=i.contact.phone,t.upliftPostObject.Country=i.contact.country,t.upliftPostObject.Address=i.contact.street_address,e.consoleLoggingEnabled&&console.log("[Uplift] TOKEN_RETRIEVED, upliftPostObject:",t.upliftPostObject)}},OFFER_UNAVAILABLE:function(){e.consoleLoggingEnabled&&console.log("[Uplift] OFFER_UNAVAILABLE",n),t.isUpliftOfferAvailable(!1),dataLayer.push({event:"Payment",errtype:"Uplift",errdetail:n.reasons[0]})},SERVICE_UNAVAILABLE:function(){e.consoleLoggingEnabled&&console.log("[Uplift] SERVICE_UNAVAILABLE",n),t.isUpliftOfferAvailable(!1),dataLayer.push({event:"Error",errtype:"Uplift"})}};o[n.status]()},t};
var vivaCashViewModel=function(){var a={},e={},s={};return a.init=function(a){s=a,e.setEvents(),e.setSubscriptions()},e.setEvents=function(){s.controls.addVivaCashButton.click(e.validateVivaCashAmount),s.controls.removeVivaCashButton.click(e.removeVivaCash),s.controls.vivaCashHeader.click(function(){$(this).parent().find(".boxInner").is(":visible")||(0===a.vivaCashAmount()&&e.getDueAmount(),e.isFullyPaidUsingVivaCash!==!0&&e.isBookNowButtonDisabled(!0),a.isUserLoggedIn()===!0&&(e.blockUI(),e.checkAvailableBalance()))})},e.availableBalance=ko.observable(0),a.vivaCashAmount=ko.observable(0),a.vivaCashAmountHasFocus=ko.observable(!1),a.vivaCashControlsEnabled=ko.observable(!1),e.isFullyPaidUsingVivaCash=ko.observable(!1),a.isUserLoggedIn=ko.observable(window.VivaFan.TopLogin&&window.VivaFan.TopLogin.isLoggedIn()),window.VivaFan.TopLogin&&window.VivaFan.TopLogin.isLoggedIn.subscribe(function(s){a.isUserLoggedIn(s),s===!0&&e.checkAvailableBalance()}),a.allowOnlyDecimalNumbers=function(a,s){var n=s.target.value,o=n.indexOf(".");if(o>0){var i=n.substr(0,o),t=n.substr(o+1,2);s.target.value=e.removeNonNumericValues(i)+"."+e.removeNonNumericValues(t)}else s.target.value=e.removeNonNumericValues(n)},e.removeNonNumericValues=function(a){return a.replace(/[^0-9]/g,"")},e.validateVivaCashAmount=function(){if(e.hideMessages(),""===s.controls.vivaCashAmountTextBox.val()||!$.isNumeric(s.controls.vivaCashAmountTextBox.val()))return void e.showErrorMessage(s.translations.invalidVivaCashAmountText);var a=parseFloat(s.controls.vivaCashAmountTextBox.val());return a>e.availableBalance()?void e.showErrorMessage(s.translations.insufficientBalanceText):a<s.minimumAmountAllowed?void e.showErrorMessage(s.translations.minimumAmountAllowedText):void e.addVivaCash(a)},e.getDueAmount=function(){$.ajax({type:"POST",dataType:"json",url:"/PaymentVivaCash/GetBookingDueAmount",success:function(s){if(s.success===!0){var n=e.availableBalance()>=s.dueAmount?s.dueAmount:e.availableBalance();a.vivaCashAmount(n.toFixed(2))}}})},e.checkAvailableBalance=function(){e.hideMessages(),$.ajax({type:"POST",dataType:"json",url:"/PaymentVivaCash/GetVivaCashBalanceAsync",success:function(n){n.success===!0?(e.availableBalance(n.balance),n.balance<=s.minimumAmountAllowed?(a.vivaCashControlsEnabled(!1),e.showErrorMessage(s.translations.insufficientBalanceText)):a.vivaCashControlsEnabled(!0)):(a.vivaCashControlsEnabled(!1),e.showErrorMessage(s.translations.vivaCashErrorText))},error:function(){e.showErrorMessage(s.translations.vivaCashErrorText)},complete:function(){$.unblockUI()}})},e.addVivaCash=function(a){e.blockUI(),e.hideMessages(),$.ajax({type:"POST",dataType:"json",url:"/PaymentVivaCash/AddVivaCashAsync",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({amount:a}),success:function(a){a.success===!0?(e.setVivaCashBalance(),e.showSuccessMessage(s.translations.successfullyAddedText),e.isFullyPaidUsingVivaCash(a.isFullyPaidUsingVivaCash),$.publish("bookingBasket/show",a.bookingBasketTemplateData),$.publish("payment/updateAmountInSummary",a.bookingBasketTemplateData),a.isFullyPaidUsingVivaCash===!0?($.unblockUI(),e.isBookNowButtonDisabled(!1),$(".payment, .payment-group").hide(),$("#vivacash-payment").show()):(e.isBookNowButtonDisabled(!0),$.publish("payment/reloadPayments",!0))):($.unblockUI(),e.showErrorMessage(a.error))},error:function(){$.unblockUI(),e.showErrorMessage(s.translations.vivaCashErrorText)}})},e.removeVivaCash=function(){e.blockUI(),e.hideMessages(),$.ajax({type:"POST",dataType:"json",url:"/PaymentVivaCash/RemoveVivaCash",success:function(n){n.success===!0?(e.setVivaCashBalance(),a.vivaCashAmount(0),e.showSuccessMessage(s.translations.successfullyRemovedText),$.publish("payment/reloadPayments",!0),$.publish("bookingBasket/show",n.bookingBasketTemplateData),$.publish("payment/updateAmountInSummary",n.bookingBasketTemplateData)):($.unblockUI(),e.showErrorMessage(n.error))},error:function(){$.unblockUI(),e.showErrorMessage(s.translations.vivaCashErrorText)}})},e.setVivaCashBalance=function(){$.ajax({type:"POST",url:"/PaymentVivaCash/GetVivaCashBalanceStringAsync",contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){if(a.success===!0){var n=$('#payments .paymentHead[data-paymenttype="W3"] .available-balance');if(n.length){n.find(".available-balance__amount").remove(),e.availableBalance(a.balance);var o=a.balance<s.minimumAmountAllowed?"available-balance__amount available-balance__amount--insufficient":"available-balance__amount";n.append("<span class='"+o+"'> "+a.balanceString+"</span>"),$("#available-balance__amount").html(a.balanceString),a.balance<s.minimumAmountAllowed?$("#available-balance__amount").addClass("available-balance__amount--insufficient"):$("#available-balance__amount").removeClass("available-balance__amount--insufficient")}}}})},e.showSuccessMessage=function(a){s.controls.vivaCashSuccessContainer.show(),s.controls.vivaCashSuccessContainer.find(".message-text").html(a)},e.showErrorMessage=function(a){s.controls.vivaCashErrorContainer.show(),s.controls.vivaCashErrorContainer.find(".message-text").html(a)},e.hideMessages=function(){s.controls.vivaCashErrorContainer.hide(),s.controls.vivaCashSuccessContainer.hide()},e.isBookNowButtonDisabled=function(a){$("#bookNow").toggleClass("payment-button--disabled",a),$("#bookNow").parent().toggleClass("payment-button-div--disabled",a)},e.blockUI=function(){$.blockUI({message:$("#pleaseWaitContent").html(),css:{border:"none",padding:"20px",fadeIn:0},overlayCSS:{opacity:.5}})},e.setSubscriptions=function(){$.subscribe("vivacash/setVivaCashBalance",e.setVivaCashBalance)},a};
ezy.views.mybooking={},ezy.views.mybooking.boardingpass=function(){var e={},r={},n={};return n.init=function(n){e=n,r.setEvents()},r.setEvents=function(){e.form.validate({debug:!0,rules:{agree:{required:!0}},messages:{agree:{required:e.translations.errorMessage.PleaseAgreeTerms}},errorContainer:".errorContainer",errorLabelContainer:".errorContainer"})},n};
//# sourceMappingURL=maps/managebooking-3033027001.js.map